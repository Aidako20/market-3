flectra.define('calendar.Activity',function(require){
"usestrict";

varActivity=require('mail.Activity');
varDialog=require('web.Dialog');
varcore=require('web.core');
var_t=core._t;

Activity.include({

    /**
     *Overridebehaviortoredirecttocalendareventinsteadofactivity
     *
     *@override
     */
    _onEditActivity:function(event,options){
        varself=this;
        varactivity_id=$(event.currentTarget).data('activity-id');
        varactivity=_.find(this.activities,function(act){returnact.id===activity_id;});
        if(activity&&activity.activity_category==='meeting'&&activity.calendar_event_id){
            returnself._super(event,_.extend({
                res_model:'calendar.event',
                res_id:activity.calendar_event_id[0],
            }));
        }
        returnself._super(event,options);
    },

    /**
     *Overridebehaviortowarnthatthecalendareventisabouttoberemovedaswell
     *
     *@override
     */
    _onUnlinkActivity:function(event,options){
        event.preventDefault();
        varself=this;
        varactivity_id=$(event.currentTarget).data('activity-id');
        varactivity=_.find(this.activities,function(act){returnact.id===activity_id;});
        if(activity&&activity.activity_category==='meeting'&&activity.calendar_event_id){
            Dialog.confirm(
                self,
                _t("Theactivityislinkedtoameeting.Deletingitwillremovethemeetingaswell.Doyouwanttoproceed?"),{
                    confirm_callback:function(){
                        returnself._rpc({
                            model:'mail.activity',
                            method:'unlink_w_meeting',
                            args:[[activity_id]],
                        })
                        .then(self._reload.bind(self,{activity:true}));
                    },
                }
            );
        }
        else{
            returnself._super(event,options);
        }
    },
});

});
