<flectra>
    <templateid="portal_my_invoices_payment"name="PaymentonMyInvoices"inherit_id="account.portal_my_invoices">
        <xpathexpr="//t[@t-call='portal.portal_table']/thead/tr/th[last()]"position="before">
            <thclass="text-center">Status</th>
        </xpath>
        <xpathexpr="//t[@t-foreach='invoices']/tr/td[last()]"position="before">
            <tdclass="text-center">
                <tt-set="tx_ids"t-value="invoice.transaction_ids.filtered(lambdatx:tx.statein('pending','authorized','done'))"/>
                <tt-set="pending_manual_txs"t-value="tx_ids.filtered(lambdatx:tx.state=='pending'andtx.acquirer_id.providerin('transfer','manual'))"/>
                <at-if="invoice.state=='posted'andinvoice.payment_statein('not_paid','partial')andinvoice.amount_totalandinvoice.move_type=='out_invoice'and(pending_manual_txsornottx_idsorinvoice.amount_residual)"
                    t-att-href="invoice.get_portal_url(anchor='portal_pay')"title="PayNow"aria-label="Paynow"class="btnbtn-smbtn-primary"role="button">
                    <iclass="fafa-arrow-circle-right"/><spanclass='d-noned-md-inline'>PayNow</span>
                </a>
            </td>
        </xpath>
        <xpathexpr="//t[@t-foreach='invoices']/tr/td[hasclass('tx_status')]"position="replace">
            <tt-set="last_tx"t-value="invoice.get_portal_last_transaction()"/>
            <tdclass="tx_statustext-center">
                <tt-if="invoice.state=='posted'andinvoice.payment_statein('not_paid','partial')and(last_tx.statenotin['pending','authorized','done','cancel']or(last_tx.state=='pending'andlast_tx.acquirer_id.providerin('transfer','manual')))">
                    <spanclass="badgebadge-pillbadge-info"><iclass="fafa-fwfa-clock-o"></i><spanclass="d-noned-md-inline">WaitingforPayment</span></span>
                </t>
                <tt-if="invoice.state=='posted'andlast_tx.state=='authorized'">
                    <spanclass="badgebadge-pillbadge-primary"><iclass="fafa-fwfa-check"/><spanclass="d-noned-md-inline">Authorized</span></span>
                </t>
                <tt-if="invoice.state=='posted'andlast_tx.state=='pending'andlast_tx.acquirer_id.providernotin('transfer','manual')">
                  <spanclass="badgebadge-pillbadge-warning"><spanclass="d-noned-md-inline">Pending</span></span>
                </t>
                <tt-if="invoice.state=='posted'andinvoice.payment_statein('paid','in_payment')orlast_tx.state=='done'">
                    <spanclass="badgebadge-pillbadge-success"><iclass="fafa-fwfa-check"></i><spanclass="d-noned-md-inline">Paid</span></span>
                </t>
                <tt-if="invoice.state=='posted'andinvoice.payment_state=='reversed'">
                    <spanclass="badgebadge-pillbadge-success"><iclass="fafa-fwfa-check"></i><spanclass="d-noned-md-inline">Reversed</span></span>
                </t>
                <tt-if="invoice.state=='cancel'">
                    <spanclass="badgebadge-pillbadge-danger"><iclass="fafa-fwfa-remove"></i><spanclass="d-noned-md-inline">Cancelled</span></span>
                </t>
            </td>
        </xpath>
    </template>

    <templateid="portal_invoice_payment"name="InvoicePayment">
        <divclass="row"t-if="(invoice.amount_residualornottx_ids)andinvoice.state=='posted'andinvoice.payment_statein('not_paid','partial')andinvoice.amount_total"id="portal_pay">
            <divclass="modalfade"id="pay_with"role="dialog">
                <divclass="modal-dialog">
                    <divclass="modal-content">
                        <divclass="modal-header">
                            <h3class="modal-title">Paywith</h3>
                            <buttontype="button"class="close"data-dismiss="modal"aria-label="Close">Ã—</button>
                        </div>
                        <divclass="modal-body">
                            <divt-if="pmsoracquirers"id="payment_method"class="text-leftcol-md-13">
                                <tt-call="payment.payment_tokens_list">
                                    <tt-set="mode"t-value="'payment'"/>
                                    <tt-set="partner_id"t-value="invoice.partner_id.idifrequest.env.user._is_public()elserequest.env.user.partner_id.id"/>
                                    <tt-set="success_url"t-value="invoice.get_portal_url()"/>
                                    <tt-set="error_url"t-value="invoice.get_portal_url()"/>
                                    <tt-set="access_token"t-value="access_tokenor''"/>
                                    <tt-set="callback_method"t-value="''"/>
                                    <tt-set="form_action"t-value="'/invoice/pay/'+str(invoice.id)+'/s2s_token_tx/'"/>
                                    <tt-set="prepare_tx_url"t-value="'/invoice/pay/'+str(invoice.id)+'/form_tx/'"/>
                                    <tt-set="submit_txt">PayNow</t>
                                    <tt-set="icon_class"t-value="'fa-lock'"/>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <templateid="portal_invoice_page_inherit_payment"name="PaymentonMyInvoices"inherit_id="account.portal_invoice_page">
        <xpathexpr="//t[@t-call='portal.portal_record_sidebar']//div[hasclass('o_download_pdf')]"position="before">
            <tt-set="tx_ids"t-value="invoice.transaction_ids.filtered(lambdatx:tx.statein('pending','authorized','done'))"/>
            <tt-set="pending_manual_txs"t-value="tx_ids.filtered(lambdatx:tx.state=='pending'andtx.acquirer_id.providerin('transfer','manual'))"/>
            <div>
                <ahref="#"t-if="invoice.state=='posted'andinvoice.payment_statein('not_paid','partial')andinvoice.amount_totalandinvoice.move_type=='out_invoice'and(pending_manual_txsornottx_idsorinvoice.amount_residual)"

                    class="btnbtn-primarybtn-blockmb-2"data-toggle="modal"data-target="#pay_with">
                    <iclass="fafa-fwfa-arrow-circle-right"/>PayNow
                </a>
                <divt-if="tx_idsandnotpending_manual_txsandnotinvoice.amount_residualandinvoice.payment_statenotin('paid','in_payment')"class="alertalert-infopy-1mb-2">
                    <iclass="fafa-fwfa-check-circle"/>Pending
                </div>
                <divt-if="invoice.payment_statein('paid','in_payment')"class="alertalert-successpy-1mb-2">
                    <iclass="fafa-fwfa-check-circle"/>Paid
                </div>
            </div>
        </xpath>
        <xpathexpr="//div[@id='invoice_content']//div[hasclass('o_portal_html_view')]"position="before">
            <divt-if="invoice.transaction_idsandinvoice.amount_totalandnotsuccessandnoterror"class="o_account_payment_tx_status"t-att-data-invoice-id="invoice.id">
                <tt-call="payment.payment_confirmation_status">
                    <tt-set="payment_tx_id"t-value="invoice.get_portal_last_transaction()"/>
                    <tt-set="reference"t-value="invoice.payment_reference"/>
                </t>
            </div>
            <tt-set="tx_ids"t-value="invoice.transaction_ids.filtered(lambdatx:tx.statein('authorized','done'))"/>
            <divt-if="(invoice.amount_residualornottx_ids)andinvoice.state=='posted'andinvoice.payment_statein('not_paid','partial')andinvoice.amount_total"id="portal_pay">
                <divt-if="pmsoracquirers"id="payment_method">
                    <tt-call="account_payment.portal_invoice_payment"/>
                </div>
            </div>
            <divclass="panel-body"t-if="existing_token">
                <divclass="offset-lg-3col-lg-6">
                    <iclass="fafa-info"></i>Youhavecreditscardregistered,youcanlog-intobeabletousethem.
                </div>
            </div>
        </xpath>
    </template>

    <templateid="portal_invoice_error"name="Invoiceerrordisplay:paymenterrors"
            inherit_id="account.portal_invoice_error">
        <xpathexpr="//t[@name='generic']"position="after">
            <tt-if="error=='pay_invoice_invalid_doc'">
                Therewasanerrorprocessingyourpayment:invalidinvoice.
            </t>
            <tt-if="error=='pay_invoice_invalid_token'">
                Therewasenerrorprocessingyourpayment:invalidcreditcardID.
            </t>
            <tt-if="error=='pay_invoice_tx_fail'">
                Therewasanerrorprocessingyourpayment:transactionfailed.<br/>
                <tt-set="tx_id"t-value="invoice.get_portal_last_transaction()"/>
                <tt-if="tx_idandtx_id.state_message">
                    <tt-esc="tx_id.state_message"/>
                </t>
            </t>
            <tt-if="error=='pay_invoice_tx_token'">
                Therewasanerrorprocessingyourpayment:issuewithcreditcardIDvalidation.
            </t>
        </xpath>
    </template>

    <templateid="portal_invoice_success"name="Invoicesuccessdisplay:paymentsuccess"
            inherit_id="account.portal_invoice_success">
        <xpathexpr="//a[hasclass('close')]"position="after">
            <tt-if="success=='pay_invoice'">
                <tt-set="payment_tx_id"t-value="invoice.get_portal_last_transaction()"/>
                <spant-if='payment_tx_id.acquirer_id.done_msg't-raw="payment_tx_id.acquirer_id.done_msg"/>
                <divt-if="payment_tx_id.acquirer_id.pending_msgandpayment_tx_id.acquirer_id.provider=='transfer'andinvoice.ref">
                    <b>Communication:</b><spant-esc='invoice.ref'/>
                </div>
            </t>
            <tt-if="success=='pay_invoice'andinvoice.payment_statein('paid','in_payment')">
                Done,youronlinepaymenthasbeensuccessfullyprocessed.Thankyouforyourorder.
            </t>
        </xpath>
    </template>
</flectra>
