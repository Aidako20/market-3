<?xmlversion="1.0"?>
<flectra>
    <data>

    <!--PurchaseRequisitionType-->

    <recordmodel="ir.ui.view"id="view_purchase_requisition_type_tree">
        <fieldname="name">purchase.requisition.type.tree</field>
        <fieldname="model">purchase.requisition.type</field>
        <fieldname="arch"type="xml">
            <treestring="PurchaseAgreementTypes">
                <fieldname="sequence"widget="handle"/>
                <fieldname="name"/>
                <fieldname="exclusive"/>
            </tree>
        </field>
    </record>

    <recordid="view_purchase_requisition_type_kanban"model="ir.ui.view">
        <fieldname="name">purchase.requisition.type.kanban</field>
        <fieldname="model">purchase.requisition.type</field>
        <fieldname="arch"type="xml">
            <kanbanclass="o_kanban_mobile">
                <fieldname="name"/>
                <fieldname="exclusive"/>
                <templates>
                    <tt-name="kanban-box">
                        <divt-attf-class="oe_kanban_global_click">
                            <divclass="o_kanban_record_top">
                                <divclass="o_kanban_record_headingsmt4">
                                    <strongclass="o_kanban_record_title"><fieldname="name"/></strong>
                                </div>
                                <fieldname="exclusive"widget="label_selection"/>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    <recordmodel="ir.ui.view"id="view_purchase_requisition_type_form">
        <fieldname="name">purchase.requisition.type.form</field>
        <fieldname="model">purchase.requisition.type</field>
        <fieldname="arch"type="xml">
            <formstring="PurchaseAgreementTypes">
            <sheet>
                <group>
                    <groupstring="AgreementType">
                        <fieldname="name"/>
                        <fieldname="exclusive"widget="radio"/>
                    </group>
                    <groupstring="Datafornewquotations">
                        <fieldname="line_copy"widget="radio"/>
                        <fieldname="quantity_copy"widget="radio"/>
                    </group>
                </group>
            </sheet>
            </form>
        </field>
    </record>
    <recordid="tender_type_action"model="ir.actions.act_window">
        <fieldname="name">PurchaseAgreementTypes</field>
        <fieldname="res_model">purchase.requisition.type</field>
        <fieldname="context">{}</field>
        <fieldname="view_mode">tree,kanban,form</field>
    </record>
    <menuitem
        id="menu_purchase_requisition_type"
        sequence="2"
        parent="purchase.menu_purchase_config"
        action="tender_type_action"/>

    <!--PurchaseOrders-->

    <recordmodel="ir.actions.act_window"id="action_purchase_requisition_to_so">
        <fieldname="name">RequestforQuotation</field>
        <fieldname="type">ir.actions.act_window</field>
        <fieldname="res_model">purchase.order</field>
        <fieldname="view_mode">form,tree</field>
        <fieldname="domain">[('requisition_id','=',active_id)]</field>
        <fieldname="context">{
            "default_requisition_id":active_id,
            "default_user_id":False,
            }
        </field>
    </record>
    <recordmodel="ir.actions.act_window"id="action_purchase_requisition_list">
        <fieldname="name">RequestforQuotations</field>
        <fieldname="type">ir.actions.act_window</field>
        <fieldname="res_model">purchase.order</field>
        <fieldname="view_mode">tree,form</field>
        <fieldname="domain">[('requisition_id','=',active_id)]</field>
        <fieldname="context">{
            "default_requisition_id":active_id,
            "default_user_id":False,
            }
        </field>
    </record>

    <recordmodel="ir.ui.view"id="view_purchase_requisition_form">
        <fieldname="name">purchase.requisition.form</field>
        <fieldname="model">purchase.requisition</field>
        <fieldname="arch"type="xml">
            <formstring="PurchaseAgreements">
            <header>
                <buttonname="%(action_purchase_requisition_to_so)d"type="action"
                    string="NewQuotation"
                    attrs="{'invisible':[('state','!=','open')]}"/>
                <buttonname="%(action_purchase_requisition_to_so)d"type="action"
                    string="NewQuotation"class="btn-primary"
                    attrs="{'invisible':[('state','notin',('in_progress','ongoing'))]}"/>
                <buttonname="action_in_progress"states="draft"string="Confirm"type="object"class="btn-primary"/>
                <buttonname="action_open"states="in_progress"string="Validate"type="object"class="btn-primary"/>
                <buttonname="action_done"states="open,ongoing"string="Close"type="object"class="btn-primary"/>
                <buttonname="action_draft"states="cancel"string="ResettoDraft"type="object"/>
                <buttonname="action_cancel"states="draft,in_progress,ongoing"string="Cancel"type="object"/>
                <fieldname="state"widget="statusbar"statusbar_visible="draft,in_progress,open,done"attrs="{'invisible':[('is_quantity_copy','=','none')]}"/>
                <fieldname="state_blanket_order"widget="statusbar"statusbar_visible="draft,ongoing,done"attrs="{'invisible':[('is_quantity_copy','!=','none')]}"/>
            </header>
            <sheet>
                <divclass="oe_button_box"name="button_box">
                    <buttonname="%(action_purchase_requisition_list)d"type="action"class="oe_stat_button"icon="fa-list-alt"
                        attrs="{'invisible':[('state','=','draft')]}">
                        <fieldname="order_count"widget="statinfo"string="RFQs/Orders"/>
                    </button>
                </div>
                <divclass="float-left">
                    <labelfor="name"class="oe_edit_onlyoe_inline"/>
                    <h1>
                        <fieldname="name"/>
                    </h1>
                </div>
                <group>
                    <group>
                        <fieldname="is_quantity_copy"invisible='1'/>
                        <fieldname="user_id"attrs="{'readonly':[('state','notin',('draft','in_progress','open'))]}"domain="[('share','=',False)]"/>
                        <fieldname="type_id"attrs="{'readonly':[('state','!=','draft')]}"/>
                        <fieldname="vendor_id"context="{'res_partner_search_mode':'supplier'}"attrs="{'required':[('is_quantity_copy','=','none')],'readonly':[('state','in',['ongoing','done'])]}"/>
                        <fieldname="currency_id"groups="base.group_multi_currency"/>
                    </group>
                    <group>
                        <fieldname="date_end"attrs="{'readonly':[('state','notin',('draft','in_progress','open','ongoing'))]}"/>
                        <fieldname="ordering_date"attrs="{'readonly':[('state','notin',('draft','in_progress','open','ongoing'))]}"/>
                        <fieldname="schedule_date"attrs="{'readonly':[('state','notin',('draft','in_progress','open','ongoing'))]}"/>
                        <fieldname="origin"placeholder="e.g.PO0025"attrs="{'readonly':[('state','!=','draft')]}"/>
                        <fieldname="company_id"groups="base.group_multi_company"options="{'no_create':True}"attrs="{'readonly':[('state','notin',('draft'))]}"/>
                    </group>
                </group>
                <notebook>
                    <pagestring="Products"name="products">
                        <fieldname="line_ids">
                            <treestring="Products"editable="bottom">
                                <fieldname="product_id"context="{'default_purchase_requisition':'tenders'}"
                                       domain="[('purchase_ok','=',True),'|',('company_id','=',False),('company_id','=',parent.company_id)]"/>
                                <fieldname="product_description_variants"attrs="{'invisible':[('product_description_variants','=','')],'readonly':[('parent.state','!=','draft')]}"/>
                                <fieldname="product_qty"/>
                                <fieldname="qty_ordered"optional="show"/>
                                <fieldname="product_uom_category_id"invisible="1"/>
                                <fieldname="product_uom_id"string="UoM"groups="uom.group_uom"optional="show"attrs="{'required':[('product_id','!=',False)]}"/>
                                <fieldname="schedule_date"groups="base.group_no_one"/>
                                <fieldname="account_analytic_id"optional="hide"domain="['|',('company_id','=',False),('company_id','=',parent.company_id)]"groups="analytic.group_analytic_accounting"/>
                                <fieldname="analytic_tag_ids"optional="hide"domain="['|',('company_id','=',False),('company_id','=',parent.company_id)]"groups="analytic.group_analytic_tags"widget="many2many_tags"/>
                                <fieldname="price_unit"/>
                            </tree>
                            <formstring="Products">
                                <group>
                                    <fieldname="product_id"context="{'default_purchase_requisition':'tenders'}"
                                           domain="[('purchase_ok','=',True),'|',('company_id','=',False),('company_id','=',parent.company_id)]"/>
                                    <fieldname="product_qty"/>
                                    <fieldname="qty_ordered"/>
                                    <fieldname="product_uom_category_id"invisible="1"/>
                                    <fieldname="product_uom_id"/>
                                    <fieldname="schedule_date"/>
                                    <fieldname="account_analytic_id" domain="['|',('company_id','=',False),('company_id','=',parent.company_id)]"groups="analytic.group_analytic_accounting"/>
                                    <fieldname="company_id"groups="base.group_multi_company"options="{'no_create':True}"/>
                                </group>
                            </form>
                        </field>
                        <separatorstring="TermsandConditions"/>
                        <fieldname="description"attrs="{'readonly':[('state','notin',('draft','in_progress','open'))]}"/>
                    </page>
                </notebook>
            </sheet>
            <divclass="oe_chatter">
              <fieldname="message_follower_ids"/>
              <fieldname="activity_ids"/>
              <fieldname="message_ids"/>
            </div>
            </form>
        </field>
    </record>
    <recordmodel="ir.ui.view"id="view_purchase_requisition_tree">
        <fieldname="name">purchase.requisition.tree</field>
        <fieldname="model">purchase.requisition</field>
        <fieldname="arch"type="xml">
            <treestring="PurchaseAgreements"sample="1">
                <fieldname="message_needaction"invisible="1"/>
                <fieldname="name"decoration-bf="1"/>
                <fieldname="user_id"optional="show"widget='many2one_avatar_user'/>
                <fieldname="company_id"groups="base.group_multi_company"options="{'no_create':True}"optional="show"/>
                <fieldname="ordering_date"optional="show"/>
                <fieldname="schedule_date"optional="hide"/>
                <fieldname="date_end"optional="show"widget='remaining_days'decoration-danger="date_endanddate_end&lt;current_date"attrs="{'invisible':[('state','in',('done','cancel'))]}"/>
                <fieldname="origin"optional="show"/>
                <fieldname="state"optional="show"widget='badge'decoration-success="state=='done'"decoration-info="statenotin('done','cancel')"/>
                <fieldname="activity_exception_decoration"widget="activity_exception"/>
            </tree>
      </field>
    </record>

    <recordid="view_purchase_requisition_kanban"model="ir.ui.view">
        <fieldname="name">purchase.requisition.kanban</field>
        <fieldname="model">purchase.requisition</field>
        <fieldname="arch"type="xml">
            <kanbanclass="o_kanban_mobile"sample="1">
                <fieldname="name"/>
                <fieldname="state"/>
                <fieldname="user_id"/>
                <fieldname="type_id"/>
                <templates>
                    <tt-name="kanban-box">
                        <divt-attf-class="oe_kanban_cardoe_kanban_global_click">
                            <divclass="o_kanban_record_top">
                                <divclass="o_kanban_record_headingsmt4">
                                    <strongclass="o_kanban_record_title"><span><fieldname="name"/></span></strong>
                                </div>
                                <fieldname="state"widget="label_selection"options="{'classes':{'draft':'default','in_progress':'default','open':'success','done':'success','close':'danger'}}"readonly="1"/>
                            </div>
                            <divclass="o_kanban_record_body">
                                <spanclass="text-muted"><fieldname="type_id"/></span>
                            </div>
                            <divclass="o_kanban_record_bottom">
                                <divclass="oe_kanban_bottom_left">
                                    <fieldname="vendor_id"/>
                                </div>
                                <divclass="oe_kanban_bottom_right">
                                    <fieldname="user_id"widget="many2one_avatar_user"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <recordid="view_purchase_requisition_filter"model="ir.ui.view">
            <fieldname="name">purchase.requisition.list.select</field>
            <fieldname="model">purchase.requisition</field>
            <fieldname="arch"type="xml">
                <searchstring="SearchPurchaseAgreements">
                    <fieldname="name"string="Reference"filter_domain="['|',('name','ilike',self),('origin','ilike',self)]"/>
                    <fieldname="user_id"/>
                    <fieldname="product_id"/>
                    <filterstring="MyAgreements"name="my_agreements"domain="[('user_id','=',uid)]"/>
                    <separator/>
                    <filterstring="Draft"name="draft"domain="[('state','=','draft')]"help="NewAgreements"/>
                    <filterstring="Confirmed"name="confirmed"domain="[('state','in',('in_progress','open'))]"help="Innegotiation"/>
                    <filterstring="Done"name="done"domain="[('state','=','done')]"/>
                    <separator/>
                    <filterinvisible="1"string="LateActivities"name="activities_overdue"
                        domain="[('my_activity_date_deadline','&lt;',context_today().strftime('%Y-%m-%d'))]"
                        help="Showallrecordswhichhasnextactiondateisbeforetoday"/>
                    <filterinvisible="1"string="TodayActivities"name="activities_today"
                        domain="[('my_activity_date_deadline','=',context_today().strftime('%Y-%m-%d'))]"/>
                    <filterinvisible="1"string="FutureActivities"name="activities_upcoming_all"
                        domain="[('my_activity_date_deadline','&gt;',context_today().strftime('%Y-%m-%d'))]"/>
                    <groupexpand="0"string="GroupBy">
                        <filterstring="PurchaseRepresentative"name="representative"domain="[]"context="{'group_by':'user_id'}"/>
                        <filterstring="Status"name="status"domain="[]"context="{'group_by':'state'}"/>
                        <filterstring="OrderingDate"name="ordering_date"domain="[]"context="{'group_by':'ordering_date'}"/>
                    </group>
                </search>
            </field>
        </record>


    <recordmodel="ir.actions.act_window"id="action_purchase_requisition">
        <fieldname="name">PurchaseAgreements</field>
        <fieldname="type">ir.actions.act_window</field>
        <fieldname="res_model">purchase.requisition</field>
        <fieldname="view_mode">tree,kanban,form</field>
        <fieldname="context">{}</field>
        <fieldname="search_view_id"ref="view_purchase_requisition_filter"/>
        <fieldname="help"type="html">
          <pclass="o_view_nocontent_smiling_face">
            Startanewpurchaseagreement
          </p><p>
            Exampleofpurchaseagreementsincludecallfortendersandblanketorders.
          </p><p>
            Inacallfortenders,youcanrecordtheproductsyouneedtobuy
            andgeneratethecreationofRfQstovendors.Oncethetendershave
            beenregistered,youcanreviewandcomparethemandyoucan
            validatesomeandcancelothers.
          </p><p>
            Forablanketorder,youcanrecordanagreementforaspecifcperiod
            (e.g.ayear)andyouorderproductswithinthisagreement,benefiting
            fromthenegotiatedprices.
          </p>
        </field>
    </record>

    <menuitem
        id="menu_purchase_requisition_pro_mgt"
        sequence="10"
        parent="purchase.menu_procurement_management"
        action="action_purchase_requisition"/>

    </data>
</flectra>
