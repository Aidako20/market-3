<?xmlversion="1.0"encoding="utf-8"?>
<flectra>
    <datanoupdate="1">
        <!--Activities-->
        <recordid="mail_act_sale_upsell"model="mail.activity.type">
            <fieldname="name">OrderUpsell</field>
            <fieldname="icon">fa-line-chart</field>
            <fieldname="res_model_id"ref="sale.model_sale_order"/>
        </record>

        <!--Sale-relatedsubtypesformessaging/Chatter-->
        <recordid="mt_order_sent"model="mail.message.subtype">
            <fieldname="name">Quotationsent</field>
            <fieldname="res_model">sale.order</field>
            <fieldname="default"eval="False"/>
            <fieldname="description">Quotationsent</field>
        </record>
        <recordid="mt_order_confirmed"model="mail.message.subtype">
            <fieldname="name">SalesOrderConfirmed</field>
            <fieldname="res_model">sale.order</field>
            <fieldname="default"eval="False"/>
            <fieldname="description">Quotationconfirmed</field>
        </record>

        <!--Salesteam-relatedsubtypesformessaging/Chatter-->
        <recordid="mt_salesteam_order_sent"model="mail.message.subtype">
            <fieldname="name">Quotationsent</field>
            <fieldname="sequence">20</field>
            <fieldname="res_model">crm.team</field>
            <fieldname="default"eval="True"/>
            <fieldname="parent_id"ref="sale.mt_order_sent"/>
            <fieldname="relation_field">team_id</field>
        </record>
        <recordid="mt_salesteam_order_confirmed"model="mail.message.subtype">
            <fieldname="name">SalesOrderConfirmed</field>
            <fieldname="sequence">21</field>
            <fieldname="res_model">crm.team</field>
            <fieldname="default"eval="True"/>
            <fieldname="parent_id"ref="sale.mt_order_confirmed"/>
            <fieldname="relation_field">team_id</field>
        </record>
        <recordid="mt_salesteam_invoice_created"model="mail.message.subtype">
            <fieldname="name">InvoiceCreated</field>
            <fieldname="sequence">22</field>
            <fieldname="res_model">crm.team</field>
            <fieldname="parent_id"ref="account.mt_invoice_created"/>
            <fieldname="relation_field">team_id</field>
        </record>
        <recordid="mt_salesteam_invoice_confirmed"model="mail.message.subtype">
            <fieldname="name">InvoiceConfirmed</field>
            <fieldname="sequence">23</field>
            <fieldname="res_model">crm.team</field>
            <fieldname="parent_id"ref="account.mt_invoice_validated"/>
            <fieldname="relation_field">team_id</field>
        </record>
    </data>
    <!--Templateandnotificationsection-->
    <datanoupdate="1">
        <templateid="mail_notification_paynow_online"inherit_id="mail.mail_notification_paynow"
            name="Quotation:SignandPaymailnotificationtemplate">
            <xpathexpr="//t[@t-set='access_name']"position="after">
                <tt-if="record._name=='sale.order'">
                    <tt-set="is_transaction_pending"t-value="record.get_portal_last_transaction().state=='pending'"/>
                    <tt-if="record.has_to_be_signed(include_draft=True)">
                        <tt-if="record.has_to_be_paid()"t-set="access_name">
                            <tt-if="is_transaction_pending">ViewQuotation</t>
                            <tt-else="">Sign&amp;PayQuotation</t>
                        </t>
                        <tt-else=""t-set="access_name">Accept&amp;SignQuotation</t>
                    </t>
                    <tt-elif="record.has_to_be_paid(include_draft=True)andnotis_transaction_pending">
                        <tt-set="access_name">Accept&amp;PayQuotation</t>
                    </t>
                    <tt-elif="record.statein('draft','sent')">
                        <tt-set="access_name">ViewQuotation</t>
                    </t>
                </t>
            </xpath>
        </template>

        <recordid="email_template_edi_sale"model="mail.template">
            <fieldname="name">SalesOrder:Sendbyemail</field>
            <fieldname="model_id"ref="sale.model_sale_order"/>
            <fieldname="subject">${object.company_id.name}${object.statein('draft','sent')and(ctx.get('proforma')and'Proforma'or'Quotation')or'Order'}(Ref${object.nameor'n/a'})</field>
            <fieldname="email_from">${(object.user_id.email_formattedoruser.email_formatted)|safe}</field>
            <fieldname="partner_to">${object.partner_id.id}</field>
            <fieldname="body_html"type="html">
<divstyle="margin:0px;padding:0px;">
    <pstyle="margin:0px;padding:0px;font-size:13px;">
        %setdoc_name='quotation'ifobject.statein('draft','sent')else'order'
        Hello,
        <br/><br/>
        Your
        %ifctx.get('proforma'):
            Proformainvoicefor${doc_name}<strong>${object.name}</strong>
            %ifobject.origin:
                (withreference:${object.origin})
            %endif
            amountingin<strong>${format_amount(object.amount_total,object.pricelist_id.currency_id)}</strong>isavailable.
        %else:
            ${doc_name}<strong>${object.name}</strong>
            %ifobject.origin:
                (withreference:${object.origin})
            %endif
            amountingin<strong>${format_amount(object.amount_total,object.pricelist_id.currency_id)}</strong>isreadyforreview.
        %endif
        <br/><br/>
        Donothesitatetocontactusifyouhaveanyquestions.
        <br/>
    </p>
</div>
            </field>
            <fieldname="report_template"ref="action_report_saleorder"/>
            <fieldname="report_name">${(object.nameor'').replace('/','_')}</field>
            <fieldname="lang">${object.partner_id.lang}</field>
            <fieldname="auto_delete"eval="True"/>
        </record>

        <recordid="mail_template_sale_confirmation"model="mail.template">
            <fieldname="name">SalesOrder:ConfirmationEmail</field>
            <fieldname="model_id"ref="sale.model_sale_order"/>
            <fieldname="subject">${object.company_id.name}${(object.get_portal_last_transaction().state=='pending')and'PendingOrder'or'Order'}(Ref${object.nameor'n/a'})</field>
            <fieldname="email_from">${(object.user_id.email_formattedoruser.email_formatted)|safe}</field>
            <fieldname="partner_to">${object.partner_id.id}</field>
            <fieldname="body_html"type="html">
<divstyle="margin:0px;padding:0px;">
    <pstyle="margin:0px;padding:0px;font-size:12px;">
        Hello,
        <br/><br/>
        %settransaction=object.get_portal_last_transaction()
        Yourorder<strong>${object.name}</strong>amountingin<strong>${format_amount(object.amount_total,object.currency_id)}</strong>
        %ifobject.state=='sale'or(transactionandtransaction.statein('done','authorized')):
            hasbeenconfirmed.<br/>
            Thankyouforyourtrust!
        %eliftransactionandtransaction.state=='pending':
            ispending.Itwillbeconfirmedwhenthepaymentisreceived.
            %ifobject.reference:
                Yourpaymentreferenceis<strong>${object.reference}</strong>.
            %endif
        %endif
        <br/><br/>
        Donothesitatetocontactusifyouhaveanyquestions.
        <br/><br/>
    </p>
%ifobject.website_id:
    <divstyle="margin:0px;padding:0px;">
        <tablewidth="100%"style="color:#454748;font-size:12px;border-collapse:collapse;">
            <trstyle="border-bottom:2pxsolid#dee2e6;">
                <tdstyle="width:150px;"><strong>Products</strong></td>
                <td></td>
                <tdwidth="15%"align="center"><strong>Quantity</strong></td>
                <tdwidth="20%"align="right"><strong>
                %ifobject.user_id.has_group('account.group_show_line_subtotals_tax_excluded'):
                    VATExcl.
                %else
                    VATIncl.
                %endif
                </strong></td>
            </tr>
        </table>
        %forlineinobject.order_line:
            %ifnotline.is_deliveryandline.display_typein['line_section','line_note']:
                <tablewidth="100%"style="color:#454748;font-size:12px;border-collapse:collapse;">
                    <trstyle="${loop.cycle('background-color:#f2f2f2','background-color:#ffffff')}">
                        <tdcolspan="4">
                            %ifline.display_type=='line_section':
                                <strong>${line.name}</strong>
                            %elifline.display_type=='line_note':
                                <i>${line.name}</i>
                            %endif
                        </td>
                    </tr>
                </table>
            %elifnotline.is_delivery
                <tablewidth="100%"style="color:#454748;font-size:12px;border-collapse:collapse;">
                    <trstyle="${loop.cycle('background-color:#f2f2f2','background-color:#ffffff')}">
                        <tdstyle="width:150px;">
                            <imgsrc="/web/image/product.product/${line.product_id.id}/image_128"style="width:64px;height:64px;object-fit:contain;"alt="Productimage"></img>
                        </td>
                        <tdalign="left">${line.product_id.name}</td>
                        <tdwidth="15%"align="center">${line.product_uom_qty}</td>
                        <tdwidth="20%"align="right"><strong>
                        %ifobject.user_id.has_group('account.group_show_line_subtotals_tax_excluded'):
                            ${format_amount(line.price_reduce_taxexcl,object.currency_id)}
                        %else
                            ${format_amount(line.price_reduce_taxinc,object.currency_id)}
                        %endif
                        </strong></td>
                    </tr>
                </table>
            %endif
        %endfor
    </div>
    %ifobject.carrier_id:
    <divstyle="margin:0px;padding:0px;">
        <tablewidth="100%"style="color:#454748;font-size:12px;border-spacing:0px4px;"align="right">
            <tr>
                <tdstyle="width:60%"/>
                <tdstyle="width:30%;border-top:1pxsolid#dee2e6;"align="right"><strong>Delivery:</strong></td>
                <tdstyle="width:10%;border-top:1pxsolid#dee2e6;"align="right">${format_amount(object.amount_delivery,object.currency_id)}</td>
            </tr>
            <tr>
                <tdstyle="width:60%"/>
                <tdstyle="width:30%;"align="right"><strong>SubTotal:</strong></td>
                <tdstyle="width:10%;"align="right">${format_amount(object.amount_untaxed,object.currency_id)}</td>
            </tr>
        </table>
    </div>
    %else:
    <divstyle="margin:0px;padding:0px;">
        <tablewidth="100%"style="color:#454748;font-size:12px;border-spacing:0px4px;"align="right">
            <tr>
                <tdstyle="width:60%"/>
                <tdstyle="width:30%;border-top:1pxsolid#dee2e6;"align="right"><strong>SubTotal:</strong></td>
                <tdstyle="width:10%;border-top:1pxsolid#dee2e6;"align="right">${format_amount(object.amount_untaxed,object.currency_id)}</td>
            </tr>
        </table>
    </div>
    %endif
    <divstyle="margin:0px;padding:0px;">
        <tablewidth="100%"style="color:#454748;font-size:12px;border-spacing:0px4px;"align="right">
            <tr>
                <tdstyle="width:60%"/>
                <tdstyle="width:30%;"align="right"><strong>Taxes:</strong></td>
                <tdstyle="width:10%;"align="right">${format_amount(object.amount_tax,object.currency_id)}</td>
            </tr>
            <tr>
                <tdstyle="width:60%"/>
                <tdstyle="width:30%;border-top:1pxsolid#dee2e6;"align="right"><strong>Total:</strong></td>
                <tdstyle="width:10%;border-top:1pxsolid#dee2e6;"align="right">${format_amount(object.amount_total,object.currency_id)}</td>
            </tr>
        </table>
    </div>
    %ifobject.partner_invoice_id:
    <divstyle="margin:0px;padding:0px;">
        <tablewidth="100%"style="color:#454748;font-size:12px;">
            <tr>
                <tdstyle="padding-top:10px;">
                    <strong>Billto:</strong>
                    ${object.partner_invoice_id.streetor''}
                    ${object.partner_invoice_id.cityor''}
                    ${object.partner_invoice_id.state_id.nameor''}
                    ${object.partner_invoice_id.zipor''}
                    ${object.partner_invoice_id.country_id.nameor''}
                </td>
            </tr>
            <tr>
                <td>
                    <strong>PaymentMethod:</strong>
                    %iftransaction.payment_token_id:
                        ${transaction.payment_token_id.name}
                    %else:
                        ${transaction.acquirer_id.name}
                    %endif
                     (${format_amount(transaction.amount,object.currency_id)})
                </td>
            </tr>
        </table>
    </div>
    %endif
    %ifobject.partner_shipping_idandnotobject.only_services:
    <divstyle="margin:0px;padding:0px;">
        <tablewidth="100%"style="color:#454748;font-size:12px;">
            <tr>
                <td>
                    <br/>
                    <strong>Shipto:</strong>
                    ${object.partner_shipping_id.streetor''}
                    ${object.partner_shipping_id.cityor''}
                    ${object.partner_shipping_id.state_id.nameor''}
                    ${object.partner_shipping_id.zipor''}
                    ${object.partner_shipping_id.country_id.nameor''}
                </td>
            </tr>
        </table>
        %ifobject.carrier_id:
        <tablewidth="100%"style="color:#454748;font-size:12px;">
            <tr>
                <td>
                    <strong>ShippingMethod:</strong>
                    ${object.carrier_id.name}
                    %ifobject.carrier_id.fixed_price==0.0:
                        (Free)
                    %else:
                        (${format_amount(object.carrier_id.fixed_price,object.currency_id)})
                    %endif
                </td>
            </tr>
        </table>
        %endif
    </div>
    %endif
%endif
</div></field>
            <fieldname="report_template"ref="action_report_saleorder"/>
            <fieldname="report_name">${(object.nameor'').replace('/','_')}</field>
            <fieldname="lang">${object.partner_id.lang}</field>
            <fieldname="auto_delete"eval="True"/>
        </record>
    </data>
</flectra>
