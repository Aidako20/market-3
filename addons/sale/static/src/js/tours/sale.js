flectra.define('sale.tour',function(require){
"usestrict";

varcore=require('web.core');
vartour=require('web_tour.tour');

var_t=core._t;

tour.register("sale_tour",{
    url:"/web",
    rainbowMan:false,
    sequence:20,
},[tour.stepUtils.showAppsMenuItem(),{
    trigger:".o_app[data-menu-xmlid='sale.sale_menu_root']",
    content:_t("OpenSalesapptosendyourfirstquotationinafewclicks."),
    position:"right",
    edition:"community"
},{
    trigger:".o_app[data-menu-xmlid='sale.sale_menu_root']",
    content:_t("OpenSalesapptosendyourfirstquotationinafewclicks."),
    position:"bottom",
    edition:"enterprise"
},{
    trigger:'a.o_onboarding_step_action.btn[data-method=action_open_base_onboarding_company]',
    extra_trigger:".o_sale_order",
    content:_t("Startbycheckingyourcompany'sdata."),
    position:"bottom",
},{
    trigger:".modal-contentbutton[name='action_save_onboarding_company_step']",
    content:_t("Looksgood.Let'scontinue."),
    position:"left",
},{
    trigger:'a.o_onboarding_step_action.btn[data-method=action_open_base_document_layout]',
    extra_trigger:".o_sale_order",
    content:_t("Customizeyourquotesandorders."),
    position:"bottom",
},{
    trigger:"button[name='document_layout_save']",
    extra_trigger:".o_sale_order",
    content:_t("Goodjob,let'scontinue."),
    position:"top",//dotNOTmovetobottom,itwouldcausearesizeflicker
},{
    trigger:'a.o_onboarding_step_action.btn[data-method=action_open_sale_onboarding_payment_acquirer]',
    extra_trigger:".o_sale_order",
    content:_t("Tospeeduporderconfirmation,wecanactivateelectronicsignaturesorpayments."),
    position:"bottom",
},{
    trigger:"button[name='add_payment_methods']",
    extra_trigger:".o_sale_order",
    content:_t("Letskeepelectronicsignaturefornow."),
    position:"bottom",
},{
    trigger:'a.o_onboarding_step_action.btn[data-method=action_open_sale_onboarding_sample_quotation]',
    extra_trigger:".o_sale_order",
    content:_t("Now,we'llcreateasamplequote."),
    position:"bottom",
}]);

tour.register("sale_quote_tour",{
        url:"/web#action=sale.action_quotations_with_onboarding&view_type=form",
        rainbowMan:true,
        rainbowManMessage:"<b>Congratulations</b>,yourfirstquotationissent!<br>Checkyouremailtovalidatethequote.",
        sequence:30,
    },[{
        trigger:".o_form_editable.o_field_many2one[name='partner_id']",
        extra_trigger:".o_sale_order",
        content:_t("Writeacompanynametocreateone,orseesuggestions."),
        position:"bottom",
        run:function(actions){
            actions.text("Agrolait",this.$anchor.find("input"));
        },
    },{
        trigger:".ui-menu-item>a",
        auto:true,
        in_modal:false,
    },{
        trigger:".o_field_x2many_list_row_add>a",
        extra_trigger:".o_field_many2one[name='partner_id'].o_external_button",
        content:_t("Clickheretoaddsomeproductsorservicestoyourquotation."),
        position:"bottom",
    },{
        trigger:".o_field_widget[name='product_id'],.o_field_widget[name='product_template_id']",
        extra_trigger:".o_sale_order",
        content:_t("Selectaproduct,orcreateanewoneonthefly."),
        position:"right",
        run:function(actions){
            var$input=this.$anchor.find("input");
            actions.text("DESK0001",$input.length===0?this.$anchor:$input);
            //fakekeydowntotriggersearch
            varkeyDownEvent=jQuery.Event("keydown");
            keyDownEvent.which=42;
            this.$anchor.trigger(keyDownEvent);
            var$descriptionElement=$(".o_form_editabletextarea[name='name']");
            //whendescriptionchanges,weknowtheproducthasbeencreated
            $descriptionElement.change(function(){
                $descriptionElement.addClass("product_creation_success");
            });
        },
        id:"product_selection_step"
    },{
        trigger:".ui-menu.ui-widget.ui-menu-itema:contains('DESK0001')",
        auto:true,
    },{
        trigger:".o_form_editabletextarea[name='name'].product_creation_success",
        auto:true,
        run:function(){
        }//waitforproductcreation
    },{
        trigger:".o_field_widget[name='price_unit']",
        extra_trigger:".o_sale_order",
        content:_t("<b>Setaprice</b>."),
        position:"right",
        run:"text10.0"
    },
    ...tour.stepUtils.statusbarButtonsSteps("SendbyEmail",_t("<b>Sendthequote</b>toyourselfandcheckwhatthecustomerwillreceive."),".o_statusbar_buttonsbutton[name='action_quotation_send']"),
    {
        trigger:".modal-footerbutton.btn-primary",
        auto:true,
    },{
        trigger:".modal-footerbutton[name='action_send_mail']",
        extra_trigger:".modal-footerbutton[name='action_send_mail']",
        content:_t("Let'ssendthequote."),
        position:"bottom",
    }]);

});
