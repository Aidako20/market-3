<?xmlversion="1.0"encoding="utf-8"?>
<flectra>

    <templateid="portal_my_home_menu_sale"name="Portallayout:salesmenuentries"inherit_id="portal.portal_breadcrumbs"priority="20">
        <xpathexpr="//ol[hasclass('o_portal_submenu')]"position="inside">
            <lit-if="page_name=='quote'orsale_orderandsale_order.statein('sent','cancel')"t-attf-class="breadcrumb-item#{'active'ifnotsale_orderelse''}">
                <at-if="sale_order"t-attf-href="/my/quotes?{{keep_query()}}">Quotations</a>
                <tt-else="">Quotations</t>
            </li>
            <lit-if="page_name=='order'orsale_orderandsale_order.statenotin('sent','cancel')"t-attf-class="breadcrumb-item#{'active'ifnotsale_orderelse''}">
                <at-if="sale_order"t-attf-href="/my/orders?{{keep_query()}}">SalesOrders</a>
                <tt-else="">SalesOrders</t>
            </li>
            <lit-if="sale_order"class="breadcrumb-itemactive">
                <spant-field="sale_order.type_name"/>
                <tt-esc="sale_order.name"/>
            </li>
        </xpath>
    </template>

    <templateid="portal_my_home_sale"name="ShowQuotations/SalesOrders"customize_show="True"inherit_id="portal.portal_my_home"priority="20">
        <xpathexpr="//div[hasclass('o_portal_docs')]"position="inside">
            <tt-call="portal.portal_docs_entry">
                <tt-set="title">Quotations</t>
                <tt-set="url"t-value="'/my/quotes'"/>
                <tt-set="placeholder_count"t-value="'quotation_count'"/>
            </t>
            <tt-call="portal.portal_docs_entry">
                <tt-set="title">SalesOrders</t>
                <tt-set="url"t-value="'/my/orders'"/>
                <tt-set="placeholder_count"t-value="'order_count'"/>
            </t>
        </xpath>
    </template>

    <templateid="portal_my_quotations"name="MyQuotations">
        <tt-call="portal.portal_layout">
            <tt-set="breadcrumbs_searchbar"t-value="True"/>

            <tt-call="portal.portal_searchbar">
                <tt-set="title">Quotations</t>
            </t>
            <tt-if="notquotations">
                <p>Therearecurrentlynoquotationsforyouraccount.</p>
            </t>
            <tt-if="quotations"t-call="portal.portal_table">
                <thead>
                    <trclass="active">
                        <th>Quotation#</th>
                        <thclass="text-right">QuotationDate</th>
                        <thclass="text-right">ValidUntil</th>
                        <thclass="text-center"/>
                        <thclass="text-right">Total</th>
                    </tr>
                </thead>
                <tt-foreach="quotations"t-as="quotation">
                    <tr>
                        <td><at-att-href="quotation.get_portal_url()"><tt-esc="quotation.name"/></a></td>
                        <tdclass="text-right"><spant-field="quotation.date_order"/></td>
                        <tdclass="text-right"><spant-field="quotation.validity_date"/></td>
                        <tdclass="text-center">
                            <spant-if="quotation.state=='cancel'"class="badgebadge-pillbadge-secondary"><iclass="fafa-fwfa-remove"/>Cancelled</span>
                            <spant-if="quotation.is_expired"class="badgebadge-pillbadge-secondary"><iclass="fafa-fwfa-clock-o"/>Expired</span>
                        </td>
                        <tdclass="text-right">
                            <spant-field="quotation.amount_total"/>
                        </td>
                    </tr>
                </t>
            </t>
        </t>
    </template>

    <templateid="portal_my_orders"name="MySalesOrders">
        <tt-call="portal.portal_layout">
            <tt-set="breadcrumbs_searchbar"t-value="True"/>

            <tt-call="portal.portal_searchbar">
                <tt-set="title">SalesOrders</t>
            </t>
            <tt-if="notorders">
                <p>Therearecurrentlynoordersforyouraccount.</p>
            </t>
            <tt-if="orders"t-call="portal.portal_table">
                <thead>
                    <trclass="active">
                        <th>
                            <spanclass='d-noned-md-inline'>SalesOrder#</span>
                            <spanclass='d-blockd-md-none'>Ref.</span>
                        </th>
                        <thclass="text-right">OrderDate</th>
                        <thclass="text-center"/>
                        <thclass="text-right">Total</th>
                    </tr>
                </thead>
                <tt-foreach="orders"t-as="order">
                    <tr>
                        <td><at-att-href="order.get_portal_url()"><tt-esc="order.name"/></a></td>
                        <tdclass="text-right">
                            <spant-field="order.date_order"t-options="{'widget':'date'}"/>&amp;nbsp;
                            <spanclass='d-noned-md-inline't-field="order.date_order"t-options="{'time_only':True}"/>
                        </td>
                        <tdclass="text-center">
                            <spant-if="order.state=='done'" class="badgebadge-pillbadge-success">
                                <iclass="fafa-fwfa-check"role="img"aria-label="Done"title="Done"/>Done
                            </span>
                        </td>
                        <tdclass="text-right"><spant-field="order.amount_total"/></td>
                    </tr>
                </t>
            </t>
        </t>
    </template>

    <!--Completepageofthesale_order-->
    <templateid="sale_order_portal_template"name="SalesOrderPortalTemplate"inherit_id="portal.portal_sidebar"primary="True">
        <xpathexpr="//div[hasclass('o_portal_sidebar')]"position="inside">
            <tt-set="o_portal_fullwidth_alert"groups="sales_team.group_sale_salesman">
                <tt-call="portal.portal_back_in_edit_mode">
                    <tt-set="backend_url"t-value="'/web#model=%s&amp;id=%s&amp;action=%s&amp;view_type=form'%(sale_order._name,sale_order.id,action.id)"/>
                </t>
            </t>

            <divclass="rowmt16o_portal_sale_sidebar">
                <!--Sidebar-->
                <tt-call="portal.portal_record_sidebar">
                    <tt-set="classes"t-value="'col-lg-autod-print-none'"/>

                    <tt-set="title">
                        <h2class="mb-0"><bt-field="sale_order.amount_total"data-id="total_amount"/></h2>
                    </t>
                    <tt-set="entries">
                        <ulclass="list-grouplist-group-flushflex-wrapflex-rowflex-lg-column">
                            <liclass="list-group-itemflex-grow-1">
                                <at-if="sale_order.has_to_be_signed(True)"role="button"class="btnbtn-primarybtn-blockmb8"data-toggle="modal"data-target="#modalaccept"href="#">
                                    <iclass="fafa-check"/><tt-if="sale_order.has_to_be_paid(True)">Sign&amp;Pay</t><tt-else="">Accept&amp;Sign</t>
                                </a>
                                <at-elif="sale_order.has_to_be_paid(True)"role="button"id="o_sale_portal_paynow"data-toggle="modal"data-target="#modalaccept"href="#"t-att-class="'btn-blockmb8%s'%('btnbtn-light'ifsale_order.transaction_idselse'btnbtn-primary')">
                                    <iclass="fafa-check"/><tt-if="notsale_order.signature">Accept&amp;Pay</t><tt-else="">PayNow</t>
                                </a>
                                <divclass="o_download_pdfbtn-toolbarflex-sm-nowrap">
                                    <divclass="btn-groupflex-grow-1mr-1mb-1">
                                        <aclass="btnbtn-secondarybtn-blocko_download_btn"t-att-href="sale_order.get_portal_url(report_type='pdf',download=True)"title="Download"><iclass="fafa-download"/>Download</a>
                                    </div>
                                    <divclass="btn-groupflex-grow-1mb-1">
                                        <aclass="btnbtn-secondarybtn-blocko_print_btno_portal_invoice_print"t-att-href="sale_order.get_portal_url(report_type='pdf')"id="print_invoice_report"title="Print"target="_blank"><iclass="fafa-print"/>Print</a>
                                    </div>
                                </div>
                            </li>

                            <liclass="navspylist-group-itempl-0flex-grow-1"t-ignore="true"role="complementary">
                                <ulclass="navflex-columnbs-sidenav"></ul>
                            </li>

                            <tt-if="notsale_order.is_expiredandsale_order.statein['draft','sent']">
                                <lit-if="sale_order.validity_date"class="list-group-item">
                                    <small><bclass="text-muted">Thisofferexpireson</b></small>
                                    <divt-field="sale_order.validity_date"></div>
                                </li>
                                <lit-if="sale_order.amount_undiscounted-sale_order.amount_untaxed&gt;0.01"class="list-group-itemflex-grow-1">
                                    <small><bclass="text-muted">Youradvantage</b></small>
                                    <small>
                                        <bt-field="sale_order.amount_undiscounted"
                                            t-options='{"widget":"monetary","display_currency":sale_order.pricelist_id.currency_id}'
                                            style="text-decoration:line-through"
                                            class="d-blockmt-1"
                                            data-id="amount_undiscounted"/>
                                    </small>
                                    <tt-if="sale_order.amount_untaxed==sale_order.amount_total">
                                        <h4t-field="sale_order.amount_total"class="text-success"data-id="total_amount"/>
                                    </t>
                                    <tt-else="">
                                        <h4t-field="sale_order.amount_untaxed"class="text-successmb-0"data-id="total_untaxed"/>
                                        <small>(<spant-field="sale_order.amount_total"data-id="total_amount"/>Incl.tax)</small>
                                    </t>
                                </li>
                            </t>

                            <lit-if="sale_order.user_id"class="list-group-itemflex-grow-1">
                                <divclass="smallmb-1"><strongclass="text-muted">Salesperson</strong></div>
                                <divclass="rowflex-nowrap">
                                    <divclass="colflex-grow-0pr-2">
                                        <imgclass="rounded-circlemr4float-lefto_portal_contact_img"t-if="sale_order.user_id.image_1024"t-att-src="image_data_uri(sale_order.user_id.image_1024)"alt="Contact"/>
                                        <imgclass="rounded-circlemr4float-lefto_portal_contact_img"t-if="notsale_order.user_id.image_1024"src="/web/static/src/img/placeholder.png"alt="Contact"/>
                                    </div>
                                    <divclass="colpl-0"style="min-width:150px">
                                        <spant-field="sale_order.user_id"t-options='{"widget":"contact","fields":["name","phone"],"no_marker":True}'/>
                                        <ahref="#discussion"class="small"><iclass="fafa-comment"></i>Sendmessage</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </t>
                </t>

                <!--Pagecontent-->
                <divid="quote_content"class="col-12col-lgjustify-content-end">

                    <!--modalrelativetotheactionssignandpay-->
                    <divrole="dialog"class="modalfade"id="modalaccept">
                        <divclass="modal-dialog"t-if="sale_order.has_to_be_signed(True)">
                            <formid="accept"method="POST"t-att-data-order-id="sale_order.id"t-att-data-token="sale_order.access_token"class="js_accept_jsonmodal-contentjs_website_submit_form">
                                <inputtype="hidden"name="csrf_token"t-att-value="request.csrf_token()"/>
                                <headerclass="modal-header">
                                    <h4class="modal-title">ValidateOrder</h4>
                                    <buttontype="button"class="close"data-dismiss="modal"aria-label="Close">×</button>
                                </header>
                                <mainclass="modal-body"id="sign-dialog">
                                    <p>
                                        <span>Bysigningthisproposal,Iagreetothefollowingterms:</span>
                                        <ul>
                                            <li><span>Acceptedonthebehalfof:</span><bt-field="sale_order.partner_id.commercial_partner_id"/></li>
                                            <li><span>Foranamountof:</span><bdata-id="total_amount"t-field="sale_order.amount_total"/></li>
                                            <lit-if="sale_order.payment_term_id"><span>Withpaymentterms:</span><bt-field="sale_order.payment_term_id.note"/></li>
                                        </ul>
                                    </p>
                                    <tt-call="portal.signature_form">
                                        <tt-set="call_url"t-value="sale_order.get_portal_url(suffix='/accept')"/>
                                        <tt-set="default_name"t-value="sale_order.partner_id.name"/>
                                    </t>
                                </main>
                            </form>
                        </div>

                        <divclass="modal-dialog"t-if="notsale_order.has_to_be_signed(True)andsale_order.has_to_be_paid(True)">
                            <divclass="modal-content">
                                <headerclass="modal-header">
                                    <h4class="modal-title">ValidateOrder</h4>
                                    <buttontype="button"class="close"data-dismiss="modal"aria-label="Close">×</button>
                                </header>
                                <mainclass="modal-body"id="sign-dialog">
                                    <p>
                                        <span>Bypayingthisproposal,Iagreetothefollowingterms:</span>
                                        <ul>
                                            <li><span>Acceptedonthebehalfof:</span><bt-field="sale_order.partner_id.commercial_partner_id"/></li>
                                            <li><span>Foranamountof:</span><bdata-id="total_amount"t-field="sale_order.amount_total"/></li>
                                            <lit-if="sale_order.payment_term_id"><span>Withpaymentterms:</span><bt-field="sale_order.payment_term_id.note"/></li>
                                        </ul>
                                    </p>
                                    <divt-if="pmsoracquirers"id="payment_method"class="text-left">
                                        <h3class="mb24">Paywith</h3>
                                        <tt-call="payment.payment_tokens_list">
                                            <tt-set="mode"t-value="'payment'"/>
                                            <tt-set="submit_txt">Pay&amp;Confirm</t>
                                            <tt-set="icon_class"t-value="'fa-lock'"/>
                                            <tt-set="form_action"t-value="sale_order.get_portal_url(suffix='/transaction/token')"/>
                                            <tt-set="prepare_tx_url"t-value="sale_order.get_portal_url(suffix='/transaction/')"/>
                                            <tt-set="access_token"t-value="sale_order.access_token"/>
                                        </t>
                                    </div>
                                </main>
                            </div>
                        </div>
                    </div>

                    <!--modalrelativetotheactionreject-->
                    <divrole="dialog"class="modalfade"id="modaldecline">
                        <divclass="modal-dialog">
                            <formid="decline"method="POST"t-attf-action="/my/orders/#{sale_order.id}/decline?access_token=#{sale_order.access_token}"class="modal-content">
                                <inputtype="hidden"name="csrf_token"t-att-value="request.csrf_token()"/>
                                <headerclass="modal-header">
                                    <h4class="modal-title">RejectThisQuotation</h4>
                                    <buttontype="button"class="close"data-dismiss="modal"aria-label="Close">×</button>
                                </header>
                                <mainclass="modal-body">
                                    <p>
                                        Telluswhyyouarerefusingthisquotation,thiswillhelpusimproveourservices.
                                    </p>
                                    <textarearows="4"name="decline_message"required=""placeholder="Yourfeedback..."class="form-control"/>
                                </main>
                                <footerclass="modal-footer">
                                    <buttontype="submit"t-att-id="sale_order.id"class="btnbtn-danger"><iclass="fafa-times"></i>Reject</button>
                                    <buttontype="button"class="btnbtn-primary"data-dismiss="modal">Cancel</button>
                                </footer>
                            </form>
                        </div>
                    </div>

                    <!--statusmessages-->
                    <divt-if="message=='sign_ok'"class="alertalert-successalert-dismissabled-print-none"role="status">
                        <buttontype="button"class="close"data-dismiss="alert"aria-label="Close">×</button>
                        <strong>ThankYou!</strong><br/>
                        <tt-if="message=='sign_ok'andsale_order.statein['sale','done']">Yourorderhasbeenconfirmed.</t>
                        <tt-elif="message=='sign_ok'andsale_order.has_to_be_paid()">Yourorderhasbeensignedbutstillneedstobepaidtobeconfirmed.</t>
                        <tt-else="">Yourorderhasbeensigned.</t>
                    </div>

                    <divt-if="message=='cant_reject'andsale_order.has_to_be_signed()"class="alertalert-dangeralert-dismissabled-print-none"role="alert">
                        <buttontype="button"class="close"data-dismiss="alert"aria-label="Close">×</button>
                        Yourorderisnotinastatetoberejected.
                    </div>

                    <tt-if="sale_order.transaction_ids">
                        <tt-call="payment.payment_confirmation_status">
                            <tt-set="payment_tx_id"t-value="sale_order.get_portal_last_transaction()"/>
                            <tt-set="reference"t-value="sale_order.reference"/>
                        </t>
                    </t>

                    <divt-if="sale_order.state=='cancel'"class="alertalert-dangeralert-dismissabled-print-none"role="alert">
                        <buttontype="button"class="close"data-dismiss="alert"aria-label="close">×</button>
                        <strong>Thisquotationhasbeencanceled.</strong><arole="button"href="#discussion"><iclass="fafa-comment"/>Contactustogetanewquotation.</a>
                    </div>

                    <divt-if="sale_order.is_expired"class="alertalert-warningalert-dismissabled-print-none"role="alert">
                        <buttontype="button"class="close"data-dismiss="alert"aria-label="close">×</button>
                        <strong>Thisofferexpired!</strong><arole="button"href="#discussion"><iclass="fafa-comment"/>Contactustogetanewquotation.</a>
                    </div>

                    <!--maincontent-->
                    <divt-attf-class="card#{'pb-5'ifreport_type=='html'else''}"id="portal_sale_content">
                        <divt-call="sale.sale_order_portal_content"/>
                    </div>

                    <!--bottomactions-->
                    <divt-if="sale_order.has_to_be_signed(True)orsale_order.has_to_be_paid(True)"class="rowjustify-content-centertext-centerd-print-nonept-1pb-4">

                        <tt-if="sale_order.has_to_be_signed(True)">
                            <divclass="col-sm-automt8">
                                <arole="button"class="btnbtn-primary"data-toggle="modal"data-target="#modalaccept"href="#"><iclass="fafa-check"/><tt-if="sale_order.has_to_be_paid(True)">Sign&amp;Pay</t><tt-else="">Accept&amp;Sign</t></a>
                            </div>
                            <divclass="col-sm-automt8">
                                <arole="button"class="btnbtn-secondary"href="#discussion"><iclass="fafa-comment"/>Feedback</a>
                            </div>
                            <divclass="col-sm-automt8">
                                <arole="button"class="btnbtn-danger"data-toggle="modal"data-target="#modaldecline"href="#"><iclass="fafa-times"/>Reject</a>
                            </div>
                        </t>
                        <divt-elif="sale_order.has_to_be_paid(True)"class="col-sm-automt8">
                            <arole="button"data-toggle="modal"data-target="#modalaccept"href="#"t-att-class="'%s'%('btnbtn-light'ifsale_order.transaction_idselse'btnbtn-primary')">
                                <iclass="fafa-check"/><tt-if="notsale_order.signature">Accept&amp;Pay</t><tt-else="">PayNow</t>
                            </a>
                        </div>
                    </div>

                    <!--chatter-->
                    <divid="sale_order_communication"class="mt-4">
                        <h2>History</h2>
                        <tt-call="portal.message_thread">
                            <tt-set="object"t-value="sale_order"/>
                        </t>
                    </div>
                </div><!--//#quote_content-->
            </div>
        </xpath>
    </template>

    <!--
    SalesOrdercontent:intro,informations,orderlines,remarks,descriptions....
    ThistemplateshouldcontainsalltheprintableelementoftheSO.Thisisthe
    templaterenderedinPDFwiththereportengine.
    -->
    <templateid="sale_order_portal_content"name="SalesOrderPortalContent">
        <!--Intro-->
        <divid="introduction"t-attf-class="pb-2pt-3#{'card-headerbg-white'ifreport_type=='html'else''}">
          <h2class="my-0">
                <tt-esc="sale_order.type_name"/>
                <emt-esc="sale_order.name"/>
            </h2>
        </div>

        <divt-attf-class="#{'card-body'ifreport_type=='html'else''}">
            <!--Informations-->
            <divid="informations">
                <divt-if="sale_order.transaction_idsandnotinvoicesandsale_order.statein('sent','sale')andportal_confirmation=='pay'andnotsuccessandnoterror"t-att-data-order-id="sale_order.id">
                    <tt-if="sale_order.transaction_ids">
                        <tt-call="payment.payment_confirmation_status">
                            <tt-set="payment_tx_id"t-value="sale_order.get_portal_last_transaction()"/>
                            <tt-set="reference"t-value="sale_order.reference"/>
                        </t>
                    </t>
                </div>
                <divclass="row"id="so_date">
                    <divclass="mb-3col-6">
                      <tt-if="sale_order.statein['sale','done','cancel']">
                        <strong>OrderDate:</strong>
                      </t>
                      <tt-else="">
                         <strong>QuotationDate:</strong>
                      </t>
                      <spant-field="sale_order.date_order"t-options='{"widget":"date"}'/>
                    </div>
                    <divclass="mb-3col-6"t-if="sale_order.validity_date">
                        <strong>ExpirationDate:</strong><spant-field="sale_order.validity_date"t-options='{"widget":"date"}'/>
                    </div>
                </div>
                <divclass="row">
                    <divclass="col-lg-6">
                        <strongt-if="sale_order.partner_shipping_id==sale_order.partner_invoice_id"class="d-blockmb-1">InvoicingandShippingAddress:</strong>
                        <strongt-if="sale_order.partner_shipping_id!=sale_order.partner_invoice_id"class="d-blockmb-1">InvoicingAddress:</strong>
                        <addresst-field="sale_order.partner_invoice_id"t-options='{"widget":"contact","fields":["address","name"],"no_marker":True}'/>
                    </div>
                     <tt-if="sale_order.partner_shipping_id!=sale_order.partner_invoice_id">
                        <divid="shipping_address"class="col-lg-6">
                            <strongclass="d-blockmb-1">ShippingAddress:</strong>
                            <addresst-field="sale_order.partner_shipping_id"t-options='{"widget":"contact","fields":["address","name"],"no_marker":True}'/>
                        </div>
                    </t>
                </div>

                <tt-set="invoices"t-value="[iforiinsale_order.invoice_idsifi.statenotin['draft','cancel']]"/>
                <divt-if="invoices"class="row">
                    <divclass="col">
                        <strongclass="d-blockmb-1">Invoices</strong>
                        <ulclass="list-groupmb-4">
                            <tt-foreach="invoices"t-as="i">
                                <tt-set="report_url"t-value="i.get_portal_url(report_type='pdf',download=True)"/>
                                <divclass="d-flexflex-wrapalign-items-centerjustify-content-between">
                                    <div>
                                        <at-att-href="report_url">
                                            <spant-esc="i.name"/>
                                        </a>
                                        <divclass="smalld-lg-inline-block">Date:<spanclass="text-muted"t-field="i.invoice_date"/></div>
                                    </div>
                                    <spant-if="i.payment_statein('paid','in_payment')"class="smallbadgebadge-successorders_label_text_align"><iclass="fafa-fwfa-check"/><b>Paid</b></span>
                                    <spant-else=""class="smallbadgebadge-infoorders_label_text_align"><iclass="fafa-fwfa-clock-o"/><b>WaitingPayment</b></span>
                                </div>
                            </t>
                        </ul>
                    </div>
                </div>
            </div>

            <sectionid="details"style="page-break-inside:auto;"class="mt32">
                <h3id="details">Pricing</h3>

                <tt-set="display_discount"t-value="Truein[line.discount>0forlineinsale_order.order_line]"/>

                <divclass="table-responsive">
                    <tablet-att-data-order-id="sale_order.id"t-att-data-token="sale_order.access_token"class="tabletable-sm"id="sales_order_table">
                        <theadclass="bg-100">
                            <tr>
                                <thclass="text-left">Products</th>
                                <thclass="text-right">Quantity</th>
                                <tht-attf-class="text-right{{'d-noned-sm-table-cell'ifreport_type=='html'else''}}">UnitPrice</th>
                                <tht-if="display_discount"t-attf-class="text-right{{'d-noned-sm-table-cell'ifreport_type=='html'else''}}">
                                    <span>Disc.%</span>
                                </th>
                                <tht-attf-class="text-right{{'d-noned-md-table-cell'ifreport_type=='html'else''}}">
                                    <span>Taxes</span>
                                </th>
                                <thclass="text-right">
                                    <spangroups="account.group_show_line_subtotals_tax_excluded">Amount</span>
                                    <spangroups="account.group_show_line_subtotals_tax_included">TotalPrice</span>
                                </th>
                            </tr>
                        </thead>
                        <tbodyclass="sale_tbody">

                            <tt-set="current_subtotal"t-value="0"/>

                            <tt-foreach="sale_order.order_line"t-as="line">

                                <tt-set="current_subtotal"t-value="current_subtotal+line.price_subtotal"groups="account.group_show_line_subtotals_tax_excluded"/>
                                <tt-set="current_subtotal"t-value="current_subtotal+line.price_total"groups="account.group_show_line_subtotals_tax_included"/>

                                <trt-att-class="'bg-200font-weight-boldo_line_section'ifline.display_type=='line_section'else'font-italico_line_note'ifline.display_type=='line_note'else''">
                                    <tt-if="notline.display_type">
                                        <tdid="product_name"><spant-field="line.name"/></td>
                                        <tdclass="text-right">
                                            <divid="quote_qty">
                                                <spant-field="line.product_uom_qty"/>
                                                <spant-field="line.product_uom"/>
                                            </div>
                                        </td>
                                        <tdt-attf-class="text-right{{'d-noned-sm-table-cell'ifreport_type=='html'else''}}">
                                            <div
                                                t-if="line.discount&gt;=0"
                                                t-field="line.price_unit"
                                                t-att-style="line.discountand'text-decoration:line-through'orNone"
                                                t-att-class="(line.discountand'text-danger'or'')+'text-right'"
                                            />
                                            <divt-if="line.discount">
                                                <tt-esc="(1-line.discount/100.0)*line.price_unit"t-options='{"widget":"float","decimal_precision":"ProductPrice"}'/>
                                            </div>
                                        </td>
                                        <tdt-if="display_discount"t-attf-class="text-right{{'d-noned-sm-table-cell'ifreport_type=='html'else''}}">
                                            <strongt-if="line.discount&gt;0"class="text-info">
                                                <tt-esc="((line.discount%1)and'%s'or'%d')%line.discount"/>%
                                            </strong>
                                        </td>
                                        <tdt-attf-class="text-right{{'d-noned-md-table-cell'ifreport_type=='html'else''}}">
                                            <spant-esc="','.join(map(lambdax:(x.descriptionorx.name),line.tax_id))"/>
                                        </td>
                                        <tdclass="text-right">
                                            <spanclass="oe_order_line_price_subtotal"t-field="line.price_subtotal"groups="account.group_show_line_subtotals_tax_excluded"/>
                                            <spanclass="oe_order_line_price_total"t-field="line.price_total"groups="account.group_show_line_subtotals_tax_included"/>
                                        </td>
                                    </t>
                                    <tt-if="line.display_type=='line_section'">
                                        <tdcolspan="99">
                                            <spant-field="line.name"/>
                                        </td>
                                        <tt-set="current_section"t-value="line"/>
                                        <tt-set="current_subtotal"t-value="0"/>
                                    </t>
                                    <tt-if="line.display_type=='line_note'">
                                        <tdcolspan="99">
                                            <spant-field="line.name"/>
                                        </td>
                                    </t>
                                </tr>

                                <tt-if="current_sectionand(line_lastorsale_order.order_line[line_index+1].display_type=='line_section')">
                                    <trclass="is-subtotaltext-right">
                                        <tdcolspan="99">
                                            <strongclass="mr16">Subtotal</strong>
                                            <span
                                                t-esc="current_subtotal"
                                                t-options='{"widget":"monetary","display_currency":sale_order.pricelist_id.currency_id}'
                                            />
                                        </td>
                                    </tr>
                                </t>
                            </t>
                        </tbody>
                    </table>
                </div>

                <divid="total"class="row"name="total"style="page-break-inside:avoid;">
                    <divt-attf-class="#{'col-6'ifreport_type!='html'else'col-sm-7col-md-6'}ml-auto">
                        <tt-call="sale.sale_order_portal_content_totals_table"/>
                    </div>
                </div>
            </section>

            <sectiont-if="sale_order.signature"id="signature"name="Signature">
                <divclass="rowmt-4"name="signature">
                    <divt-attf-class="#{'col-3'ifreport_type!='html'else'col-sm-7col-md-4'}ml-autotext-center">
                        <h5>Signature</h5>
                        <imgt-att-src="image_data_uri(sale_order.signature)"style="max-height:6rem;max-width:100%;"/>
                        <pt-field="sale_order.signed_by"/>
                    </div>
                </div>
            </section>

            <sectionid="terms"class="mt-5"t-if="sale_order.note">
                <h3class="">Terms&amp;Conditions</h3>
                <hrclass="mt-0mb-1"/>
                <emt-field="sale_order.note"/>
            </section>

            <sectionclass="mt-5"t-if="sale_order.payment_term_id">
                <h3class="">Paymentterms</h3>
                <hrclass="mt-0mb-1"/>
                <spant-field="sale_order.payment_term_id"/>
            </section>
        </div>
    </template>

    <templateid="sale_order_portal_content_totals_table">
        <tableclass="tabletable-sm">
            <trclass="border-black">
                <td><strong>Subtotal</strong></td>
                <tdclass="text-right">
                    <span
                        data-id="total_untaxed"
                        t-field="sale_order.amount_untaxed"
                        t-options='{"widget":"monetary","display_currency":sale_order.pricelist_id.currency_id}'
                    />
                </td>
            </tr>
            <tt-foreach="sale_order.amount_by_group"t-as="amount_by_group">
                <tr>
                    <tt-if="amount_by_group[3]==1andsale_order.amount_untaxed==amount_by_group[2]">
                        <td>
                            <spant-esc="amount_by_group[0]"/>
                            <span>&amp;nbsp;<span>on</span>&amp;nbsp;<tt-esc="amount_by_group[2]"t-options='{"widget":"monetary","display_currency":sale_order.pricelist_id.currency_id}'/></span>
                        </td>
                        <tdclass="text-right">
                            <spant-esc="amount_by_group[1]"
                                t-options='{"widget":"monetary","display_currency":sale_order.pricelist_id.currency_id}'/>
                        </td>
                    </t>
                    <tt-else="">
                        <td>
                            <spant-esc="amount_by_group[0]"/>
                        </td>
                        <tdclass="text-right">
                            <spant-esc="amount_by_group[1]"
                                t-options='{"widget":"monetary","display_currency":sale_order.pricelist_id.currency_id}'/>
                        </td>
                    </t>
                </tr>
            </t>
            <trclass="border-black">
                <td><strong>Total</strong></td>
                <tdclass="text-right">
                    <spandata-id="total_amount"t-field="sale_order.amount_total"t-options='{"widget":"monetary","display_currency":sale_order.pricelist_id.currency_id}'/>
                </td>
            </tr>
        </table>
    </template>
</flectra>
