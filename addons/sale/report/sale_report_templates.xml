<?xmlversion="1.0"encoding="utf-8"?>
<flectra>
<templateid="report_saleorder_document">
    <tt-call="web.external_layout">
        <tt-set="doc"t-value="doc.with_context(lang=doc.partner_id.lang)"/>
        <tt-set="address">
            <divt-field="doc.partner_id"
                t-options='{"widget":"contact","fields":["address","name"],"no_marker":True}'/>
            <pt-if="doc.partner_id.vat"><tt-esc="doc.company_id.country_id.vat_labelor'TaxID'"/>:<spant-field="doc.partner_id.vat"/></p>
        </t>
        <tt-if="doc.partner_shipping_id==doc.partner_invoice_id
                             anddoc.partner_invoice_id!=doc.partner_id
                             ordoc.partner_shipping_id!=doc.partner_invoice_id">
            <tt-set="information_block">
                <strongt-if="doc.partner_shipping_id==doc.partner_invoice_id">InvoicingandShippingAddress:</strong>
                <strongt-if="doc.partner_shipping_id!=doc.partner_invoice_id">InvoicingAddress:</strong>
                <divt-field="doc.partner_invoice_id"
                t-options='{"widget":"contact","fields":["address","name","phone"],"no_marker":True,"phone_icons":True}'/>
                <tt-if="doc.partner_shipping_id!=doc.partner_invoice_id">
                    <strong>ShippingAddress:</strong>
                    <divt-field="doc.partner_shipping_id"
                        t-options='{"widget":"contact","fields":["address","name","phone"],"no_marker":True,"phone_icons":True}'/>
                </t>
            </t>
        </t>
        <divclass="page">
            <divclass="oe_structure"/>

            <h2class="mt16">
                <tt-if="not(env.context.get('proforma',False)oris_pro_forma)">
                    <spant-if="doc.statenotin['draft','sent']">Order#</span>
                    <spant-if="doc.statein['draft','sent']">Quotation#</span>
                </t>
                <tt-if="env.context.get('proforma',False)oris_pro_forma">
                    <span>Pro-FormaInvoice#</span>
                </t>
                <spant-field="doc.name"/>
            </h2>

            <divclass="rowmt32mb32"id="informations">
                <divt-if="doc.client_order_ref"class="col-autocol-3mw-100mb-2">
                    <strong>YourReference:</strong>
                    <pclass="m-0"t-field="doc.client_order_ref"/>
                </div>
                <divt-if="doc.date_orderanddoc.statenotin['draft','sent']"class="col-autocol-3mw-100mb-2">
                    <strong>OrderDate:</strong>
                    <pclass="m-0"t-field="doc.date_order"/>
                </div>
                <divt-if="doc.date_orderanddoc.statein['draft','sent']"class="col-autocol-3mw-100mb-2">
                    <strong>QuotationDate:</strong>
                    <pclass="m-0"t-field="doc.date_order"t-options='{"widget":"date"}'/>
                </div>
                <divt-if="doc.validity_dateanddoc.statein['draft','sent']"class="col-autocol-3mw-100mb-2"name="expiration_date">
                    <strong>Expiration:</strong>
                    <pclass="m-0"t-field="doc.validity_date"/>
                </div>
                <divt-if="doc.user_id.name"class="col-autocol-3mw-100mb-2">
                    <strong>Salesperson:</strong>
                    <pclass="m-0"t-field="doc.user_id"/>
                </div>
            </div>

            <!--Isthereadiscountonatleastoneline?-->
            <tt-set="display_discount"t-value="any(l.discountforlindoc.order_line)"/>

            <tableclass="tabletable-smo_main_table">
                <!--Incasewewanttorepeattheheader,remove"display:table-row-group"-->
                <theadstyle="display:table-row-group">
                    <tr>
                        <thname="th_description"class="text-left">Description</th>
                        <thname="th_quantity"class="text-right">Quantity</th>
                        <thname="th_priceunit"class="text-right">UnitPrice</th>
                        <thname="th_discount"t-if="display_discount"class="text-right"groups="product.group_discount_per_so_line">
                            <span>Disc.%</span>
                        </th>
                        <thname="th_taxes"class="text-right">Taxes</th>
                        <thname="th_subtotal"class="text-right">
                            <spangroups="account.group_show_line_subtotals_tax_excluded">Amount</span>
                            <spangroups="account.group_show_line_subtotals_tax_included">TotalPrice</span>
                        </th>
                    </tr>
                </thead>
                <tbodyclass="sale_tbody">

                    <tt-set="current_subtotal"t-value="0"/>

                    <tt-foreach="doc.order_line"t-as="line">

                        <tt-set="current_subtotal"t-value="current_subtotal+line.price_subtotal"groups="account.group_show_line_subtotals_tax_excluded"/>
                        <tt-set="current_subtotal"t-value="current_subtotal+line.price_total"groups="account.group_show_line_subtotals_tax_included"/>

                        <trt-att-class="'bg-200font-weight-boldo_line_section'ifline.display_type=='line_section'else'font-italico_line_note'ifline.display_type=='line_note'else''">
                            <tt-if="notline.display_type">
                                <tdname="td_name"><spant-field="line.name"/></td>
                                <tdname="td_quantity"class="text-right">
                                    <spant-field="line.product_uom_qty"/>
                                    <spant-field="line.product_uom"/>
                                </td>
                                <tdname="td_priceunit"class="text-right">
                                    <spant-field="line.price_unit"/>
                                </td>
                                <tdt-if="display_discount"class="text-right"groups="product.group_discount_per_so_line">
                                    <spant-field="line.discount"/>
                                </td>
                                <tdname="td_taxes"class="text-right">
                                    <spant-esc="','.join(map(lambdax:(x.descriptionorx.name),line.tax_id))"/>
                                </td>
                                <tdname="td_subtotal"class="text-righto_price_total">
                                    <spant-field="line.price_subtotal"groups="account.group_show_line_subtotals_tax_excluded"/>
                                    <spant-field="line.price_total"groups="account.group_show_line_subtotals_tax_included"/>
                                </td>
                            </t>
                            <tt-if="line.display_type=='line_section'">
                                <tdname="td_section_line"colspan="99">
                                    <spant-field="line.name"/>
                                </td>
                                <tt-set="current_section"t-value="line"/>
                                <tt-set="current_subtotal"t-value="0"/>
                            </t>
                            <tt-if="line.display_type=='line_note'">
                                <tdname="td_note_line"colspan="99">
                                    <spant-field="line.name"/>
                                </td>
                            </t>
                        </tr>

                        <tt-if="current_sectionand(line_lastordoc.order_line[line_index+1].display_type=='line_section')">
                            <trclass="is-subtotaltext-right">
                                <tdname="td_section_subtotal"colspan="99">
                                    <strongclass="mr16">Subtotal</strong>
                                    <span
                                        t-esc="current_subtotal"
                                        t-options='{"widget":"monetary","display_currency":doc.pricelist_id.currency_id}'
                                    />
                                </td>
                            </tr>
                        </t>
                    </t>
                </tbody>
            </table>

            <divclass="clearfix"name="so_total_summary">
                <divid="total"class="row"name="total">
                    <divt-attf-class="#{'col-6'ifreport_type!='html'else'col-sm-7col-md-6'}ml-auto">
                        <tableclass="tabletable-sm">
                            <trclass="border-blacko_subtotal"style="">
                                <tdname="td_amount_untaxed_label"><strong>Subtotal</strong></td>
                                <tdname="td_amount_untaxed"class="text-right">
                                    <spant-field="doc.amount_untaxed"/>
                                </td>
                            </tr>
                            <tt-foreach="doc.amount_by_group"t-as="amount_by_group">
                                <trstyle="">
                                    <tt-if="amount_by_group[5]==1anddoc.amount_untaxed==amount_by_group[2]">
                                        <tdname="td_amount_by_group_label_3">
                                            <spant-esc="amount_by_group[0]"/>
                                            <span>&amp;nbsp;<span>on</span>&amp;nbsp;<tt-esc="amount_by_group[2]"t-options='{"widget":"monetary","display_currency":doc.pricelist_id.currency_id}'/></span>
                                        </td>
                                        <tdname="td_amount_by_group_3"class="text-righto_price_total">
                                            <spant-esc="amount_by_group[1]"
                                                t-options='{"widget":"monetary","display_currency":doc.pricelist_id.currency_id}'/>
                                        </td>
                                    </t>
                                    <tt-else="">
                                        <tdname="td_amount_by_group_label">
                                            <spant-esc="amount_by_group[0]"/>
                                        </td>
                                        <tdname="td_amount_by_group"class="text-righto_price_total">
                                            <spant-esc="amount_by_group[1]"
                                                t-options='{"widget":"monetary","display_currency":doc.pricelist_id.currency_id}'/>
                                        </td>
                                    </t>
                                </tr>
                            </t>
                            <trclass="border-blacko_total">
                                <tdname="td_amount_total_label"><strong>Total</strong></td>
                                <tdname="td_amount_total"class="text-right">
                                    <spant-field="doc.amount_total"/>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <divt-if="doc.signature"class="mt32ml64mr4"name="signature">
                <divclass="offset-8">
                    <strong>Signature</strong>
                </div>
                <divclass="offset-8">
                    <imgt-att-src="image_data_uri(doc.signature)"style="max-height:4cm;max-width:8cm;"/>
                </div>
                <divclass="offset-8text-center">
                    <pt-field="doc.signed_by"/>
                </div>
            </div>

            <divclass="oe_structure"/>

            <pt-field="doc.note"/>
            <pt-if="doc.payment_term_id.note">
                <spant-field="doc.payment_term_id.note"/>
            </p>
            <pid="fiscal_position_remark"t-if="doc.fiscal_position_idanddoc.fiscal_position_id.sudo().note">
                <strong>FiscalPositionRemark:</strong>
                <spant-field="doc.fiscal_position_id.sudo().note"/>
            </p>
        </div>
    </t>
</template>


<templateid="report_saleorder">
    <tt-call="web.html_container">
        <tt-foreach="docs"t-as="doc">
            <tt-call="sale.report_saleorder_document"t-lang="doc.partner_id.lang"/>
        </t>
    </t>
</template>

<templateid="report_saleorder_pro_forma">
    <tt-call="web.html_container">
        <tt-set="is_pro_forma"t-value="True"/>
        <tt-set="docs"t-value="docs.with_context(proforma=True)"/>
        <tt-foreach="docs"t-as="doc">
            <tt-call="sale.report_saleorder_document"t-lang="doc.partner_id.lang"/>
        </t>
    </t>
</template>

</flectra>
