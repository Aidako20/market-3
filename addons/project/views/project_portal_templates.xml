<?xmlversion="1.0"encoding="utf-8"?>
<flectra>
    <templateid="portal_layout"name="Portallayout:projectmenuentry"inherit_id="portal.portal_breadcrumbs"priority="40">
        <xpathexpr="//ol[hasclass('o_portal_submenu')]"position="inside">
            <lit-if="page_name=='project'orproject"class="col-lg-2"t-attf-class="breadcrumb-item#{'active'ifnotprojectelse''}">
                <at-if="project"t-attf-href="/my/projects?{{keep_query()}}">Projects</a>
                <tt-else="">Projects</t>
            </li>
            <lit-if="project"class="breadcrumb-itemactivetext-truncatecol-8col-lg-10">
                <tt-esc="project.name"/>
            </li>
            <lit-if="page_name=='task'ortask"t-attf-class="breadcrumb-item#{'active'ifnottaskelse''}">
                <at-if="task"t-attf-href="/my/tasks?{{keep_query()}}">Tasks</a>
                <tt-else="">Tasks</t>
            </li>
            <lit-if="task"class="breadcrumb-itemactivecol-8col-lg-10text-truncate">
                <spant-field="task.name"/>
            </li>
        </xpath>
    </template>

    <templateid="portal_my_home"name="ShowProjects/Tasks"customize_show="True"inherit_id="portal.portal_my_home"priority="40">
        <xpathexpr="//div[hasclass('o_portal_docs')]"position="inside">
            <tt-call="portal.portal_docs_entry">
                <tt-set="title">Projects</t>
                <tt-set="url"t-value="'/my/projects'"/>
                <tt-set="placeholder_count"t-value="'project_count'"/>
            </t>
            <tt-call="portal.portal_docs_entry">
                <tt-set="title">Tasks</t>
                <tt-set="url"t-value="'/my/tasks'"/>
                <tt-set="placeholder_count"t-value="'task_count'"/>
            </t>
        </xpath>
    </template>

    <templateid="portal_my_projects"name="MyProjects">
        <tt-call="portal.portal_layout">
            <tt-set="breadcrumbs_searchbar"t-value="True"/>

            <tt-call="portal.portal_searchbar">
                <tt-set="title">Projects</t>
            </t>
            <tt-if="notprojects">
                <divclass="alertalert-warningmt8"role="alert">
                    Therearenoprojects.
                </div>
            </t>
            <tt-if="projects"t-call="portal.portal_table">
                <tbody>
                    <trt-foreach="projects"t-as="project">
                        <td>
                            <at-attf-href="/my/project/#{project.id}?{{keep_query()}}"><spant-field="project.name"/></a>
                        </td>
                        <tdclass="text-right">
                            <at-attf-href="/my/tasks?{{keep_query(filterby=project.id)}}">
                                <tt-esc="project.task_count"/>
                                <tt-esc="project.label_tasks"/>
                            </a>
                        </td>
                    </tr>
                </tbody>
            </t>
        </t>
    </template>

    <templateid="portal_my_project"name="MyProject">
        <tt-call="portal.portal_layout">
            <tt-set="o_portal_fullwidth_alert"groups="project.group_project_user">
                <tt-call="portal.portal_back_in_edit_mode">
                    <tt-set="backend_url"t-value="'/web#model=project.project&amp;id=%s&amp;view_type=form'%(project.id)"/>
                </t>
            </t>

            <tt-call="portal.portal_record_layout">
                <tt-set="card_header">
                    <h5class="mb-0">
                        <spant-field="project.name"class="text-truncate"/>
                        <spanclass="float-right">
                            <arole="button"t-attf-href="/my/tasks?filterby=#{project.id}"class="btnbtn-smbtn-secondary">
                                <spanclass="fafa-tasks"role="img"aria-label="Tasks"title="Tasks"/>
                                <spant-esc="project.task_count"/>
                                <spant-field="project.label_tasks"/>
                            </a>
                        </span>
                    </h5>
                </t>
                <tt-set="card_body">
                    <divclass="row">
                        <divt-if="project.partner_id"class="col-12col-md-6mb-2mb-md-0">
                            <h6>Customer</h6>
                            <divclass="row">
                                <divclass="colflex-grow-0pr-3">
                                    <imgt-if="project.partner_id.image_1024"class="rounded-circlemt-1o_portal_contact_img"t-att-src="image_data_uri(project.partner_id.image_1024)"alt="Contact"/>
                                    <imgt-else=""class="rounded-circlemt-1o_portal_contact_img"src="/web/static/src/img/user_menu_avatar.png"alt="Contact"/>
                                </div>
                                <divclass="colpl-sm-0">
                                    <addresst-field="project.partner_id"t-options='{"widget":"contact","fields":["name","email","phone"]}'/>
                                </div>
                            </div>
                        </div>
                        <divt-if="project.user_id"class="col-12col-md-6">
                            <h6>ProjectManager</h6>
                            <divclass="row">
                                <divclass="colflex-grow-0pr-3">
                                    <imgt-if="project.user_id.image_1024"class="rounded-circlemt-1o_portal_contact_img"t-att-src="image_data_uri(project.user_id.image_1024)"alt="Contact"/>
                                    <imgt-else=""class="rounded-circlemt-1o_portal_contact_img"src="/web/static/src/img/user_menu_avatar.png"alt="Contact"/>
                                </div>
                                <divclass="colpl-sm-0">
                                    <addresst-field="project.user_id"t-options='{"widget":"contact","fields":["name","email","phone"]}'/>
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <templateid="portal_my_tasks"name="MyTasks">
        <tt-call="portal.portal_layout">
            <tt-set="breadcrumbs_searchbar"t-value="True"/>

            <tt-call="portal.portal_searchbar">
                <tt-set="title">Tasks</t>
            </t>
            <tt-if="notgrouped_tasks">
                <divclass="alertalert-warningmt8"role="alert">
                    Therearenotasks.
                </div>
            </t>
            <tt-if="grouped_tasks">
                <tt-call="portal.portal_table">
                    <tt-foreach="grouped_tasks"t-as="tasks">
                        <thead>
                            <trt-attf-class="{{'thead-light'ifnotgroupby=='none'else''}}">
                                <thclass="text-left">Ref</th>
                                <tht-if="groupby=='none'">Name</th>
                                <tht-if="groupby=='project'">
                                    <emclass="font-weight-normaltext-muted"><spant-field="tasks[0].sudo().project_id.label_tasks"/>forproject:</em>
                                    <spant-field="tasks[0].sudo().project_id.name"/></th>
                                <tht-if="groupby=='stage'">
                                    <emclass="font-weight-normaltext-muted"><spant-field="tasks[0].sudo().project_id.label_tasks"/>instage:</em>
                                    <spanclass="text-truncate"t-field="tasks[0].sudo().stage_id.name"/></th>
                                <tht-if="groupby!='project'"class="text-center">Project</th>
                                <tht-if="groupby!='stage'"class="text-center">Stage</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tt-foreach="tasks"t-as="task">
                                <tr>
                                    <tdclass="text-left">
                                        #<spant-esc="task.id"/>
                                    </td>
                                    <td>
                                        <at-attf-href="/my/task/#{task.id}?{{keep_query()}}"><spant-field="task.name"/></a>
                                    </td>
                                    <tdt-if="groupby!='project'"class="text-center">
                                        <spanclass="badgebadge-pillbadge-info"title="Currentprojectofthetask"t-esc="task.project_id.name"/>
                                    </td>
                                    <tdt-if="groupby!='stage'"class="text-center">
                                        <spanclass="badgebadge-pillbadge-info"title="Currentstageofthetask"t-esc="task.stage_id.name"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </t>
                </t>
            </t>
        </t>
    </template>

    <templateid="portal_my_task"name="MyTask">
        <tt-call="portal.portal_layout">
            <tt-set="o_portal_fullwidth_alert"groups="project.group_project_user">
                <tt-call="portal.portal_back_in_edit_mode">
                    <tt-set="backend_url"t-value="'/web#model=project.task&amp;id=%s&amp;view_type=form'%(task.id)"/>
                </t>
            </t>

            <tt-call="portal.portal_record_layout">
                <tt-set="card_header">
                    <divclass="rowno-gutters">
                        <divclass="col-12">
                            <h5class="d-flexmb-1mb-md-0row">
                                <spant-field="task.name"class="col-9text-truncate"/>
                                <smallclass="text-mutedd-noned-md-inline">(#<spant-field="task.id"/>)</small>
                                <divclass="col-3col-md-2text-right">
                                    <smallclass="text-right">Status:</small>
                                    <spant-field="task.stage_id.name"class="badgebadge-pillbadge-info"title="Currentstageofthistask"/>
                                </div>
                            </h5>
                        </div>
                    </div>
                </t>
                <tt-set="card_body">
                    <divclass="mb-1"t-if="userintask.sudo().project_id.allowed_user_ids">
                        <strong>Project:</strong><at-attf-href="/my/project/#{task.project_id.id}"t-field="task.project_id.name"/>
                    </div>

                    <divclass="rowmb-4">
                        <divclass="col-12col-md-6mb-1">
                            <strong>Date:</strong><spant-field="task.create_date"t-options='{"widget":"date"}'/>
                        </div>
                        <divclass="col-12col-md-6"t-if="task.date_deadline">
                            <strong>Deadline:</strong><spant-field="task.date_deadline"t-options='{"widget":"date"}'/>
                        </div>
                    </div>

                    <divclass="rowmb-4"t-if="task.user_idortask.partner_id">
                        <divclass="col-12col-md-6pb-2"t-if="task.user_id">
                            <strong>Assignedto</strong>
                            <divclass="row">
                                <divclass="colflex-grow-0pr-3">
                                    <imgt-if="task.user_id.image_1024"class="rounded-circlemt-1o_portal_contact_img"t-att-src="image_data_uri(task.user_id.image_1024)"alt="Contact"/>
                                    <imgt-else=""class="rounded-circlemt-1o_portal_contact_img"src="/web/static/src/img/user_menu_avatar.png"alt="Contact"/>
                                </div>
                                <divclass="colpl-md-0">
                                    <divt-field="task.user_id"t-options='{"widget":"contact","fields":["name","email","phone"]}'/>
                                </div>
                            </div>
                        </div>
                        <divclass="coll-12col-md-6pb-2"t-if="task.partner_id">
                            <strong>Reportedby</strong>
                            <divclass="row">
                                <divclass="colflex-grow-0pr-3">
                                    <imgt-if="task.partner_id.image_1024"class="rounded-circlemt-1o_portal_contact_img"t-att-src="image_data_uri(task.partner_id.image_1024)"alt="Contact"/>
                                    <imgt-else=""class="rounded-circlemt-1o_portal_contact_img"src="/web/static/src/img/user_menu_avatar.png"alt="Contact"/>
                                </div>
                                <divclass="colpl-md-0">
                                    <divt-field="task.partner_id"t-options='{"widget":"contact","fields":["name","email","phone"]}'/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <divclass="row"t-if="task.descriptionortask.attachment_ids">
                        <divt-if="task.description"t-attf-class="col-12col-lg-7mb-4mb-md-0{{'col-lg-7'iftask.attachment_idselse'col-lg-12'}}">
                            <hrclass="mb-1"/>
                            <divclass="d-flexmy-2">
                                <strong>Description</strong>
                            </div>
                            <divclass="py-1px-2bg-100small"t-field="task.description"/>
                        </div>
                        <divt-if="task.attachment_ids"t-attf-class="col-12col-lg-5o_project_portal_attachments{{'col-lg-5'iftask.descriptionelse'col-lg-12'}}">
                            <hrclass="mb-1d-noned-lg-block"/>
                            <strongclass="d-blockmb-2">Attachments</strong>
                            <divclass="row">
                                <divt-attf-class="col{{'col-lg-6'ifnottask.descriptionelse'col-lg-12'}}">
                                    <ulclass="list-group">
                                        <aclass="list-group-itemlist-group-item-actiond-flexalign-items-centeroe_attachmentspy-1px-2"t-foreach='task.attachment_ids't-as='attachment't-attf-href="/web/content/#{attachment.id}?download=true&amp;access_token=#{attachment.access_token}"target="_blank"data-no-post-process="">
                                            <divclass='oe_attachment_embeddedo_imageo_image_smallmr-2mr-lg-3't-att-title="attachment.name"t-att-data-mimetype="attachment.mimetype"t-attf-data-src="/web/image/#{attachment.id}/50x40?access_token=#{attachment.access_token}"/>
                                            <divclass='oe_attachment_nametext-truncate'><tt-esc='attachment.name'/></div>
                                        </a>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
            </t>

            <divclass="mt32">
                <h4><strong>Messageandcommunicationhistory</strong></h4>
                <tt-call="portal.message_thread">
                    <tt-set="object"t-value="task"/>
                    <tt-set="token"t-value="task.access_token"/>
                    <tt-set="pid"t-value="pid"/>
                    <tt-set="hash"t-value="hash"/>
                </t>
            </div>
        </t>
    </template>
</flectra>
