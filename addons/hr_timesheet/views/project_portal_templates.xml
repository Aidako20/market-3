<?xmlversion="1.0"encoding="utf-8"?>
<flectra>

    <templateid="portal_my_task"inherit_id="project.portal_my_task"name="Portal:MyTaskwithTimesheets">
        <xpathexpr="//t[@t-set='card_body']"position="inside">
            <divclass="container"t-if="timesheets">
                <hrclass="mt-4mb-1"/>
                <h5class="mt-2mb-2">Timesheets</h5>
                <tt-call="hr_timesheet.portal_timesheet_table"/>
            </div>
            <tt-if="timesheets_by_subtask">
                <tt-call="hr_timesheet.portal_subtask_timesheet_tables"/>
            </t>
        </xpath>
    </template>

    <templateid="portal_timesheet_table"name="PortalTimesheetTable">
        <tableclass="tabletable-sm">
            <thead>
              <tr>
                <th>Date</th>
                <th>Employee</th>
                <th>Description</th>
                <tht-if="is_uom_day"class="text-right">Duration(Days)</th>
                <tht-else=""class="text-right">Duration(Hours)</th>
              </tr>
            </thead>
            <trt-foreach="timesheets"t-as="timesheet">
                <td><tt-esc="timesheet.date"t-options='{"widget":"date"}'/></td>
                <td><tt-esc="timesheet.employee_id.name"/></td>
                <td><tt-esc="timesheet.name"/></td>
                <tdclass="text-right">
                    <spant-if="is_uom_day"t-esc="timesheet._get_timesheet_time_day()"t-options='{"widget":"timesheet_uom"}'/>
                    <spant-else=""t-field="timesheet.unit_amount"t-options='{"widget":"float_time"}'/>
                </td>
            </tr>
            <tfoot>
                <tr>
                    <thcolspan="3"></th>
                    <thclass="text-right">TotalHours:<spant-esc="round(sum(timesheets.mapped('unit_amount')),2)"t-options='{"widget":"float_time"}'/></th>
                </tr>            
            </tfoot>
        </table>
    </template>

    <templateid="portal_subtask_timesheet_tables"name="PortalSubtaskTimesheetTables">
        <tt-foreach="timesheets_by_subtask.values()"t-as="timesheets">
            <tt-set="total_hours"t-value="round(sum(timesheets.mapped('unit_amount')),2)"/>
            <tt-if="total_hours&gt;0">
                <divclass="container">
                    <hrclass="mt-4mb-1"/>
                    <h5class="mt-2mb-2">Timesheetsforsub-task:<tt-esc="timesheets[0].task_id.name"/></h5>
                    <tableclass="tabletable-sm">
                        <thead>
                          <tr>
                            <th>Date</th>
                            <th>Employee</th>
                            <th>Description</th>
                            <thclass="text-right">Duration</th>
                          </tr>
                        </thead>
                        <trt-foreach="timesheets"t-as="timesheet">
                            <td><tt-esc="timesheet.date"t-options='{"widget":"date"}'/></td>
                            <td><tt-esc="timesheet.employee_id.name"/></td>
                            <td><tt-esc="timesheet.name"/></td>
                            <tdclass="text-right"><spant-field="timesheet.unit_amount"t-options='{"widget":"float_time"}'/></td>
                        </tr>
                        <tfoot>
                            <tr>
                                <thclass="text-right"colspan="3"></th>
                                <thclass="text-right">TotalHours:<spant-esc="total_hours"t-options='{"widget":"float_time"}'/></th>
                            </tr>            
                        </tfoot>
                    </table>
                </div>
            </t>
        </t>
    </template>

</flectra>
