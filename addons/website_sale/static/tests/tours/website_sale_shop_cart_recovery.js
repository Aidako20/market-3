flectra.define('website_sale.tour_shop_cart_recovery',function(require){
'usestrict';

varlocalStorage=require('web.local_storage');
varrpc=require('web.rpc');
vartour=require('web_tour.tour');
require('web.dom_ready');

varorderIdKey='website_sale.tour_shop_cart_recovery.orderId';
varrecoveryLinkKey='website_sale.tour_shop_cart_recovery.recoveryLink';

tour.register('shop_cart_recovery',{
    test:true,
    url:'/shop?search=AcousticBlocScreens',
},
[
    {
        content:"selectAcousticBlocScreens",
        trigger:'.oe_product_carta:containsExact("AcousticBlocScreens")',
    },
    {
        content:"clickaddtocart",
        trigger:'#product_details#add_to_cart',
    },
    {
        content:"checkproductisincart,getcartid,logout,gotologin",
        trigger:'td.td-product_name:contains("AcousticBlocScreens")',
        run:function(){
            varorderId=$('.my_cart_quantity').data('order-id');
            localStorage.setItem(orderIdKey,orderId);
            window.location.href="/web/session/logout?redirect=/web/login";
        },
    },
    {
        content:"loginasadminandgototheSO(backend)",
        trigger:'.oe_login_form',
        run:function(){
            varorderId=localStorage.getItem(orderIdKey);
            varurl="/web#action=sale.action_orders&view_type=form&id="+orderId;
            var$loginForm=$('.oe_login_form');
            $loginForm.find('input[name="login"]').val("admin");
            $loginForm.find('input[name="password"]').val("admin");
            $loginForm.find('input[name="redirect"]').val(url);
            $loginForm.submit();
        },
    },
    {
        content:"clickaction",
        trigger:'.o_dropdown_toggler_btn:contains("Action")',
    },
    {
        content:"clickSendaCartRecoveryEmail",
        trigger:'a:containsExact("SendaCartRecoveryEmail")',
    },
    {
        content:"clickSendemail",
        trigger:'.btn[name="action_send_mail"]',
    },
    {
        content:"checkthemailissent,grabtherecoverylink,andlogout",
        trigger:'.o_Message_contenta:containsExact("Resumeorder")',
        run:function(){
            varlink=$('.o_Message_contenta:containsExact("Resumeorder")').attr('href');
            localStorage.setItem(recoveryLinkKey,link);
            window.location.href="/web/session/logout?redirect=/";
        }
    },
    {
        content:"gototherecoverylink",
        trigger:'a[href="/web/login"]',
        run:function(){
            window.location.href=localStorage.getItem(recoveryLinkKey);
        },
    },
    {
        content:"checkthepageisworking,clickonrestore",
        extra_trigger:'p:contains("Thisisyourcurrentcart")',
        trigger:'p:contains("restore")a:contains("Clickhere")',
    },
    {
        content:"checkproductisinrestoredcart",
        trigger:'td.td-product_name:contains("AcousticBlocScreens")',
        run:function(){},
    },
]);
});
