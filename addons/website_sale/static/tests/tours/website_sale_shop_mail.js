flectra.define('website_sale.tour_shop_mail',function(require){
'usestrict';

varrpc=require('web.rpc');
vartour=require('web_tour.tour');

require('web.dom_ready');

tour.register('shop_mail',{
    test:true,
    url:'/',
},
[
    {
        content:"Changethedomainofthewebsitesandgotoshop",
        trigger:'body',
        run:function(){
            //Wechangethedomainofthewebsitetotestthattheemailthat
            //willbesentusesthecorrectdomainforitslinks.
            vardef1=rpc.query({
                'model':'website',
                'method':'write',
                'args':[[1],{
                    'domain':"my-test-domain.com",
                }],
            });
            //Weneedtochangethedomainofallthewebsitesotherwisethe
            //websiteselectorwillreturnthewebsite2sincethedomainwe
            //setonwebsite1doesn'tactuallymatchourtestserver.
            vardef2=rpc.query({
                'model':'website',
                'method':'write',
                'args':[[2],{
                    'domain':"https://domain-not-used.fr",
                }],
            });
            Promise.all([def1,def2]).then(function(data){
                window.location.href='/shop?search=AcousticBlocScreens';
            });
        },
    },
    {
        content:"selectAcousticBlocScreens",
        trigger:'.oe_product_carta:containsExact("AcousticBlocScreens")',
    },
    {
        content:"clickaddtocart",
        trigger:'#product_details#add_to_cart',
    },
    {
        content:"checkproductisincart,getcartid,gotobackend",
        trigger:'td.td-product_name:contains("AcousticBlocScreens")',
        run:function(){
            varorderId=$('.my_cart_quantity').data('order-id');
            window.location.href="/web#action=sale.action_orders&view_type=form&id="+orderId;
        },
    },
    {
        content:"clickconfirm",
        trigger:'.btn[name="action_confirm"]',
    },
    {
        content:"clicksendbyemail",
        trigger:'.btn[name="action_quotation_send"]',
        extra_trigger:'.o_statusbar_status.btn-primary:contains("SalesOrder")',
    },
    {
        content:"Openrecipientsdropdown",
        trigger:'.o_field_many2one[name="partner_ids"].ui-autocomplete-input',
        run:'click',
    },
    {
        content:"Selectazureinterior",
        trigger:'.ui-menu-itema:contains(Interior24)',
        in_modal:false,
    },
    {
        content:"clickSendemail",
        trigger:'.btn[name="action_send_mail"]',
        extra_trigger:'.o_badge_text:contains("Azure")',
    },
    {
        content:"waitmailtobesent,andgoseeit",
        trigger:'.o_Message_content:contains("Your"):contains("order")',
        run:function(){
            window.location.href="/web#action=mail.action_view_mail_mail&view_type=list";
        },
    },
    {
        content:"clickonthefirstemail",
        trigger:'.o_data_cell:contains("(RefS")',
    },
    {
        content:"checkit'sthecorrectemail,andtheURLiscorrecttoo",
        trigger:'div.oe_form_field_html[name="body_html"]p:contains("Your"):contains("order")',
        extra_trigger:'div.oe_form_field_html[name="body_html"]a[href^="http://my-test-domain.com"]',
    },
]);
});
