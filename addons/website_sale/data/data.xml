<?xmlversion="1.0"encoding="utf-8"?>
<flectra>
    <datanoupdate="1">

        <recordid="menu_shop"model="website.menu">
            <fieldname="name">Shop</field>
            <fieldname="url">/shop</field>
            <fieldname="parent_id"ref="website.main_menu"/>
            <fieldname="sequence"type="int">20</field>
        </record>
        <recordid="action_open_website"model="ir.actions.act_url">
            <fieldname="name">WebsiteShop</field>
            <fieldname="target">self</field>
            <fieldname="url">/shop</field>
        </record>
        <recordid="base.open_menu"model="ir.actions.todo">
            <fieldname="action_id"ref="action_open_website"/>
            <fieldname="state">open</field>
        </record>

        <recordid="website_sale.sale_ribbon"model="product.ribbon">
            <fieldname="html">Sale</field>
            <fieldname="html_class">bg-successo_ribbon_left</field>
        </record>

        <recordid="website_sale.sold_out_ribbon"model="product.ribbon">
            <fieldname="html">Soldout</field>
            <fieldname="html_class">bg-dangero_ribbon_left</field>
        </record>

        <recordid="website_sale.new_ribbon"model="product.ribbon">
            <fieldname="html">New!</field>
            <fieldname="html_class">bg-primaryo_ribbon_left</field>
        </record>

        <recordid="sales_team.salesteam_website_sales"model="crm.team">
            <fieldname="active"eval="True"/>
        </record>

        <recordmodel="website"id="website.default_website">
            <fieldname="salesteam_id"ref="sales_team.salesteam_website_sales"/>
        </record>

        <recordmodel="product.pricelist"id="product.list0">
            <fieldname="selectable"eval="True"/>
            <fieldname="website_id"eval="False"/>
        </record>

    </data>
    <data>
        <!--ActionServerforDynamicFilter-->
        <recordid="dynamic_snippet_products_action"model="ir.actions.server">
            <fieldname="name">ProductsDynamicSnippet</field>
            <fieldname="model_id"ref="model_product_product"/>
            <fieldname="state">code</field>
            <fieldname="code">
ProductProduct=model.env['product.product']
FieldMonetary=model.env['ir.qweb.field.monetary']

website=request.website.get_current_website()
dynamic_filter=model.env.context.get('dynamic_filter')
limit=model.env.context.get('limit')
search_domain=model.env.context.get('search_domain')
get_rendering_data_structure=model.env.context.get('get_rendering_data_structure')
escape=dynamic_filter.escape_falsy_as_empty

domain=[('website_published','=',True)]+website.website_domain()+(search_domainor[])
products=ProductProduct.search(domain,limit=limit)
_=products.mapped('name')

monetary_options={
    'display_currency':request.website.get_current_pricelist().currency_id,
}

max_nb_chars=100
res_products=[]
forproductinproducts:
    res_product=product._read_format(['id','name','website_url','description_sale'])[0]
    res_product.update(product._get_combination_info_variant())

    ifres_product['description_sale']andlen(res_product['description_sale'])>max_nb_chars:
        res_product['description_sale']="%s..."%res_product['description_sale'][:max_nb_chars]
    res_product['list_price']=FieldMonetary.value_to_html(res_product['price'],monetary_options)
    data=get_rendering_data_structure()
    forfield_nameindynamic_filter.field_names.split(","):
        field=ProductProduct._fields.get(field_name)
        iffieldandfield.type=='binary':
            data['image_fields'][field_name]=escape(website.image_url(product,field_name))
        eliffield_name=='list_price':
            data['fields'][field_name]=res_product[field_name]
        else:
            data['fields'][field_name]=escape(res_product[field_name])
    data['fields']['call_to_action_url']=escape(product['website_url'])
    res_products.append(data)

response=res_products
            </field>
        </record>
        <!--DynamicFilter-->
        <recordid="dynamic_filter_demo_products"model="website.snippet.filter">
            <fieldname="action_server_id"ref="website_sale.dynamic_snippet_products_action"/>
            <fieldname="field_names">display_name,description_sale,image_512,list_price</field>
            <fieldname="limit"eval="16"/>
            <fieldname="name">Products</field>
            <fieldname="website_id"ref="website.default_website"/>
        </record>
        <functionmodel="ir.model.fields"name="formbuilder_whitelist">
            <value>sale.order</value>
            <valueeval="[
                'client_order_ref',
            ]"/>
        </function>

        <recordid="base.model_res_partner"model="ir.model">
            <fieldname="website_form_key">create_customer</field>
            <fieldname="website_form_access">True</field>
            <fieldname="website_form_label">CreateaCustomer</field>
        </record>
        <functionmodel="ir.model.fields"name="formbuilder_whitelist">
            <value>res.partner</value>
            <valueeval="[
                'name','phone','email',
                'city','zip','street','street2','state_id','country_id',
                'vat','company_name'
            ]"/>
        </function>
    </data>
</flectra>
