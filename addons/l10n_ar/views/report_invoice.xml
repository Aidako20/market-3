<?xmlversion="1.0"encoding="utf-8"?>
<flectra>

    <!--thisheadercanbeusedonanyArgentineanreport,tobeusefulsomevariablesshouldbepassed-->
    <templateid="custom_header">
        <div>
            <divclass="row">
                <divname="left-upper-side"class="col-5"t-if="notpre_printed_report">
                    <imgt-if="o.company_id.logo"t-att-src="image_data_uri(o.company_id.logo)"style="max-height:45px;"alt="Logo"/>
                </div>
                <divname="center-upper"class="col-2text-center"t-att-style="'color:%s;'%o.company_id.primary_color">
                    <spanstyle="display:inline-block;text-align:center;line-height:8px;">
                        <h1style="line-height:25px;">
                            <strong><spant-esc="notpre_printed_reportanddocument_letteror'&#160;'"/></strong>
                        </h1>
                        <spanstyle="font-size:x-small;"t-esc="notpre_printed_reportanddocument_legendor'&#160;'"/>
                    </span>
                </div>
                <divname="right-upper-side"class="col-5text-right"style="padding-left:0px;"t-if="notpre_printed_report">

                    <!--(6)TitulodeDocumento-->
                    <h4t-att-style="'color:%s;'%o.company_id.primary_color"><strong>
                        <spant-esc="report_name"/>
                    </strong></h4>

                </div>
            </div>
            <divclass="row">
                <divclass="col-6"style="padding-right:0px;">
                    <tt-if="notpre_printed_report">
                        <!--(1)NombredeFantasia-->
                        <!--(2)ApellidoyNombreoRazonSocial-->
                        <spant-field="o.company_id.partner_id.name"/>

                        <!--(3)DomicilioComercial(DomicilioFiscalisthesame)-->
                        <br/>
                        <div></div>
                        <!--wedontusetheaddresswidgetasitaddsanewlineonthephoneandwewanttoreduceatmaximumlinesqty-->
                        <tt-esc="'-'.join([itemforitemin[
                            ','.join([itemforitemin[header_address.street,header_address.street2]ifitem]),
                            header_address.city,
                            header_address.state_idandheader_address.state_id.name,
                            header_address.zip,
                            header_address.country_idandheader_address.country_id.name]ifitem])"/><spant-if="header_address.phone">-</span><spant-if="header_address.phone"style="white-space:nowrap;"t-esc="'Tel:'+header_address.phone"/>
                        <br/>
                        <spant-att-style="'color:%s;'%o.company_id.primary_color"t-esc="'-'.join([itemforitemin[(header_address.websiteor'').replace('https://','').replace('http://',''),header_address.email]ifitem])"/>
                    </t>
                </div>
                <divclass="col-6text-right"style="padding-left:0px;">

                    <tt-if="notpre_printed_report">
                        <!--(7)Numeropuntoventa-(8)numerodedocumento-->
                        <spant-att-style="'color:%s;'%o.company_id.secondary_color">Nro:</span><spant-esc="report_number"/>
                    </t>
                    <br/>

                    <!--(9)Fecha-->
                    <spant-att-style="'color:%s;'%o.company_id.secondary_color">Date:</span><spant-esc="report_date"t-options='{"widget":"date"}'/>

                    <tt-if="notpre_printed_report">
                        <!--(5)CondiciondeIVA/Responsabilidad-->
                        <!--(10)CUIT-->
                        <br/>
                        <spant-field="o.company_id.l10n_ar_afip_responsibility_type_id"/><spant-att-style="'color:%s;'%o.company_id.secondary_color">-CUIT:</span><spant-field="o.company_id.partner_id.l10n_ar_formatted_vat"/>

                        <!--(11)IIBB:-->
                        <!--(12)Iniciodeactividades-->
                        <br/><spant-att-style="'color:%s;'%o.company_id.secondary_color">IIBB:</span><spant-esc="o.company_id.l10n_ar_gross_income_type=='exempt'and'Exento'oro.company_id.l10n_ar_gross_income_number"/><spant-att-style="'color:%s;'%o.company_id.secondary_color">-ActivitiesStart:</span><spant-field="o.company_id.l10n_ar_afip_start_date"/>
                    </t>

                </div>
            </div>
        </div>
    </template>

    <templateid="report_invoice_document"inherit_id="account.report_invoice_document"primary="True">
      <!--customheaderandfooter-->
        <tt-set="o"position="after">
            <tt-set="custom_header"t-value="'l10n_ar.custom_header'"/>
            <tt-set="report_date"t-value="o.invoice_date"/>
            <tt-set="report_number"t-value="o.l10n_latam_document_number"/>
            <tt-set="pre_printed_report"t-value="report_type=='pdf'ando.journal_id.l10n_ar_afip_pos_system=='II_IM'"/>
            <tt-set="document_letter"t-value="o.l10n_latam_document_type_id.l10n_ar_letter"/>
            <tt-set="document_legend"t-value="o.l10n_latam_document_type_id.codeand'Cod.%02d'%int(o.l10n_latam_document_type_id.code)or''"/>
            <tt-set="report_name"t-value="o.l10n_latam_document_type_id.report_name"/>
            <tt-set="header_address"t-value="o.journal_id.l10n_ar_afip_pos_partner_id"/>

            <tt-set="custom_footer">
                <divclass="row">
                    <divname="footer_left_column"class="col-8text-left">
                    </div>
                    <divname="footer_right_column"class="col-4text-right">
                        <divname="pager"t-if="report_type=='pdf'">
                            Page:<spanclass="page"/>/<spanclass="topage"/>
                        </div>
                    </div>
                </div>
            </t>
            <tt-set="fiscal_bond"t-value="o.journal_id.l10n_ar_afip_pos_systemin['BFERCEL','BFEWS']"/>
        </t>

        <!--removedefaultpartneraddress-->
        <tt-set="address"position="replace"/>

        <!--removedefaultdocumenttitle-->
        <h2position="replace"/>

        <!--NCMcolumnforfiscalbond-->
        <thname="th_description"position="after">
            <tht-if="fiscal_bond"name="th_ncm_code"class="text-left"><span>NCM</span></th>
        </th>
        <tdname="account_invoice_line_name"position="after">
            <tdt-if="fiscal_bond"name="ncm_code"><spant-field="line.product_id.l10n_ar_ncm_code"/></td>
        </td>

        <!--uselatamprices(toinclude/excludeVAT)-->
        <xpathexpr="//span[@t-field='line.price_unit']"position="attributes">
            <attributename="t-field">line.l10n_latam_price_unit</attribute>
        </xpath>
        <xpathexpr="//span[@id='line_tax_ids']"position="attributes">
            <attributename="t-esc">','.join(map(lambdax:(x.descriptionorx.name),line.l10n_latam_tax_ids))</attribute>
        </xpath>
        <tt-set="current_subtotal"t-value="current_subtotal+line.price_subtotal"position="attributes">
            <attributename="t-value">current_subtotal+line.l10n_latam_price_subtotal</attribute>
        </t>
        <!--ifb2cwestillwantsthelatamsubtotal-->
        <tt-set="current_subtotal"t-value="current_subtotal+line.price_total"position="attributes">
            <attributename="t-value">current_subtotal+line.l10n_latam_price_subtotal</attribute>
        </t>
        <!--labelamountforsubtotalcolumnonb2bandb2c-->
        <xpathexpr="//th[@name='th_subtotal']/span[@groups='account.group_show_line_subtotals_tax_included']"position="replace">
            <spangroups="account.group_show_line_subtotals_tax_included">Amount</span>
        </xpath>
        <spant-field="line.price_subtotal"position="attributes">
            <attributename="t-field">line.l10n_latam_price_subtotal</attribute>
        </span>
        <!--ifb2cwestillwantsthelatamsubtotal-->
        <spant-field="line.price_total"position="attributes">
            <attributename="t-field">line.l10n_latam_price_subtotal</attribute>
        </span>
        <spant-field="o.amount_untaxed"position="attributes">
            <attributename="t-field">o.l10n_latam_amount_untaxed</attribute>
        </span>

        <!--usecolumnvatinsteadoftaxesandonlyifvatdiscriminated-->
        <xpathexpr="//th[@name='th_taxes']/span"position="replace">
            <span>%VAT</span>
        </xpath>

        <xpathexpr="//th[@name='th_taxes']"position="attributes">
            <attributename="t-if">o.amount_by_group</attribute>
        </xpath>

        <!--usecolumnvatinsteadoftaxesandonlylistvattaxes-->
        <xpathexpr="//span[@id='line_tax_ids']/.."position="attributes">
            <attributename="t-if">o.amount_by_group</attribute>
        </xpath>
        <spanid="line_tax_ids"position="attributes">
            <attributename="t-esc">','.join(map(lambdax:(x.descriptionorx.name),line.l10n_latam_tax_ids.filtered(lambdax:x.tax_group_id.l10n_ar_vat_afip_code)))</attribute>
        </span>

        <!--removepaymentreferencethatisnotusedinArgentina-->
        <xpathexpr="//span[@t-field='o.payment_reference']/../.."position="replace"/>

        <!--replaceinformationsectionandusageargentineanstyle-->
        <divid="informations"position="replace">
            <divid="informations"class="rowmt8mb8">
                <divclass="col-6">

                    <!--IDENTIFICACION(ADQUIRIENTE-LOCATARIO-PRESTARIO)-->

                    <!--(14)ApellidouyNombre:DenominicacionoRazonSoclial-->
                    <strong>Customer:</strong><spant-field="o.partner_id.commercial_partner_id.name"/>

                    <!--(15)DomicilioComercial-->
                    <br/>
                    <spant-field="o.partner_id"t-options="{'widget':'contact','fields':['address'],'no_marker':true,'no_tag_br':True}"/>

                    <!--(16)ResponsabilidadAFIP-->
                    <strong>VATCond:</strong><spant-field="o.partner_id.l10n_ar_afip_responsibility_type_id"/>

                    <!--(17)CUIT-->
                    <tt-if="o.partner_id.vatando.partner_id.l10n_latam_identification_type_idando.partner_id.l10n_latam_identification_type_id.l10n_ar_afip_code!='99'">
                        <br/><strong><tt-esc="o.partner_id.l10n_latam_identification_type_id.nameoro.company_id.country_id.vat_label"id="inv_tax_id_label"/>:</strong><spant-esc="o.partner_id.l10n_ar_formatted_vatifo.partner_id.l10n_ar_vatelseo.partner_id.vat"/>
                    </t>

                </div>
                <divclass="col-6">

                    <tt-if="o.invoice_date_due">
                        <strong>DueDate:</strong>
                        <spant-field="o.invoice_date_due"/>
                    </t>

                    <tt-if="o.invoice_payment_term_id"name="payment_term">
                        <br/><strong>PaymentTerms:</strong><spant-field="o.invoice_payment_term_id.name"/>
                    </t>

                    <tt-if="o.invoice_origin">
                        <br/><strong>Source:</strong>
                        <spant-field="o.invoice_origin"/>
                    </t>

                    <tt-if="o.ref">
                        <br/><strong>Reference:</strong>
                        <spant-field="o.ref"/>
                    </t>

                    <!--(18)REMITOS-->
                    <!--Wedonothaveremitosimplementyet.printheretheremitonumberwhenwehaveit-->

                    <tt-if="o.invoice_incoterm_id">
                        <br/><strong>Incoterm:</strong><spant-field="o.invoice_incoterm_id.name"/>
                    </t>

                </div>

            </div>
        </div>

        <!-- weremovethemlautoandalsogivemorespacetoavoidmultiplelinesontaxdetail-->
        <xpathexpr="//div[@id='total']/div"position="attributes">
            <attributename="t-attf-class">#{'col-6'ifreport_type!='html'else'col-sm-7col-md-6'}</attribute>
        </xpath>

        <xpathexpr="//div[@id='total']/div"position="before">
            <divt-attf-class="#{'col-6'ifreport_type!='html'else'col-sm-7col-md-6'}">

                <tt-if="o.l10n_ar_afip_conceptin['2','3','4']ando.l10n_ar_afip_service_startando.l10n_ar_afip_service_end">
                    <strong>Invoicedperiod:</strong><spant-field="o.l10n_ar_afip_service_start"/>to<spant-field="o.l10n_ar_afip_service_end"/>
                </t>
                <tt-if="o.currency_id!=o.company_id.currency_id">
                    <br/><strong>Currency:</strong><spant-esc="'%s-%s'%(o.currency_id.name,o.currency_id.currency_unit_label)"/>
                    <br/><strong>Exchangerate:</strong><spant-field="o.l10n_ar_currency_rate"/>
                </t>
                <!--ShowCBUforFACTURADECREDITOELECTRONICAMiPyMEsandNOTADEDEBITOELECTRONICAMiPyMEs-->
                <tt-if="o.l10n_latam_document_type_id.codein['201','206','211','202','207','212']ando.partner_bank_id">
                    <br/><strong>CBUforpayment:</strong><spant-esc="o.partner_bank_id.acc_numberor''ifo.partner_bank_id.acc_type=='cbu'else''"/>
                </t>

            </div>
        </xpath>

        <!--ShowtotalamountinlettersforMiPyMEsdocumenttypesaccordingtothelaw
         http://biblioteca.afip.gob.ar/dcp/LEY_C_027440_2018_05_09article5.f-->
        <xpathexpr="//div[@id='total']/div/table"position="after">
            <tt-if="o.l10n_latam_document_type_id.codein['201','202','203','206','207','208','211','212','213']">
                <strong>Son:</strong><spant-esc="o.currency_id.with_context(lang='es_AR').amount_to_text(o.amount_total)"/>
            </t>
        </xpath>

        <!--RG5003:Addlegendfor'A'documentsthathaveaMonotribuistareceptor-->
        <pname="comment"position="after">
            <pt-if="o.partner_id.l10n_ar_afip_responsibility_type_id.codein['6','13']ando.l10n_latam_document_type_id.l10n_ar_letter=='A'">
                Elcréditofiscaldiscriminadoenelpresentecomprobante,sólopodrásercomputadoaefectosdelRégimendeSostenimientoeInclusiónFiscalparaPequeñosContribuyentesdelaLeyNº27.618
            </p>
        </p>

    </template>

    <!--FIXME:Tempfixtoallowfetchinginvoice_documemtinStudioReportswithlocalisation-->
    <templateid="report_invoice"inherit_id="account.report_invoice">
        <xpathexpr='//t[@t-call="account.report_invoice_document"]'position="after">
            <tt-if="o._get_name_invoice_report()=='l10n_ar.report_invoice_document'"
                t-call="l10n_ar.report_invoice_document"t-lang="lang"/>
        </xpath>
    </template>

    <templateid="report_invoice_with_payments"inherit_id="account.report_invoice_with_payments">
        <xpathexpr='//t[@t-call="account.report_invoice_document"]'position="after">
            <tt-if="o._get_name_invoice_report()=='l10n_ar.report_invoice_document'"
                t-call="l10n_ar.report_invoice_document"t-lang="lang"/>
        </xpath>
    </template>

</flectra>
