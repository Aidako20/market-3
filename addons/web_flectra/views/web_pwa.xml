<?xml version="1.0" encoding="utf-8" ?>
<flectra>
    <template id="web_layout_pwa" name="Web layout PWA" inherit_id="web.layout">
        <xpath expr="//meta[@name='viewport']" position="after">
            <!-- Add link rel manifest -->
            <link rel="manifest" href="/manifest.json" />
            <!-- Add iOS meta tags and icons -->
            <meta name="apple-mobile-web-app-capable" content="yes" />
            <meta name="apple-mobile-web-app-status-bar-style" content="black" />
            <meta name="apple-mobile-web-app-title" content="Flectra" />
            <link
                rel="apple-touch-icon"
                href="/web_flectra/static/src/img/icons/icon-152x152.png"
            />
            <!-- Add meta theme-color -->
            <meta name="theme-color" content="#009efb" />
        </xpath>
    </template>
    <template id="service_worker" name="PWA service worker">
'use strict';
const CACHE_NAME = '<t t-esc="pwa_cache_name" />';
const FILES_TO_CACHE = [
  <t t-foreach="pwa_files_to_cache" t-as="file_to_cache">
      '<t t-esc="file_to_cache" />',
  </t>
];
self.addEventListener('install', function (evt) {
  console.log('[ServiceWorker] Install');
  evt.waitUntil(
   caches.open(CACHE_NAME).then(function (cache) {
       console.log('[ServiceWorker] Pre-caching offline page');
       return cache.addAll(FILES_TO_CACHE);
   })
  );
  self.skipWaiting();
});
self.addEventListener('activate', function(evt) {
  console.log('[ServiceWorker] Activate');
   evt.waitUntil(
       caches.keys().then(function(keyList) {
           return Promise.all(keyList.map(function(key) {
               if (key !== CACHE_NAME) {
                   console.log('[ServiceWorker] Removing old cache', key);
                   return caches.delete(key);
               }
           }));
       })
   );
  self.clients.claim();
});
self.addEventListener('fetch', function(evt) {
  if (evt.request.cache === 'only-if-cached' &amp;&amp; evt.request.mode !== 'same-origin') {
    return;
  }
   evt.respondWith(
       caches.open(CACHE_NAME).then(function(cache) {
           return cache.match(evt.request)
               .then(function(response) {
                   return response || fetch(evt.request);
                });
       })
   );
});
    </template>
</flectra>
