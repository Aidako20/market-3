<templatesid="template"xml:space="preserve">

    <tt-name="portal.chatter_message_count">
        <tt-set="count"t-value="widget.get('message_count')"/>
        <divclass="o_message_counter">
            <tt-if="count">
                <spanclass="fafa-comments"/>
                <spanclass="o_message_count"><tt-esc="count"/></span>
                <tt-if="count==1">comment</t>
                <tt-else="">comments</t>
            </t>
            <tt-else="">
                Therearenocommentsfornow.
            </t>
        </div>
    </t>

    <!--
        WidgetPortalComposer(standalone)

        requiredmanyoptions:token,res_model,res_id,...
    -->
    <tt-name="portal.Composer">
        <divclass="o_portal_chatter_composer"t-if="widget.options['allow_composer']">
            <tt-set="discussion_url"t-value="window.encodeURI(window.location.href.split('#')[0]+'#discussion')"/>
            <tt-if="!widget.options['display_composer']">
                <h4>Leaveacomment</h4>
                <p>Youmustbe<at-attf-href="/web/login?redirect=#{discussion_url}">loggedin</a>topostacomment.</p>
            </t>
            <tt-if="widget.options['display_composer']">
                <divclass="media">
                    <imgalt="Avatar"class="o_portal_chatter_avataro_object_fit_cover"t-attf-src="/web/image/res.partner/#{widget.options['partner_id']}/image_128"
                         t-if="!widget.options['is_user_public']or!widget.options['token']"/>
                    <divclass="media-body">
                        <formclass="o_portal_chatter_composer_form"t-attf-action="/mail/chatter_post"method="POST">
                            <inputtype="hidden"name="csrf_token"t-att-value="widget.options['csrf_token']"/>
                            <divclass="mb32">
                                <textarearows="4"name="message"class="form-control"placeholder="Writeamessage..."></textarea>
                                <inputtype="hidden"name="res_model"t-att-value="widget.options['res_model']"/>
                                <inputtype="hidden"name="res_id"t-att-value="widget.options['res_id']"/>
                                <inputtype="hidden"name="token"t-att-value="widget.options['token']"t-if="widget.options['token']"/>
                                <inputtype='hidden'name="pid"t-att-value="widget.options['pid']"t-if="widget.options['pid']"/>
                                <inputtype='hidden'name="hash"t-att-value="widget.options['hash']"t-if="widget.options['hash']"/>
                                <inputtype="hidden"name="sha_in"t-att-value="widget.options['sha_in']"t-if="widget.options['sha_in']"/>
                                <inputtype="hidden"name="sha_time"t-att-value="widget.options['sha_time']"t-if="widget.options['sha_time']"/>
                                <inputtype="hidden"name="redirect"t-att-value="discussion_url"/>
                                <inputtype="hidden"name="attachment_ids"class="o_portal_chatter_attachment_ids"/>
                                <inputtype="hidden"name="attachment_tokens"class="o_portal_chatter_attachment_tokens"/>
                                <divclass="alertalert-dangermt8mb0o_portal_chatter_composer_error"style="display:none;"role="alert">
                                    Oops!Somethingwentwrong.Trytoreloadthepageandlogin.
                                </div>
                                <divclass="o_portal_chatter_attachmentsmt-3"/>
                                <divclass="mt8">
                                    <buttont-attf-class="o_portal_chatter_composer_btnbtnbtn-primary"type="submit">Send</button>
                                    <buttonclass="o_portal_chatter_attachment_btnbtnbtn-secondary"type="button"title="Addattachment">
                                        <iclass="fafa-paperclip"/>
                                    </button>
                                </div>
                            </div>
                        </form>
                        <formclass="d-none">
                            <inputtype="file"class="o_portal_chatter_file_input"multiple="multiple"/>
                        </form>
                    </div>
                </div>
            </t>
        </div>
    </t>

    <tt-name="portal.Chatter.Attachments">
        <divt-if="attachments.length"class="row">
            <divt-foreach="attachments"t-as="attachment"class="col-lg-2col-md-3col-sm-6">
                <divclass="o_portal_chatter_attachmentmb-2position-relativetext-center"t-att-data-id="attachment.id">
                    <buttont-if="showDeleteandattachment.state=='pending'"class="o_portal_chatter_attachment_deletebtnbtn-smbtn-outline-danger"title="Delete">
                        <iclass="fafa-times"/>
                    </button>
                    <at-attf-href="/web/content/#{attachment.id}?download=true&amp;access_token=#{attachment.access_token}"target="_blank">
                        <divclass='oe_attachment_embeddedo_image't-att-title="attachment.name"t-att-data-mimetype="attachment.mimetype"/>
                        <divclass='o_portal_chatter_attachment_name'><tt-esc='attachment.name'/></div>
                    </a>
                </div>
            </div>
        </div>
    </t>

    <!--
        WidgetPortalChatter,andsubtemplates
    -->

    <tt-name="portal.chatter_messages">
        <divclass="o_portal_chatter_messages">
            <tt-foreach="widget.get('messages')||[]"t-as="message">
                <divclass="mediao_portal_chatter_message"t-att-id="'message-'+message.id">
                    <imgclass="o_portal_chatter_avatar"t-att-src="message.author_avatar_url"alt="avatar"/>
                    <divclass="media-body">
                        <tt-call="portal.chatter_internal_toggle"t-if="widget.options['is_user_employee']"/>

                        <divclass="o_portal_chatter_message_title">
                            <h5class='mb-1'><tt-esc="message.author_id[1]"/></h5>
                            <pclass="o_portal_chatter_puslished_date"><tt-esc="message.published_date_str"/></p>
                        </div>
                        <tt-raw="message.body"/>

                        <divclass="o_portal_chatter_attachments">
                            <tt-call="portal.Chatter.Attachments">
                                <tt-set="attachments"t-value="message.attachment_ids"/>
                            </t>
                        </div>
                    </div>
                </div>
            </t>
        </div>
    </t>

    <!--Chatter:internaltogglewidget-->
    <tt-name="portal.chatter_internal_toggle">
        <divt-if="message.is_message_subtype_note"class="float-right">
            <buttonclass="btnbtn-secondary"title="Internalnotesareonlydisplayedtointernalusers."disabled="true">InternalNote</button>
        </div>
        <divt-else=""t-attf-class="float-righto_portal_chatter_js_is_internal#{message.is_internaland'o_portal_message_internal_on'or'o_portal_message_internal_off'}"
                t-att-data-message-id="message.id"
                t-att-data-is-internal="message.is_internal">
            <buttonclass="btnbtn-danger"
                title="Currentlyrestrictedtointernalemployees,clicktomakeitavailabletoeveryoneviewingthisdocument.">EmployeesOnly</button>
            <buttonclass="btnbtn-success"
                title="Currentlyavailabletoeveryoneviewingthisdocument,clicktorestricttointernalemployees.">Visible</button>
        </div>
    </t>

    <tt-name="portal.pager">
        <divclass="o_portal_chatter_pager">
            <tt-if="!_.isEmpty(widget.get('pager'))">
                <ulclass="pagination"t-if="widget.get('pager')['pages'].length&gt;1">
                    <lit-if="widget.get('pager')['page']!=widget.get('pager')['page_previous']"t-att-data-page="widget.get('pager')['page_previous']"class="page-itemo_portal_chatter_pager_btn">
                        <ahref="#"class="page-link"><iclass="fafa-chevron-left"role="img"aria-label="Previous"title="Previous"/></a>
                    </li>
                    <tt-foreach="widget.get('pager')['pages']"t-as="page">
                        <lit-att-data-page="page"t-attf-class="page-item#{page==widget.get('pager')['page']?'o_portal_chatter_pager_btnactive':'o_portal_chatter_pager_btn'}">
                            <ahref="#"class="page-link"><tt-esc="page"/></a>
                        </li>
                    </t>
                    <lit-if="widget.get('pager')['page']!=widget.get('pager')['page_next']"t-att-data-page="widget.get('pager')['page_next']"class="page-itemo_portal_chatter_pager_btn">
                        <ahref="#"class="page-link"><iclass="fafa-chevron-right"role="img"aria-label="Next"title="Next"/></a>
                    </li>
                </ul>
            </t>
        </div>
    </t>

    <tt-name="portal.Chatter">
        <divclass="o_portal_chatterp-0">
            <divclass="o_portal_chatter_header">
                <tt-call="portal.chatter_message_count"/>
            </div>
            <hrt-if="widget.options['allow_composer']"/>
            <divclass="o_portal_chatter_composer"/>
            <hr/>
            <tt-call="portal.chatter_messages"/>
            <divclass="o_portal_chatter_footer">
                <tt-call="portal.pager"/>
            </div>
        </div>
    </t>

</templates>
