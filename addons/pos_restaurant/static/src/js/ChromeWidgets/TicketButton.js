flectra.define('pos_restaurant.TicketButton',function(require){
    'usestrict';

    constTicketButton=require('point_of_sale.TicketButton');
    constRegistries=require('point_of_sale.Registries');
    const{posbus}=require('point_of_sale.utils');

    constPosResTicketButton=(TicketButton)=>
        classextendsTicketButton{
            asynconClick(){
                if(this.env.pos.config.iface_floorplan&&!this.props.isTicketScreenShown&&!this.env.pos.table){
                    awaitthis._syncAllFromServer();
                    this.showScreen('TicketScreen');
                }else{
                    super.onClick();
                }
            }
            async_syncAllFromServer(){
                constpos=this.env.pos;
                try{
                    for(constfloorofpos.floors){
                        for(consttableoffloor.tables){
                            awaitpos.replace_table_orders_from_server(table);
                        }
                    }
                }catch(e){
                    awaitthis.showPopup('ErrorPopup',{
                        title:this.env._t('ConnectionError'),
                        body:this.env._t('Duetoaconnectionerror,theordersarenotsynchronized.'),
                    });
                }
            }
            mounted(){
                posbus.on('table-set',this,this.render);
            }
            willUnmount(){
                posbus.off('table-set',this);
            }
            /**
             *Ifnotableissettopos,whichmeansthecurrentmainscreen
             *isfloorscreen,thentheordercountshouldbebasedonalltheorders.
             */
            getcount(){
                if(!this.env.pos||!this.env.pos.config)return0;
                if(this.env.pos.config.iface_floorplan&&!this.env.pos.table){
                    returnthis.env.pos.get('orders').models.length;
                }else{
                    returnsuper.count;
                }
            }
        };

    Registries.Component.extend(TicketButton,PosResTicketButton);

    returnTicketButton;
});
