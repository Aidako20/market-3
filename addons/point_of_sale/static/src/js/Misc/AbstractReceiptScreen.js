flectra.define('point_of_sale.AbstractReceiptScreen',function(require){
    'usestrict';

    const{useRef}=owl.hooks;
    const{nextFrame}=require('point_of_sale.utils');
    constPosComponent=require('point_of_sale.PosComponent');
    constRegistries=require('point_of_sale.Registries');

    /**
     *Thisreliesontheassumptionthatthereisareferenceto
     *`order-receipt`soitisimportanttodeclarea`t-ref`to
     *`order-receipt`inthetemplateoftheComponentthatextends
     *thisabstractcomponent.
     */
    classAbstractReceiptScreenextendsPosComponent{
        constructor(){
            super(...arguments);
            this.orderReceipt=useRef('order-receipt');
        }
        async_printReceipt(){
            if(this.env.pos.proxy.printer){
                constprintResult=awaitthis.env.pos.proxy.printer.print_receipt(this.orderReceipt.el.outerHTML);
                if(printResult.successful){
                    returntrue;
                }else{
                    const{confirmed}=awaitthis.showPopup('ConfirmPopup',{
                        title:printResult.message.title,
                        body:this.env._t('Doyouwanttoprintusingthewebprinter?'),
                    });
                    if(confirmed){
                        //Wewanttocallthe_printWebwhenthepopupisfullygone
                        //fromthescreenwhichhappensafterthenextanimationframe.
                        awaitnextFrame();
                        returnawaitthis._printWeb();
                    }
                    returnfalse;
                }
            }else{
                returnawaitthis._printWeb();
            }
        }
        async_printWeb(){
            try{
                window.print();
                returntrue;
            }catch(err){
                awaitthis.showPopup('ErrorPopup',{
                    title:this.env._t('Printingisnotsupportedonsomebrowsers'),
                    body:this.env._t(
                        'Printingisnotsupportedonsomebrowsersduetonodefaultprintingprotocol'+
                            'isavailable.ItispossibletoprintyourticketsbymakinguseofanIoTBox.'
                    ),
                });
                returnfalse;
            }
        }
    }

    Registries.Component.add(AbstractReceiptScreen);

    returnAbstractReceiptScreen;
});
