flectra.define('wysiwyg.widgets.Dialog',function(require){
'usestrict';

varconfig=require('web.config');
varcore=require('web.core');
varDialog=require('web.Dialog');

var_t=core._t;

/**
 *ExtendDialogclasstohandlesave/cancelofeditioncomponents.
 */
varSummernoteDialog=Dialog.extend({
    /**
     *@constructor
     */
    init:function(parent,options){
        this.options=options||{};
        if(config.device.isMobile){
            options.fullscreen=true;
        }
        this._super(parent,_.extend({},{
            buttons:[{
                    text:this.options.save_text||_t("Save"),
                    classes:'btn-primary',
                    click:this.save,
                },
                {
                    text:_t("Discard"),
                    close:true,
                }
            ]
        },this.options));

        this.destroyAction='cancel';

        varself=this;
        this.opened(function(){
            self.$('input:visible:first').focus();
            self.$el.closest('.modal').addClass('o_web_editor_dialog');
            self.$el.closest('.modal').on('hidden.bs.modal',self.options.onClose);
        });
        this.on('closed',this,function(){
            self._toggleFullScreen();
            this.trigger(this.destroyAction,this.final_data||null);
        });
    },
    /**
     *Onlyuseonconfig.device.isMobile,it'susedbymassmailingtoallowthedialogopeningonfullscreen
     *@private
     */
    _toggleFullScreen:function(){
        if(config.device.isMobile&&!this.hasFullScreen){
            $('#iframe_target[isMobile="true"]#web_editor-top-edit.o_fullscreen').click();
        }
    },
    //--------------------------------------------------------------------------
    //Public
    //--------------------------------------------------------------------------

    /**
     *Calledwhenthedialogissaved.Setthedestroyactiontypeto"save"
     *andshouldsetthefinal_datavariablecorrectlybeforeclosing.
     */
    save:function(){
        this.destroyAction="save";
        this.close();
    },
    /**
     *@override
     *@returns{*}
     */
    open:function(){
        this.hasFullScreen=$(window.top.document.body).hasClass('o_field_widgetTextHtml_fullscreen');
        this._toggleFullScreen();
        returnthis._super.apply(this,arguments);
    },
});

returnSummernoteDialog;
});
