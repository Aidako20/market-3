<?xmlversion="1.0"encoding="UTF-8"?>
<templatesxml:space="preserve">

    <tt-name="mail.Message"owl="1">
        <divclass="o_Message"
            t-att-class="{
                'o-clicked':state.isClicked,
                'o-discussion':messageand(message.is_discussionormessage.is_notification),
                'o-mobile':env.messaging.device.isMobile,
                'o-not-discussion':messageand!(message.is_discussionormessage.is_notification),
                'o-notification':messageandmessage.message_type==='notification',
                'o-selected':props.isSelected,
                'o-squashed':props.isSquashed,
                'o-starred':messageandmessage.isStarred,
            }"role="group"t-att-aria-label="messageandmessage.messageTypeText"t-on-click="_onClick"t-att-data-message-local-id="messageandmessage.localId"
        >
            <tt-if="message"name="rootCondition">
                <divclass="o_Message_sidebar"t-att-class="{'o-message-squashed':props.isSquashed}">
                    <tt-if="!props.isSquashed">
                        <divclass="o_Message_authorAvatarContainero_Message_sidebarItem">
                            <imgclass="o_Message_authorAvatarrounded-circle"t-att-class="{o_Message_authorRedirect:hasAuthorOpenChat,o_redirect:hasAuthorOpenChat}"t-att-src="avatar"role="button"tabindex="0"t-on-click="_onClickAuthorAvatar"t-att-title="hasAuthorOpenChat?OPEN_CHAT:''"t-att-alt="hasAuthorOpenChat?OPEN_CHAT:''"/>
                            <tt-if="message.authorandmessage.author.im_status">
                                <PartnerImStatusIcon
                                    class="o_Message_partnerImStatusIcon"
                                    t-att-class="{
                                        'o-message-not-discussion':!(message.is_discussionormessage.is_notification),
                                        'o-message-selected':props.isSelected,
                                        'o_Message_partnerImStatusIcon-mobile':env.messaging.device.isMobile,
                                    }"
                                    hasOpenChat="hasAuthorOpenChat"
                                    partnerLocalId="message.author.localId"
                                />
                            </t>
                        </div>
                    </t>
                    <tt-else="">
                        <tt-if="message.date">
                            <divclass="o_Message_dateo_Message_sidebarItemo-message-squashed"t-att-class="{'o-message-selected':props.isSelected}">
                                <tt-esc="shortTime"/>
                            </div>
                        </t>
                        <divclass="o_Message_commandso_Message_sidebarCommandso_Message_sidebarItemo-message-squashed"t-att-class="{'o-message-selected':props.isSelected,'o-mobile':env.messaging.device.isMobile}">
                            <tt-if="message.message_type!=='notification'">
                                <divclass="o_Message_commando_Message_commandStarfa"
                                    t-att-class="{
                                        'fa-star':message.isStarred,
                                        'fa-star-o':!message.isStarred,
                                        'o-message-selected':props.isSelected,
                                        'o-message-starred':message.isStarred,
                                        'o-mobile':env.messaging.device.isMobile,
                                    }"t-on-click="_onClickStar"
                                />
                            </t>
                        </div>
                        <tt-if="message.isCurrentPartnerAuthorandthreadViewandthreadView.threadandthreadView.thread.hasSeenIndicators">
                            <MessageSeenIndicatorclass="o_Message_seenIndicatoro-message-squashed"messageLocalId="message.localId"threadLocalId="threadView.thread.localId"/>
                        </t>
                    </t>
                </div>
                <divclass="o_Message_core">
                    <tt-if="!props.isSquashed">
                        <divclass="o_Message_header">
                            <tt-if="message.author">
                                <divclass="o_Message_authorNameo_Message_authorRedirecto_redirect"role="link"tabindex="0"t-on-click="_onClickAuthorName"title="Openprofile">
                                    <tt-if="threadViewandthreadView.thread">
                                        <tt-esc="threadView.thread.getMemberName(message.author)"/>
                                    </t>
                                    <tt-else="">
                                        <tt-esc="message.author.nameOrDisplayName"/>
                                    </t>
                                </div>
                            </t>
                            <tt-elif="message.email_from">
                                <aclass="o_Message_authorName"t-attf-href="mailto:{{message.email_from}}?subject=Re:{{message.subject?message.subject:''}}">
                                    <tt-esc="message.email_from"/>
                                </a>
                            </t>
                            <tt-else="">
                                <divclass="o_Message_authorName">
                                    Anonymous
                                </div>
                            </t>
                            <tt-if="message.date">
                                <divclass="o_Message_dateo_Message_headerDate"t-att-class="{'o-message-selected':props.isSelected}"t-att-title="datetime">
                                    -<tt-esc="message.dateFromNow"/>
                                </div>
                            </t>
                            <tt-if="message.isCurrentPartnerAuthorandthreadViewandthreadView.threadandthreadView.thread.hasSeenIndicators">
                                <MessageSeenIndicatorclass="o_Message_seenIndicator"messageLocalId="message.localId"threadLocalId="threadView.thread.localId"/>
                            </t>
                            <tt-if="threadViewandmessage.originThreadandmessage.originThread!==threadView.thread">
                                <divclass="o_Message_originThread"t-att-class="{'o-message-selected':props.isSelected}">
                                    <tt-if="message.originThread.model==='mail.channel'">
                                        (from<aclass="o_Message_originThreadLink"t-att-href="message.originThread.url"t-on-click="_onClickOriginThread"><tt-if="message.originThread.name">#<tt-esc="message.originThread.name"/></t><tt-else="">channel</t></a>)
                                    </t>
                                    <tt-else="">
                                        on<aclass="o_Message_originThreadLink"t-att-href="message.originThread.url"t-on-click="_onClickOriginThread"><tt-if="message.originThread.name"><tt-esc="message.originThread.name"/></t><tt-else="">document</t></a>
                                    </t>
                                </div>
                            </t>
                            <tt-if="message.moderation_status==='pending_moderation'and!message.isModeratedByCurrentPartner">
                                <spanclass="o_Message_moderationPendingo-author"title="Yourmessageispendingmoderation.">Pendingmoderation</span>
                            </t>
                            <tt-if="threadViewandmessage.originThreadandmessage.originThread===threadView.threadandmessage.notifications.length>0">
                                <tt-if="message.failureNotifications.length>0">
                                    <spanclass="o_Message_notificationIconClickableo-error"role="button"tabindex="0"t-on-click="_onClickFailure">
                                        <iname="failureIcon"class="o_Message_notificationIconfafa-envelope"role="img"aria-label="Deliveryfailure"/>
                                    </span>
                                </t>
                                <tt-else="">
                                    <Popover>
                                        <spanclass="o_Message_notificationIconClickable">
                                            <iname="notificationIcon"class="o_Message_notificationIconfafa-envelope-o"/>
                                        </span>
                                        <tt-set="opened">
                                            <NotificationPopover
                                                notificationLocalIds="message.notifications.map(notification=>notification.localId)"
                                            />
                                        </t>
                                    </Popover>
                                </t>
                            </t>
                            <divclass="o_Message_commandso_Message_headerCommands"t-att-class="{'o-mobile':env.messaging.device.isMobile}">
                                <tt-if="!message.isTemporaryand((message.message_type!=='notification'andmessage.originThreadandmessage.originThread.model==='mail.channel')or!message.isTransient)andmessage.moderation_status!=='pending_moderation'">
                                    <spanclass="o_Message_commando_Message_commandStaro_Message_headerCommandfa"
                                        t-att-class="{
                                            'fa-star':message.isStarred,
                                            'fa-star-o':!message.isStarred,
                                            'o-message-selected':props.isSelected,
                                            'o-message-starred':message.isStarred,
                                            'o-mobile':env.messaging.device.isMobile,
                                        }"role="button"tabindex="0"aria-label="MarkasTodo"t-att-aria-pressed="message.isStarred?'true':'false'"t-on-click="_onClickStar"title="MarkasTodo"
                                    />
                                </t>
                                <tt-if="props.hasReplyIcon">
                                    <spanclass="o_Message_commando_Message_commandReplyo_Message_headerCommandfafa-reply"
                                        t-att-class="{
                                            'o-message-selected':props.isSelected,
                                            'o-mobile':env.messaging.device.isMobile,
                                        }"role="button"tabindex="0"aria-label="Reply"t-on-click="_onClickReply"title="Reply"
                                    />
                                </t>
                                <tt-if="props.hasMarkAsReadIcon">
                                    <spanclass="o_Message_commando_Message_commandMarkAsReado_Message_headerCommandfafa-check"
                                        t-att-class="{
                                            'o-message-selected':props.isSelected,
                                            'o-mobile':env.messaging.device.isMobile,
                                        }"role="button"tabindex="0"aria-label="MarkasRead"t-on-click="_onClickMarkAsRead"title="MarkasRead"
                                    />
                                </t>
                            </div>
                        </div>
                        <tt-if="message.isModeratedByCurrentPartner">
                            <divclass="o_Message_moderationSubHeader">
                                <tt-if="threadViewandprops.hasCheckboxandmessage.hasCheckbox">
                                    <inputclass="o_Message_checkbox"type="checkbox"t-att-checked="message.isChecked(threadView.thread,threadView.stringifiedDomain)?'checked':''"t-on-change="_onChangeCheckbox"t-ref="checkbox"/>
                                </t>
                                <spanclass="o_Message_moderationPending">Pendingmoderation:</span>
                                <aclass="o_Message_moderationActiono-accept"href="#"title="Accept"t-on-click="_onClickModerationAccept">Accept</a>
                                <aclass="o_Message_moderationActiono-reject"href="#"title="Removemessagewithexplanation"t-on-click="_onClickModerationReject">Reject</a>
                                <aclass="o_Message_moderationActiono-discard"href="#"title="Removemessagewithoutexplanation"t-on-click="_onClickModerationDiscard">Discard</a>
                                <aclass="o_Message_moderationActiono-allow"href="#"title="Addthisemailaddresstowhitelistofpeople"t-on-click="_onClickModerationAllow">AlwaysAllow</a>
                                <aclass="o_Message_moderationActiono-ban"href="#"title="Banthisemailaddress"t-on-click="_onClickModerationBan">Ban</a>
                            </div>
                        </t>
                    </t>
                    <divclass="o_Message_content"t-ref="content">
                        <divclass="o_Message_prettyBody"t-ref="prettyBody"/><!--message.prettyBodyisinsertedherefrom_update()-->
                        <tt-if="message.subtype_descriptionand!message.isBodyEqualSubtypeDescription">
                            <pt-esc="message.subtype_description"/>
                        </t>
                        <tt-if="trackingValues.length>0">
                            <ulclass="o_Message_trackingValues">
                                <tt-foreach="trackingValues"t-as="value"t-key="value.id">
                                    <li>
                                        <divclass="o_Message_trackingValue"role="group">
                                            <divclass="o_Message_trackingValueFieldNameo_Message_trackingValueItem"t-esc="value.changed_field"/>
                                            <tt-if="value.old_value">
                                                <divclass="o_Message_trackingValueOldValueo_Message_trackingValueItem"t-esc="value.old_value"/>
                                            </t>
                                            <divclass="o_Message_trackingValueSeparatoro_Message_trackingValueItemfafa-long-arrow-right"title="Changed"role="img"/>
                                            <tt-if="value.new_value">
                                                <divclass="o_Message_trackingValueNewValueo_Message_trackingValueItem"t-esc="value.new_value"/>
                                            </t>
                                        </div>
                                    </li>
                                </t>
                            </ul>
                        </t>
                    </div>
                    <tt-if="message.subjectand!message.isSubjectSimilarToOriginThreadNameandthreadViewandthreadView.threadand(threadView.thread.mass_mailingor[env.messaging.inbox,env.messaging.history].includes(threadView.thread))">
                        <pclass="o_Message_subject">Subject:<tt-esc="message.subject"/></p>
                    </t>
                    <tt-if="message.attachmentsandmessage.attachments.length>0">
                        <divclass="o_Message_footer">
                            <AttachmentList
                                class="o_Message_attachmentList"
                                areAttachmentsDownloadable="true"
                                areAttachmentsEditable="message.author===env.messaging.currentPartner"
                                attachmentLocalIds="message.attachments.map(attachment=>attachment.localId)"
                                attachmentsDetailsMode="props.attachmentsDetailsMode"
                            />
                        </div>
                    </t>
                </div>
                <tt-if="state.hasModerationBanDialog">
                    <ModerationBanDialogmessageLocalIds="[message.localId]"t-on-dialog-closed="_onDialogClosedModerationBan"/>
                </t>
                <tt-if="state.hasModerationDiscardDialog">
                    <ModerationDiscardDialogmessageLocalIds="[message.localId]"t-on-dialog-closed="_onDialogClosedModerationDiscard"/>
                </t>
                <tt-if="state.hasModerationRejectDialog">
                    <ModerationRejectDialogmessageLocalIds="[message.localId]"t-on-dialog-closed="_onDialogClosedModerationReject"/>
                </t>
            </t>
        </div>
    </t>

</templates>
