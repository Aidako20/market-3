flectra.define('mail/static/tests/tours/mail_full_composer_test_tour.js',function(require){
"usestrict";

const{
    createFile,
    inputFiles,
}=require('web.test_utils_file');

consttour=require('web_tour.tour');

/**
 *Thistourdependsondatacreatedbypythontestinchargeoflaunchingit.
 *Itisnotintendedtoworkwhenlaunchedfrominterface.Itisneededtotest
 *anaction(actionmanager)whichisnotpossibletotestwithQUnit.
 *@seemail/tests/test_mail_full_composer.py
 */
tour.register('mail/static/tests/tours/mail_full_composer_test_tour.js',{
    test:true,
},[{
    content:"ClickonSendMessage",
    trigger:'.o_ChatterTopbar_buttonSendMessage',
},{
    content:"Writesomethingincomposer",
    trigger:'.o_ComposerTextInput_textarea',
    run:'textblahblah',
},{
    content:"Addonefileincomposer",
    trigger:'.o_Composer_buttonAttachment',
    asyncrun(){
        constfile=awaitcreateFile({
            content:'hello,world',
            contentType:'text/plain',
            name:'text.txt',
        });
        inputFiles(
            document.querySelector('.o_FileUploader_input'),
            [file]
        );
    },
},{
    content:"Openfullcomposer",
    trigger:'.o_Composer_buttonFullComposer',
    extra_trigger:'.o_Attachment:not(.o-temporary)'//waitingtheattachmenttobeuploaded
},{
    content:"Checktheearlierprovidedattachmentislisted",
    trigger:'.o_attachment[title="text.txt"]',
    run(){},
},{
    content:"Checksubjectisautofilled",
    trigger:'input[name="subject"]',
    run(){
        constsubjectValue=document.querySelector('input[name="subject"]').value;
        if(subjectValue!=="Re:TestUser"){
            console.error(
                `Fullcomposershouldhave"Re:TestUser"insubjectinput(actual:${subjectValue})`
            );
        }
    },
},{
    content:"Checkcomposercontentiskept",
    trigger:'.oe_form_field[name="body"]',
    run(){
        constbodyContent=document.querySelector('.oe_form_field[name="body"]textarea').textContent;
        if(!bodyContent.includes("blahblah")){
            console.error(
                `Fullcomposershouldcontaintextfromsmallcomposer("blahblah")inbodyinput(actual:${bodyContent})`
            );
        }
    },
},{
    content:"Opentemplates",
    trigger:'.o_field_widget[name="template_id"]input',
},{
    content:"Checkatemplateislisted",
    in_modal:false,
    trigger:'.ui-autocomplete.ui-menu-itema:contains("Testtemplate")',
    run(){},
},{
    content:"Sendmessage",
    trigger:'.o_mail_send',
},{
    content:"Checkmessageisshown",
    trigger:'.o_Message:contains("blahblah")',
},{
    content:"Checkmessagecontainstheattachment",
    trigger:'.o_Message.o_Attachment_filename:contains("text.txt")',
}]);

});
