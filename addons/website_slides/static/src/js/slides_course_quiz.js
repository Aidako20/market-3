flectra.define('website_slides.quiz',function(require){
    'usestrict';

    varpublicWidget=require('web.public.widget');
    varDialog=require('web.Dialog');
    varcore=require('web.core');
    varsession=require('web.session');

    varCourseJoinWidget=require('website_slides.course.join.widget').courseJoinWidget;
    varQuestionFormWidget=require('website_slides.quiz.question.form');
    varSlideQuizFinishModal=require('website_slides.quiz.finish');

    varSlideEnrollDialog=require('website_slides.course.enroll').slideEnrollDialog;

    varQWeb=core.qweb;
    var_t=core._t;

    /**
     *Thiswidgetisresponsibleofdisplayingquizquestionsandpropositions.Submittingthequizwillfetchthe
     *correctionanddecoratetheanswersaccordingtotheresult.Errormessageormodalcanbedisplayed.
     *
     *ThiswidgetcanbeattachedtoDOMrenderedserver-sideby`website_slides.slide_type_quiz`or
     *usedclientside(Fullscreen).
     *
     *Triggeredeventsare:
     *-slide_go_next:needtogotothenextslide,whenquizisdone.Eventdatacontainsthecurrentslideid.
     *-quiz_completed:whenthequizispassedandcompletedbytheuser.Eventdatacontainscurrentslidedata.
     */
    varQuiz=publicWidget.Widget.extend({
        template:'slide.slide.quiz',
        xmlDependencies:[
            '/website_slides/static/src/xml/slide_quiz.xml',
            '/website_slides/static/src/xml/slide_course_join.xml'
        ],
        events:{
            "click.o_wslides_quiz_answer":'_onAnswerClick',
            "click.o_wslides_js_lesson_quiz_submit":'_submitQuiz',
            "click.o_wslides_quiz_modal_btn":'_onClickNext',
            "click.o_wslides_quiz_continue":'_onClickNext',
            "click.o_wslides_js_lesson_quiz_reset":'_onClickReset',
            'click.o_wslides_js_quiz_add':'_onCreateQuizClick',
            'click.o_wslides_js_quiz_edit_question':'_onEditQuestionClick',
            'click.o_wslides_js_quiz_delete_question':'_onDeleteQuestionClick',
            'click.o_wslides_js_channel_enroll':'_onSendRequestToResponsibleClick',
        },

        custom_events:{
            display_created_question:'_displayCreatedQuestion',
            display_updated_question:'_displayUpdatedQuestion',
            reset_display:'_resetDisplay',
            delete_question:'_deleteQuestion',
        },

        /**
        *@override
        *@param{Object}parent
        *@param{Object}slide_dataholdingalltheclassicslideinformation
        *@param{Object}quiz_data:optionalquizdatatodisplay.Ifnotgiven,willbefetched.(questionsandanswers).
        */
        init:function(parent,slide_data,channel_data,quiz_data){
            this._super.apply(this,arguments);
            this.slide=_.defaults(slide_data,{
                id:0,
                name:'',
                hasNext:false,
                completed:false,
                isMember:false,
            });
            this.quiz=quiz_data||false;
            if(this.quiz){
                this.quiz.questionsCount=quiz_data.questions.length;
            }
            this.isMember=slide_data.isMember||false;
            this.publicUser=session.is_website_user;
            this.userId=session.user_id;
            this.redirectURL=encodeURIComponent(document.URL);
            this.channel=channel_data;
        },

        /**
         *@override
         */
        willStart:function(){
            vardefs=[this._super.apply(this,arguments)];
            if(!this.quiz){
                defs.push(this._fetchQuiz());
            }
            returnPromise.all(defs);
        },

        /**
         *Overriddentoaddcustomrenderingbehavioruponstartofthewidget.
         *
         *Iftheuserhasansweredthequizbeforehavingjoinedthecourse,wecheck
         *hisanswers(savedintohissession)hereaswell.
         *
         *@override
         */
        start:function(){
            varself=this;
            returnthis._super.apply(this,arguments).then(function() {
                self._renderValidationInfo();
                self._bindSortable();
                self._checkLocationHref();
                if(!self.isMember){
                    self._renderJoinWidget();
                }elseif(self.slide.sessionAnswers){
                    self._applySessionAnswers();
                    self._submitQuiz();
                }
            });
        },

        //--------------------------------------------------------------------------
        //Private
        //--------------------------------------------------------------------------

        _alertShow:function(alertCode){
            varmessage=_t('Therewasanerrorvalidatingthisquiz.');
            if(alertCode==='slide_quiz_incomplete'){
                message=_t('Allquestionsmustbeanswered!');
            }elseif(alertCode==='slide_quiz_done'){
                message=_t('Thisquizisalreadydone.Retakingitisnotpossible.');
            }elseif(alertCode==='public_user'){
                message=_t('Youmustbeloggedtosubmitthequiz.');
            }

            this.displayNotification({
                type:'warning',
                message:message,
                sticky:true
            });
        },

        /**
         *Allowstoreorderthequestions
         *@private
         */
        _bindSortable:function(){
            this.$el.sortable({
                handle:'.o_wslides_js_quiz_sequence_handler',
                items:'.o_wslides_js_lesson_quiz_question',
                stop:this._reorderQuestions.bind(this),
                placeholder:'o_wslides_js_quiz_sequence_highlightposition-relativemy-3'
            });
        },

        /**
         *GetallthequestionsIDfromthedisplayedQuiz
         *@returns{Array}
         *@private
         */
        _getQuestionsIds:function(){
            returnthis.$('.o_wslides_js_lesson_quiz_question').map(function(){
                return$(this).data('question-id');
            }).get();
        },

        /**
         *Modifyvisuallythesequenceofallthequestionsafter
         *callingthe_reorderQuestionsRPCcall.
         *@private
         */
        _modifyQuestionsSequence:function(){
            this.$('.o_wslides_js_lesson_quiz_question').each(function(index,question){
                $(question).find('span.o_wslides_quiz_question_sequence').text(index+1);
            });
        },

        /**
         *RPCcalltoresequenceallthequestions.Itiscalled
         *aftermodifyingthesequenceofaquestionandalsoafter
         *deletingaquestion.
         *@private
         */
        _reorderQuestions:function(){
            this._rpc({
                route:'/web/dataset/resequence',
                params:{
                    model:"slide.question",
                    ids:this._getQuestionsIds()
                }
            }).then(this._modifyQuestionsSequence.bind(this))
        },
        /*
         *@private
         *Fetchthequizforaparticularslide
         */
        _fetchQuiz:function(){
            varself=this;
            returnself._rpc({
                route:'/slides/slide/quiz/get',
                params:{
                    'slide_id':self.slide.id,
                }
            }).then(function(quiz_data){
                self.quiz={
                    questions:quiz_data.slide_questions||[],
                    questionsCount:quiz_data.slide_questions.length,
                    quizAttemptsCount:quiz_data.quiz_attempts_count||0,
                    quizKarmaGain:quiz_data.quiz_karma_gain||0,
                    quizKarmaWon:quiz_data.quiz_karma_won||0,
                };
            });
        },

        /**
         *Hidetheeditanddeletebuttonandalsothehandler
         *toresequencethequestion
         *@private
         */
        _hideEditOptions:function(){
            this.$('.o_wslides_js_lesson_quiz_question.o_wslides_js_quiz_edit_del,'+
                   '.o_wslides_js_lesson_quiz_question.o_wslides_js_quiz_sequence_handler').addClass('d-none');
        },

        /**
         *@private
         *Decoratetheanswersaccordingtostate
         */
        _disableAnswers:function(){
            varself=this;
            this.$('.o_wslides_js_lesson_quiz_question').addClass('completed-disabled');
            this.$('input[type=radio]').each(function(){
                $(this).prop('disabled',self.slide.completed);
            });
        },

        /**
         *Decoratetheanswerinputsaccordingtothecorrectionandaddstheanswercommentif
         *any.
         *
         *@private
         */
        _renderAnswersHighlightingAndComments:function(){
            varself=this;
            this.$('.o_wslides_js_lesson_quiz_question').each(function(){
                var$question=$(this);
                varquestionId=$question.data('questionId');
                varisCorrect=self.quiz.answers[questionId].is_correct;
                $question.find('a.o_wslides_quiz_answer').each(function(){
                    var$answer=$(this);
                    $answer.find('i.fa').addClass('d-none');
                    if($answer.find('input[type=radio]')[0].checked){
                        if(isCorrect){
                            $answer.removeClass('list-group-item-danger').addClass('list-group-item-success');
                            $answer.find('i.fa-check-circle').removeClass('d-none');
                        }else{
                            $answer.removeClass('list-group-item-success').addClass('list-group-item-danger');
                            $answer.find('i.fa-times-circle').removeClass('d-none');
                            $answer.find('labelinput').prop('checked',false);
                        }
                    }else{
                        $answer.removeClass('list-group-item-dangerlist-group-item-success');
                        $answer.find('i.fa-circle').removeClass('d-none');
                    }
                });
                varcomment=self.quiz.answers[questionId].comment;
                if(comment){
                    $question.find('.o_wslides_quiz_answer_info').removeClass('d-none');
                    $question.find('.o_wslides_quiz_answer_comment').text(comment);
                }
            });
        },

        /**
         *Willcheckifwehaveanswerscomingfromthesessionandre-applythem.
         */
        _applySessionAnswers:function(){
            if(!this.slide.sessionAnswers||this.slide.sessionAnswers.length===0){
                return;
            }

            varself=this;
            this.$('.o_wslides_js_lesson_quiz_question').each(function(){
                var$question=$(this);
                $question.find('a.o_wslides_quiz_answer').each(function(){
                    var$answer=$(this);
                    if(!$answer.find('input[type=radio]')[0].checked&&
                        _.contains(self.slide.sessionAnswers,$answer.data('answerId'))){
                        $answer.find('input[type=radio]').prop('checked',true);
                    }
                });
            });

            //resetanswerscomingfromthesession
            this.slide.sessionAnswers=false;
        },

        /*
         *@private
         *Updatevalidationbox(karma,buttons)accordingtowidgetstate
         */
        _renderValidationInfo:function(){
            var$validationElem=this.$('.o_wslides_js_lesson_quiz_validation');
            $validationElem.html(
                QWeb.render('slide.slide.quiz.validation',{'widget':this})
            );
        },

        /**
         *Rendersthebuttontojoinacourse.
         *Iftheuserisloggedin,thecourseispublic,andtheuserhaspreviouslytriedto
         *submitanswers,weautomaticallyattempttojointhecourse.
         *
         *@private
         */
        _renderJoinWidget:function(){
            var$widgetLocation=this.$(".o_wslides_join_course_widget");
            if($widgetLocation.length!==0){
                varcourseJoinWidget=newCourseJoinWidget(this,{
                    isQuiz:true,
                    channel:this.channel,
                    isMember:this.isMember,
                    publicUser:this.publicUser,
                    beforeJoin:this._saveQuizAnswersToSession.bind(this),
                    afterJoin:this._afterJoin.bind(this),
                    joinMessage:_t('Join&Submit'),
                });

                courseJoinWidget.appendTo($widgetLocation);
                if(!this.publicUser&&courseJoinWidget.channel.channelEnroll==='public'&&this.slide.sessionAnswers){
                    courseJoinWidget.joinChannel(this.channel.channelId);
                }
            }
        },

        /**
         *GetthequizanswersfilledinbytheUser
         *
         *@private
         */
        _getQuizAnswers:function(){
            returnthis.$('input[type=radio]:checked').map(function(index,element){
                returnparseInt($(element).val());
            }).get();
        },

        /**
         *Submitaquizandgetthecorrection.Itwilldisplaymessages
         *accordingtoquizresult.
         *
         *@private
         */
        _submitQuiz:function(){
            varself=this;

            returnthis._rpc({
                route:'/slides/slide/quiz/submit',
                params:{
                    slide_id:self.slide.id,
                    answer_ids:this._getQuizAnswers(),
                }
            }).then(function(data){
                if(data.error){
                    self._alertShow(data.error);
                }else{
                    self.quiz=_.extend(self.quiz,data);
                    if(data.completed){
                        self._disableAnswers();
                        newSlideQuizFinishModal(self,{
                            quiz:self.quiz,
                            hasNext:self.slide.hasNext,
                            userId:self.userId
                        }).open();
                        self.slide.completed=true;
                        self.trigger_up('slide_completed',{slide:self.slide,completion:data.channel_completion});
                    }
                    self._hideEditOptions();
                    self._renderAnswersHighlightingAndComments();
                    self._renderValidationInfo();
                }
            });
        },

        /**
         *Getallthequestioninformationafterclickingon
         *theeditbutton
         *@param$elem
         *@returns{{id:*,sequence:number,text:*,answers:Array}}
         *@private
         */
        _getQuestionDetails:function($elem){
            varanswers=[];
            $elem.find('.o_wslides_quiz_answer').each(function(){
                answers.push({
                    'id':$(this).data('answerId'),
                    'text_value':$(this).data('text'),
                    'is_correct':$(this).data('isCorrect'),
                    'comment':$(this).data('comment')
                });
            });
            return{
                'id':$elem.data('questionId'),
                'sequence':parseInt($elem.find('.o_wslides_quiz_question_sequence').text()),
                'text':$elem.data('title'),
                'answers':answers,
            };
        },

        /**
         *IftheslideshasbeencalledwiththeAddQuizbuttonontheslidelist
         *itgoesstraighttothe'AddQuiz'buttonandclicksonit.
         *@private
         */
        _checkLocationHref:function(){
            if(window.location.href.includes('quiz_quick_create')){
                this._onCreateQuizClick();
            }
        },

        //--------------------------------------------------------------------------
        //Handlers
        //--------------------------------------------------------------------------

        /**
         *Whenclickingonananswer,thisoneshouldbemarkedas"checked".
         *
         *@private
         *@paramFlectraEventev
         */
        _onAnswerClick:function(ev){
            ev.preventDefault();
            if(!this.slide.completed){
                $(ev.currentTarget).find('input[type=radio]').prop('checked',true);
            }
        },

        /**
         *Triggeringaeventtoswitchtonextslide
         *
         *@private
         *@paramFlectraEventev
         */
        _onClickNext:function(ev){
            if(this.slide.hasNext){
                this.trigger_up('slide_go_next');
            }
        },

        /**
         *Resetsthecompletionoftheslidesotheusercantake
         *thequizagain
         *
         *@private
         */
        _onClickReset:function(){
            this._rpc({
                route:'/slides/slide/quiz/reset',
                params:{
                    slide_id:this.slide.id
                }
            }).then(function(){
                window.location.reload();
            });
        },
        /**
         *Savestheanswersfromtheuserandredirecttheusertothe
         *specifiedurl
         *
         *@private
         */
        _saveQuizAnswersToSession:function(){
            varquizAnswers=this._getQuizAnswers();
            if(quizAnswers.length===this.quiz.questions.length){
                returnthis._rpc({
                    route:'/slides/slide/quiz/save_to_session',
                    params:{
                        'quiz_answers':{'slide_id':this.slide.id,'slide_answers':quizAnswers},
                    }
                });
            }else{
                this._alertShow('slide_quiz_incomplete');
                returnPromise.reject('Thequizisincomplete');
            }
        },
        /**
        *Afterjoiningthecourse,weimmediatelysubmitthequizandgetthecorrection.
        *Thisallowsasmoothonboardingwhentheuserisloggedinandthecourseispublic.
        *
        *@private
        */
       _afterJoin:function(){
            this.isMember=true;
            this._renderValidationInfo();
            this._applySessionAnswers();
            this._submitQuiz();
       },

        /**
         *Whenclickingon'AddaQuestion'or'AddQuiz'it
         *initializeanewQuestionFormWidgettoinputthenew
         *question.
         *@private
         */
        _onCreateQuizClick:function(){
            var$elem=this.$('.o_wslides_js_lesson_quiz_new_question');
            this.$('.o_wslides_js_quiz_add').addClass('d-none');
            newQuestionFormWidget(this,{
                slideId:this.slide.id,
                sequence:this.quiz.questionsCount+1
            }).appendTo($elem);
        },

        /**
         *Whenclickingontheeditbuttonofaquestionit
         *initializeanewQuestionFormWidgetwiththeexisting
         *questionasinputs.
         *@paramev
         *@private
         */
        _onEditQuestionClick:function(ev){
            var$editedQuestion=$(ev.currentTarget).closest('.o_wslides_js_lesson_quiz_question');
            varquestion=this._getQuestionDetails($editedQuestion);
            newQuestionFormWidget(this,{
                editedQuestion:$editedQuestion,
                question:question,
                slideId:this.slide.id,
                sequence:question.sequence,
                update:true
            }).insertAfter($editedQuestion);
            $editedQuestion.hide();
        },

        /**
         *Whenclickingonthedeletebuttonofaquestionit
         *togglesamodaltoconfirmthedeletion
         *@paramev
         *@private
         */
        _onDeleteQuestionClick:function(ev){
            varquestion=$(ev.currentTarget).closest('.o_wslides_js_lesson_quiz_question');
            newConfirmationDialog(this,{
                questionId:question.data('questionId'),
                questionTitle:question.data('title')
            }).open();
        },

        /**
         *HandlerforthecontactresponsiblelinkbelowaQuiz
         *@paramev
         *@private
         */
        _onSendRequestToResponsibleClick:function(ev){
            ev.preventDefault();
            varchannelId=$(ev.currentTarget).data('channelId');
            newSlideEnrollDialog(this,{
                channelId:channelId,
                $element:$(ev.currentTarget).closest('.alert.alert-info')
            }).open();
        },

        /**
         *DisplaysthecreatedQuestionatthecorrectplace(afterthelastquestionor
         *atthefirstplaceifthereisnoquestionsyet)Italsodisplaysthe'AddQuestion'
         *buttonoropenanewQuestionFormWidgetiftheuserwantstoimmediatelyaddanotherone.
         *
         *@paramevent
         *@private
         */
        _displayCreatedQuestion:function(event){
            var$lastQuestion=this.$('.o_wslides_js_lesson_quiz_question:last');
            if($lastQuestion.length!==0){
                $lastQuestion.after(event.data.newQuestionRenderedTemplate);
            }else{
                this.$el.prepend(event.data.newQuestionRenderedTemplate);
            }
            this.quiz.questionsCount++;
            event.data.questionFormWidget.destroy();
            this.$('.o_wslides_js_quiz_add_question').removeClass('d-none');
        },

        /**
         *Replacetheeditedquestionbythenewquestionanddestroy
         *theQuestionFormWidget.
         *@paramevent
         *@private
         */
        _displayUpdatedQuestion:function(event){
            varquestionFormWidget=event.data.questionFormWidget;
            event.data.$editedQuestion.replaceWith(event.data.newQuestionRenderedTemplate);
            questionFormWidget.destroy();
        },

        /**
         *IftheusercancelsthecreationorupdateofaQuestionitresetsthedisplay
         *oftheupdatedQuestionoritdisplaysbackthebuttons.
         *
         *@paramevent
         *@private
         */
        _resetDisplay:function(event){
            varquestionFormWidget=event.data.questionFormWidget;
            if(questionFormWidget.update){
                questionFormWidget.$editedQuestion.show();
            }else{
                if(this.quiz.questionsCount>0){
                    this.$('.o_wslides_js_quiz_add_question').removeClass('d-none');
                }else{
                    this.$('.o_wslides_js_quiz_add_quiz').removeClass('d-none');
                }
            }
            questionFormWidget.destroy();
        },

        /**
         *AfterdeletionofaQuestionthedisplayisrefreshedwiththeremovaloftheQuestion
         *thereorderingofalltheremainingQuestionsandthechangeofthenewQuestionsequence
         *iftheQuestionFormWidgetisinitialized.
         *
         *@paramevent
         *@private
         */
        _deleteQuestion:function(event){
            varquestionId=event.data.questionId;
            this.$('.o_wslides_js_lesson_quiz_question[data-question-id='+questionId+']').remove();
            this.quiz.questionsCount--;
            this._reorderQuestions();
            var$newQuestionSequence=this.$('.o_wslides_js_lesson_quiz_new_question.o_wslides_quiz_question_sequence');
            $newQuestionSequence.text(parseInt($newQuestionSequence.text())-1);
            if(this.quiz.questionsCount===0&&!this.$('.o_wsildes_quiz_question_input').length){
                this.$('.o_wslides_js_quiz_add_quiz').removeClass('d-none');
                this.$('.o_wslides_js_quiz_add_question').addClass('d-none');
                this.$('.o_wslides_js_lesson_quiz_validation').addClass('d-none');
            }
        },
    });

    /**
     *DialogboxshownwhenclickingthedeletionbuttononaQuestion.
     *WhenconfirmingitsendsaRPCrequesttodeletetheQuestion.
     */
    varConfirmationDialog=Dialog.extend({
        template:'slide.quiz.confirm.deletion',
        xmlDependencies:Dialog.prototype.xmlDependencies.concat(
            ['/website_slides/static/src/xml/slide_quiz_create.xml']
        ),

        /**
         *@override
         *@paramparent
         *@paramoptions
         */
        init:function(parent,options){
            options=_.defaults(options||{},{
                title:_t('DeleteQuestion'),
                buttons:[
                    {text:_t('Yes'),classes:'btn-primary',click:this._onConfirmClick},
                    {text:_t('No'),close:true}
                ],
                size:'medium'
            });
            this.questionId=options.questionId;
            this.questionTitle=options.questionTitle;
            this._super.apply(this,arguments);
        },

        /**
         *Handlerwhentheuserconfirmthedeletionbyclickingon'Yes'
         *itsendsaRPCrequesttotheserverandtriggersaneventto
         *visuallydeletethequestion.
         *@private
         */
        _onConfirmClick:function(){
            varself=this;
            this._rpc({
                model:'slide.question',
                method:'unlink',
                args:[this.questionId],
            }).then(function(){
                self.trigger_up('delete_question',{questionId:self.questionId});
                self.close();
            });
        }
    });

    publicWidget.registry.websiteSlidesQuizNoFullscreen=publicWidget.Widget.extend({
        selector:'.o_wslides_lesson_main',//selectorofcompletepage,asweneedslidecontentandasidecontenttable
        custom_events:{
            slide_go_next:'_onQuizNextSlide',
            slide_completed:'_onQuizCompleted',
        },

        //----------------------------------------------------------------------
        //Public
        //----------------------------------------------------------------------

        /**
         *@override
         *@param{Object}parent
         */
        start:function(){
            varself=this;
            this.quizWidgets=[];
            vardefs=[this._super.apply(this,arguments)];
            this.$('.o_wslides_js_lesson_quiz').each(function(){
                varslideData=$(this).data();
                varchannelData=self._extractChannelData(slideData);
                slideData.quizData={
                    questions:self._extractQuestionsAndAnswers(),
                    sessionAnswers:slideData.sessionAnswers||[],
                    quizKarmaMax:slideData.quizKarmaMax,
                    quizKarmaWon:slideData.quizKarmaWon||0,
                    quizKarmaGain:slideData.quizKarmaGain,
                    quizAttemptsCount:slideData.quizAttemptsCount,
                };
                defs.push(newQuiz(self,slideData,channelData,slideData.quizData).attachTo($(this)));
            });
            returnPromise.all(defs);
        },

        //----------------------------------------------------------------------
        //Handlers
        //---------------------------------------------------------------------
        _onQuizCompleted:function(ev){
            varslide=ev.data.slide;
            varcompletion=ev.data.completion;
            this.$('#o_wslides_lesson_aside_slide_check_'+slide.id).addClass('text-successfa-check').removeClass('text-600fa-circle-o');
            //needtouseglobalselectorasprogressbarisoutsidethisanimationwidgetscope
            $('.o_wslides_lesson_header.progress-bar').css('width',completion+"%");
            $('.o_wslides_lesson_header.progressspan').text(_.str.sprintf("%s%%",completion));
        },
        _onQuizNextSlide:function(){
            varurl=this.$('.o_wslides_js_lesson_quiz').data('next-slide-url');
            window.location.replace(url);
        },

        //----------------------------------------------------------------------
        //Private
        //---------------------------------------------------------------------

        _extractChannelData:function(slideData){
            return{
                channelId:slideData.channelId,
                channelEnroll:slideData.channelEnroll,
                channelRequestedAccess:slideData.channelRequestedAccess||false,
                signupAllowed:slideData.signupAllowed
            };
        },

        /**
         *ExtractdatafromexitingDOMrenderedserver-side,tohavethelistofquestionswiththeir
         *relativeanswers.
         *Thismethodshouldreturnthesameformatas/slide/quiz/getcontroller.
         *
         *@return{Array<Object>}listofquestionswithanswers
         */
        _extractQuestionsAndAnswers:function(){
            varquestions=[];
            this.$('.o_wslides_js_lesson_quiz_question').each(function(){
                var$question=$(this);
                varanswers=[];
                $question.find('.o_wslides_quiz_answer').each(function(){
                    var$answer=$(this);
                    answers.push({
                        id:$answer.data('answerId'),
                        text:$answer.data('text'),
                    });
                });
                questions.push({
                    id:$question.data('questionId'),
                    title:$question.data('title'),
                    answer_ids:answers,
                });
            });
            returnquestions;
        },
    });

    return{
        Quiz:Quiz,
        ConfirmationDialog:ConfirmationDialog,
        websiteSlidesQuizNoFullscreen:publicWidget.registry.websiteSlidesQuizNoFullscreen
    };
});
