<?xmlversion="1.0"?>
<flectra>
    <data>
        <recordid="view_order_form_inherit_sale_stock"model="ir.ui.view">
            <fieldname="name">sale.order.form.sale.stock</field>
            <fieldname="model">sale.order</field>
            <fieldname="inherit_id"ref="sale.view_order_form"/>
            <fieldname="arch"type="xml">
                <xpathexpr="//button[@name='action_view_invoice']"position="before">
                    <fieldname="picking_ids"invisible="1"/>
                    <buttontype="object"
                        name="action_view_delivery"
                        class="oe_stat_button"
                        icon="fa-truck"
                        attrs="{'invisible':[('delivery_count','=',0)]}"groups="base.group_user">
                        <fieldname="delivery_count"widget="statinfo"string="Delivery"/>
                    </button>
                </xpath>
                <xpathexpr="//group[@name='sale_shipping']"position="attributes">
                    <attributename="groups"></attribute><!--Removetheres.grouponthegroupandsetitonthefielddirectly-->
                    <attributename="string">Delivery</attribute>
                </xpath>
                <xpathexpr="//label[@for='commitment_date']"position="before">
                    <fieldname="warehouse_id"options="{'no_create':True}"groups="stock.group_stock_multi_warehouses"force_save="1"/>
                    <fieldname="incoterm"widget="selection"groups="sale_stock.group_display_incoterm"/>
                    <fieldname="picking_policy"required="True"/>
                </xpath>
                <xpathexpr="//span[@name='expected_date_span']"position="attributes">
                    <attributename="attrs">
                        {'invisible':[('effective_date','!=',False),('commitment_date','!=',False)]}
                    </attribute>
                </xpath>
                <xpathexpr="//div[@name='commitment_date_div']"position="replace">
                    <divclass="o_row">
                        <fieldname="commitment_date"/>
                        <spanclass="text-muted"attrs="{'invisible':[('effective_date','!=',False),('commitment_date','!=',False)]}">Expected:<fieldname="expected_date"widget="date"/></span>
                    </div>
                    <fieldname="effective_date"attrs="{'invisible':[('effective_date','=',False)]}"/>
                </xpath>
                <xpathexpr="//page[@name='other_information']//field[@name='expected_date']"position="after">
                    <fieldname="show_json_popover"invisible="1"/>
                    <fieldstring=""name="json_popover"widget="stock_rescheduling_popover"attrs="{'invisible':[('show_json_popover','=',False)]}"/>
                </xpath>
                <xpathexpr="//page/field[@name='order_line']/form/group/group/field[@name='price_unit']"position="before">
                    <fieldname="product_packaging"attrs="{'invisible':[('product_id','=',False)]}"context="{'default_product_id':product_id,'tree_view_ref':'product.product_packaging_tree_view','form_view_ref':'product.product_packaging_form_view'}"domain="[('product_id','=',product_id)]"groups="product.group_stock_packaging"/>
                </xpath>
                <xpathexpr="//page/field[@name='order_line']/tree/field[@name='price_unit']"position="before">
                    <fieldname="product_packaging"attrs="{'invisible':[('product_id','=',False)]}"context="{'default_product_id':product_id,'tree_view_ref':'product.product_packaging_tree_view','form_view_ref':'product.product_packaging_form_view'}"domain="[('product_id','=',product_id)]"groups="product.group_stock_packaging"optional="show"/>
                </xpath>
                <xpathexpr="//field[@name='order_line']/form/group/group/field[@name='analytic_tag_ids']"position="before">
                    <fieldname="route_id"groups="stock.group_adv_location"options="{'no_create':True}"/>
                </xpath>
                <xpathexpr="//field[@name='order_line']/tree/field[@name='analytic_tag_ids']"position="after">
                    <fieldname="route_id"groups="stock.group_adv_location"options="{'no_create':True}"optional="hide"/>
                </xpath>
           </field>
        </record>

        <recordid="view_quotation_tree"model="ir.ui.view">
            <fieldname="name">sale.order.tree.inherit.sale.stock</field>
            <fieldname="model">sale.order</field>
            <fieldname="inherit_id"ref="sale.view_quotation_tree"/>
            <fieldname="arch"type="xml">
                <xpathexpr="//field[@name='tag_ids']"position="after">
                    <fieldname="warehouse_id"options="{'no_create':True}"groups="stock.group_stock_multi_warehouses"optional="hide"/>
                </xpath>
            </field>
        </record>

        <recordid="view_order_tree"model="ir.ui.view">
            <fieldname="name">sale.order.tree.inherit.sale.stock</field>
            <fieldname="model">sale.order</field>
            <fieldname="inherit_id"ref="sale.view_order_tree"/>
            <fieldname="arch"type="xml">
                <xpathexpr="//field[@name='team_id']"position="after">
                    <fieldname="warehouse_id"options="{'no_create':True}"groups="stock.group_stock_multi_warehouses"optional="hide"/>
                </xpath>
            </field>
        </record>

        <recordid="view_order_line_tree_inherit_sale_stock"model="ir.ui.view">
            <fieldname="name">sale.order.line.tree.sale.stock.location</field>
            <fieldname="inherit_id"ref="sale.view_order_line_tree"/>
            <fieldname="model">sale.order.line</field>
            <fieldname="arch"type="xml">
                <xpathexpr="//field[@name='price_subtotal']"position="before">
                    <fieldname="route_id"groups="stock.group_adv_location"options="{'no_create':True}"/>
                </xpath>
            </field>
        </record>

        <recordid="view_order_form_inherit_sale_stock_qty"model="ir.ui.view">
            <fieldname="name">sale.order.line.tree.sale.stock.qty</field>
            <fieldname="inherit_id"ref="sale.view_order_form"/>
            <fieldname="model">sale.order</field>
            <fieldname="arch"type="xml">
                <xpathexpr="//page/field[@name='order_line']/form/group/group/div[@name='ordered_qty']/field[@name='product_uom']"position="after">
                    <!--belowfieldsareusedinthewidgetqty_at_date_widget-->
                    <fieldname="product_type"invisible="1"/>
                    <fieldname="virtual_available_at_date"invisible="1"/>
                    <fieldname="qty_available_today"invisible="1"/>
                    <fieldname="free_qty_today"invisible="1"/>
                    <fieldname="scheduled_date"invisible="1"/>
                    <fieldname="forecast_expected_date"invisible="1"/>
                    <fieldname="warehouse_id"invisible="1"/>
                    <fieldname="qty_to_deliver"invisible="1"/>
                    <fieldname="is_mto"invisible="1"/>
                    <fieldname="display_qty_widget"invisible="1"/>
                    <widgetname="qty_at_date_widget"width="0.1"/>
                </xpath>
                <xpathexpr="//page/field[@name='order_line']/tree/field[@name='qty_delivered']"position="after">
                    <!--belowfieldsareusedinthewidgetqty_at_date_widget-->
                    <fieldname="product_type"invisible="1"/>
                    <fieldname="virtual_available_at_date"invisible="1"/>
                    <fieldname="qty_available_today"invisible="1"/>
                    <fieldname="free_qty_today"invisible="1"/>
                    <fieldname="scheduled_date"invisible="1"/>
                    <fieldname="forecast_expected_date"invisible="1"/>
                    <fieldname="warehouse_id"invisible="1"/>
                    <fieldname="qty_to_deliver"invisible="1"/>
                    <fieldname="is_mto"invisible="1"/>
                    <fieldname="display_qty_widget"invisible="1"/>
                    <widgetname="qty_at_date_widget"width="20px"/>
                </xpath>
            </field>
        </record>

        <templateid="sale_order_line_view_list"name="sale.order.line.view.list"inherit_id="web.assets_backend">
            <xpathexpr="."position="inside">
                <scripttype="text/javascript"src="/sale_stock/static/src/js/qty_at_date_widget.js"></script>
            </xpath>
        </template>
    </data>
</flectra>
