flectra.define('website_sale_comparison.tour_comparison',function(require){
    'usestrict';

    vartour=require('web_tour.tour');
    varrpc=require('web.rpc');

    tour.register('product_comparison',{
        test:true,
        url:"/shop",
    },[
    //testfromshoppage
    {
        content:"addfirstproduct'Three-SeatSofa'inacomparisonlist",
        trigger:'.oe_product_cart:contains("Three-SeatSofa").o_add_compare',
    },
    {
        content:"checkcomparebuttoncontainsoneproduct",
        trigger:'.o_product_circle:contains(1)',
        run:function(){},
    },
    {
        content:"checkpopoverisclosedwhenonlyoneproduct",
        trigger:'body:not(:has(.comparator-popover))',
        run:function(){},
    },
    {
        content:"addsecondproduct'ConferenceChair'inacomparisonlist",
        trigger:'.oe_product_cart:contains("ConferenceChair").o_add_compare',
    },
    {
        content:"checkpopoverisnowopenandcomparebuttoncontainstwoproducts",
        extra_trigger:'.comparator-popover',
        trigger:'.o_product_circle:contains(2)',
        run:function(){},
    },
    {
        content:"checkproductsnamearecorrectinthecomparelist",
        extra_trigger:'.o_product_row:contains("Three-SeatSofa")',
        trigger:'.o_product_row:contains("ConferenceChair")',
        run:function(){},
    },
    //testformproductpage
    {
        content:"gotoproductpageofcustomizabledesk(withvariants)",
        trigger:'.oe_product_carta:contains("CustomizableDesk")',
    },
    {
        content:"checkcomparebuttonisstillthereandcontains2products",
        extra_trigger:'#product_details',
        trigger:'.o_product_circle:contains(2)',
        run:function(){},
    },
    {
        content:"checkpopoverisclosedafterchangingpage",
        trigger:'body:not(:has(.comparator-popover))',
        run:function(){},
    },
    {
        content:"addfirstvarianttocomparelist",
        trigger:'.o_add_compare_dyn',
    },
    {
        content:"checkthecomparelistisnowopenandcontains3rdproductwithcorrectvariant",
        extra_trigger:'.comparator-popover',
        trigger:'.o_product_row:contains("CustomizableDesk(CONFIG)(Steel,White)")',
        run:function(){},
    },
    {
        content:"select2ndvariant(BlackColor)",
        trigger:'.variant_attribute[data-attribute_name="Color"]input[data-value_name="Black"]',
        run:function(actions){
          $('img[class*="product_detail_img"]').attr('data-image-to-change',1);
          actions.click();
        },
    },
    {
        content:"clickoncomparebuttontoaddincomparisonlistwhenvariantchanged",
        extra_trigger:'img[class*="product_detail_img"]:not([data-image-to-change])',
        trigger:'.o_add_compare_dyn',
    },
    {
        content:"comparelistcontains4thproductwithcorrectvariant",
        extra_trigger:'.o_product_circle:contains(4)',
        trigger:'.o_product_row:contains("CustomizableDesk(CONFIG)(Steel,Black)")',
        run:function(){},
    },
    {
        content:"checklimitisnotreached",
        trigger:':not(.o_comparelist_limit_warning)',
        run:function(){},
    },
    {
        content:"select3ndvariant(Custom)",
        trigger:'.variant_attribute[data-attribute_name="Legs"]input[data-value_name="Custom"]',
    },
    {
        content:"clickoncomparebuttontoaddincomparisonlistwhenvariantchanged",
        extra_trigger:'body:not(:has(.carousel-indicators))',//thereis1imageonthecustomvariant
        trigger:'.o_add_compare_dyn',
    },
    {
        content:"checklimitisreached",
        trigger:'.o_comparelist_limit_warning',
        run:function(){},
    },
    {
        content:"clickoncomparebutton",
        trigger:'.o_comparelist_buttona',
    },
    //testoncomparepage
    {
        content:"check1stproductcontainscorrectvariant",
        trigger:'.o_product_comparison_table:contains("ConferenceChair(CONFIG)(Steel)")',
        run:function(){},
    },
    {
        content:"check2ndproductcontainscorrectvariant",
        trigger:'.o_product_comparison_table:contains("CustomizableDesk(CONFIG)(Steel,White)")',
        run:function(){},
    },
    {
        content:"check3rdproductiscorrectlyadded",
        trigger:'.o_product_comparison_table:contains("CustomizableDesk(CONFIG)(Steel,Black)")',
        run:function(){},
    },
    {
        content:"check4thproductiscorrectlyadded",
        trigger:'.o_product_comparison_table:contains("Three-SeatSofa")',
        run:function(){},
    },
    {
        content:"removeCustomizableDesk(CONFIG)(Steel,Black)fromcomparetable",
        trigger:'#o_comparelist_table.o_comparelist_remove:eq(2)',
    },
    {
        content:"checkcustomizabletablewithblackvariantisremoved",
        trigger:'#o_comparelist_table:not(:contains("CustomizableDesk(CONFIG)(Steel,Black)"))',
        run:function(){},
    },
    {
        content:"opencomparemenu",
        extra_trigger:'body:has(.o_product_row:contains("Three-SeatSofa").o_remove)',
        trigger:'.o_product_panel_header',
    },
    {
        content:"removeproduct",
        trigger:'.o_product_row:contains("Three-SeatSofa").o_remove',
    },
    {
        content:"clickoncomparebuttontoreload",
        trigger:'.o_comparelist_buttona',
    },
    {
        content:"checkproduct'Three-SeatSofa'isremoved",
        trigger:'#o_comparelist_table:not(:contains("Three-SeatSofa"))',
        run:function(){},
    },
    {
        content:"addproduct'ConferenceChair'tocart",
        trigger:'.product_summary:contains("ConferenceChair").a-submit:contains("AddtoCart")',
    },
    {
        content:"checkproductcorrectlyaddedtocart",
        trigger:'#cart_products:contains("ConferenceChair").js_quantity[value="1"]',
        run:function(){},
    },
    //testadvancedconfigurationandalternativeproduct
    {
        content:"createproductwithnewlycreatedattributeanditsvaluesandsetalternativeproduct",
        trigger:'body',
        run:function(){
            rpc.query({
                model:'product.attribute',
                method:'create',
                args:[{
                    'name':'color',
                    'display_type':'color',
                    'create_variant':'dynamic',
                }],
            }).then(function(attributeId){
                rpc.query({
                    model:'product.template',
                    method:'create',
                    args:[{
                        'name':'BasicChair',
                        'is_published':true,
                        'attribute_line_ids':[[0,0,{
                            'attribute_id':attributeId,
                            'value_ids':[
                                [0,0,{'name':'red','attribute_id':attributeId,'sequence':1}],
                                [0,0,{'name':'blue','attribute_id':attributeId,'sequence':2}],
                            ],
                        }]],
                    }],
                }).then(function(productId){
                    rpc.query({
                        model:'product.template',
                        method:'create',
                        args:[{
                            'name':'ClassicChair',
                            'is_published':true,
                            'attribute_line_ids':[[0,0,{
                                'attribute_id':attributeId,
                                'value_ids':[
                                    [0,0,{'name':'green','attribute_id':attributeId,'sequence':3}],
                                    [0,0,{'name':'yellow','attribute_id':attributeId,'sequence':4}],
                                ],
                            }]],
                            'alternative_product_ids':[[6,0,[productId]]],
                        }],
                    }).then(function(){
                        window.location.href='/shop?search=ClassicChair';
                    });
                });
            });
        },
    },
    {
        content:"clickonproduct",
        trigger:'.oe_product_carta:contains("ClassicChair")',
    },
    {
        content:"clickoncomparebutton",
        trigger:'.btn.btn-primary:not(.btn-block):contains("Compare")',
    },
    {
        content:"checkproduct'ClassicChair'withfirstvariant(green)isoncomparepage",
        trigger:'.o_product_comparison_table:contains("ClassicChair(green)")',
        run:function(){},
    },
    {
        content:"checkalternativeproduct'BasicChair'withfirstvariant(red)isoncomparepage",
        trigger:'.o_product_comparison_table:contains("BasicChair(red)")',
        run:function(){},
    },
    {
        content:"checkthereisthecorrectattribute",
        trigger:'.o_ws_category_0:contains("color"):contains("red")',
        run:function(){},
    },
    ]);
});
