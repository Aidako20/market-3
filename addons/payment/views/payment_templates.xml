<?xmlversion="1.0"encoding="utf-8"?>
<flectra>
    <templateid="assets_backend"name="PaymentAssetsBackend"inherit_id="web.assets_backend">
        <xpathexpr="."position="inside">
            <linkrel="stylesheet"type="text/scss"href="/payment/static/src/scss/payment_acquirer.scss"/>
        </xpath>
    </template>

    <templateid="payment_tokens_list"name="PaymentTokenslist">
        <!--
        Variablesdescription:
            -'submit_txt'thetextdisplayedinsidethesubmitbutton
            -'submit_class'thecssclassestostylethesubmitbutton
            -'icon_class'fontawesomeclass(e.g.'fa-trash','fa-lock')
            -'form_action'theURItothepagethatwillhandletheformvaluesgivenforserver2server
            -'pms'thetokens
            -'checked_pm_id'thepaymenttokenthatshouldbechecked(forradiobuttons)
            -'mode'cantaketwovalues,either'payment'or'manage'.'manage'displaystheaddanewcardanddeletebuttons.'payment'
                displayaformthatisusedtopayandsendtheinformationtotheformactionurl.
            -'acquirers'thelistofbothserver2serverandformpaymentacquirers
            -'verify_validity'ifweneedtoverifyifthepaymentmethodisvalidwhenaddinganewone
            -'prepare_tx_url'theurloftheroutewhichwillhandlethecreationofatransactionforaformbasepayment(handlesifthetransactionisformorform_save)
            -'show_manage_btn'ifTrue,abuttonisaddedinthefootertomanagepaymentmethods
        -->
        <formt-if="pmsoracquirers"method="post"class="o_payment_formmt-3clearfix"
                t-att-action="form_actionifform_actionelse'#'"
                t-att-data-success-url="success_urlor''"
                t-att-data-error-url="error_urlor''"
                t-att-data-access-token="access_tokenor''"
                t-att-data-partner-id="partner_id"
                t-att-data-callback-method="callback_methodor''"
                t-att-data-order-id="order_idor''"
                t-att-data-invoice-id="invoice_idor''"
                t-att-data-mode="mode">
            <inputtype="hidden"name="csrf_token"t-att-value="request.csrf_token()"/>
            <inputtype="hidden"t-if="prepare_tx_url"name="prepare_tx_url"t-att-value="prepare_tx_url"/>
            <inputtype="hidden"t-if="order_id"name="order_id"t-att-value="order_id"/>
            <inputtype="hidden"t-if="invoice_id"name="invoice_id"t-att-value="invoice_id"/>
            <!--s2sformsubmission-->
            <inputtype="hidden"t-if="access_token"name="access_token"t-att-value="access_token"/>
            <inputtype="hidden"t-if="success_url"name="success_url"t-att-value="success_url"/>
            <inputtype="hidden"t-if="error_url"name="error_url"t-att-value="error_url"/>
            <inputtype="hidden"t-if="callback_method"name="callback_method"t-att-value="callback_method"/>

            <divclass="card">
                <tt-set="acquirers_count"t-value="len(acquirers)ifacquirerselse0"/>
                <tt-set="pms_count"t-value="len(pms)ifpmselse0"/>
                <tt-set="MAX_BRAND_LINE"t-value="3"/>
                <tt-foreach="acquirers"t-as="acq">
                    <divclass="card-bodyo_payment_acquirer_select">
                        <label>
                            <tt-if="acq.payment_flow=='form'">
                                <inputtype="radio"t-att-data-acquirer-id="acq.id"
                                       t-att-data-form-payment="true"
                                       t-att-data-provider="acq.provider"
                                       t-att-class="'d-none'if(acquirers_count==1andpms_count==0)else''"
                                       name="pm_id"t-attf-value="form_{{acq.id}}"
                                       t-att-checked="acquirers_count==1andpms_count==0oracquirers[0]==acq"/>
                            </t>
                            <tt-else="acq.payment_flow=='s2s'">
                                <inputtype="radio"t-att-data-acquirer-id="acq.id"
                                       t-att-data-s2s-payment="true"
                                       t-att-data-provider="acq.provider"
                                       name="pm_id"t-attf-value="new_{{acq.id}}"
                                       t-att-class="'d-none'if(acquirers_count==1andpms_count==0)else''"
                                       t-att-checked="acquirers_count==1andpms_count==0oracquirers[0]==acq"/>
                            </t>
                            <spanclass="payment_option_name">
                              <tt-esc="acq.display_asoracq.name"/>
                              <divt-if="acq.state=='test'"class="badge-pillbadge-warningfloat-right"style="margin-left:5px">
                                TestMode
                              </div>
                            </span>
                            <tt-if="acq_extra_feesandacq_extra_fees.get(acq)">
                                <spanclass="badgebadge-pillbadge-secondary">+<tt-esc="acq_extra_fees[acq]"t-options='{"widget":"monetary","display_currency":acq_extra_fees["currency_id"]}'/>Fee</span>
                            </t>
                            <tt-elif="acq.fees_active">
                                <smallclass="text-muted">(Somefeesmayapply)</small>
                            </t>
                        </label>
                        <ulclass="float-rightlist-inlinepayment_icon_list">
                            <tt-set="i"t-value="0"/>
                            <tt-foreach="acq.payment_icon_ids"t-as="pm_icon">
                                <lit-attf-class="list-inline-item#{''if(i&lt;MAX_BRAND_LINE)else'd-none'}">
                                    <spant-field="pm_icon.image_payment_form"
                                          t-options='{"widget":"image","alt-field":"name"}'/>
                                </li>
                                <lit-if="i==MAX_BRAND_LINE"style="display:block;"class="list-inline-item">
                                    <spanclass="float-rightmore_optiontext-info">
                                        <ahref="#"class="o_payment_form_pay_icon_more"data-toggle="tooltip"t-att-title="','.join([opt.nameforoptinacq.payment_icon_ids[MAX_BRAND_LINE:]])">andmore</a>
                                    </span>
                                </li>
                                <tt-set="i"t-value="i+1"/>
                            </t>
                        </ul>
                        <divt-raw="acq.pre_msg"class="text-mutedml-3"/>
                    </div>
                    <tt-if="acq.payment_flow=='form'">
                        <divt-attf-id="o_payment_form_acq_{{acq.id}}"
                             t-attf-class="d-none{{'card-footer'ifacq.save_token=='ask'else''}}">
                            <labelt-if="acq.save_token=='ask'">
                                <inputtype="checkbox"name="o_payment_form_save_token"data-remove-me=""/>
                                Savemypaymentdata
                            </label>
                            <tt-if="acq.save_token=='always'">
                                <inputtype="checkbox"name="o_payment_form_save_token"checked="'checked'"class="o_hidden"data-remove-me=""/>
                            </t>
                        </div>
                    </t>
                    <tt-else="acq.payment_flow=='s2s'">
                        <divt-attf-id="o_payment_add_token_acq_{{acq.id}}"
                             t-attf-class="card-footer{{'d-none'if(acquirers_count&gt;1andpms_count==0andacquirers[0]!=acq)else'd-none'ifpms_count&gt;0else''}}">
                            <divclass="clearfix">
                                <inputtype="hidden"t-if="(verify_validity==Trueormode=='manage')andacq.check_validity"name="verify_validity"t-att-value="acq.check_validity"/>
                                <tt-call="{{acq.sudo().get_s2s_form_xml_id()}}">
                                    <tt-set="id"t-value="acq.id"/>
                                    <tt-set="partner_id"t-value="partner_id"/>
                                    <tt-if="notreturn_url"t-set="return_url"t-value="''"/>
                                </t>
                            </div>
                        </div>
                    </t>
                </t>
                <tt-foreach="pms"t-as="pm">
                    <tt-if="notverify_validityor(pm.acquirer_id.check_validityandpm.verified)ornotpm.acquirer_id.check_validity">
                        <divclass="card-bodyo_payment_acquirer_select">
                            <label>
                                <inputt-if="mode=='payment'"type="radio"name="pm_id"t-att-value="pm.id"t-att-checked="checked_pm_id==pm.id"/>
                                <spanclass="payment_option_name"t-esc="pm.name"/>
                                <tt-if="pm.verified">
                                    <iclass="fafa-checktext-success"title="Thispaymentmethodisverifiedbyoursystem."role="img"aria-label="Ok"></i>
                                </t>
                                <tt-else="">
                                    <iclass="fafa-checktext-muted"title="Thispaymentmethodhasnotbeenverifiedbyoursystem."role="img"aria-label="Notverified"></i>
                                </t>
                            </label>
                            <buttont-if="mode=='manage'"name="delete_pm"t-att-value="pm.id"class="btnbtn-primarybtn-smfloat-right">
                                <iclass="fafa-trash"></i>Delete
                            </button>
                        </div>
                    </t>
                </t>
            </div>
            <divt-if='back_button_txt'class="float-leftmt-2">
                <arole="button"t-att-href="back_button_linkor'#'"t-att-class="back_button_classor'btnbtn-lgbtn-secondary'">
                    <it-if="back_button_icon_class"t-attf-class="fa{{back_button_icon_class}}"/>
                    <tt-esc="back_button_txt"/>
                </a>
            </div>
            <divclass="float-rightmt-2">
                <buttont-if="mode=='payment'"id="o_payment_form_pay"type="submit"t-att-class="submit_classifsubmit_classelse'btnbtn-primarybtn-lgmb8mt8'"disabled="true">
                    <tt-if="submit_txt">
                        <it-if="icon_classandnoticon_right"t-attf-class="fa{{icon_class}}"/>
                        <tt-esc="submit_txt"/>
                        <it-if="icon_classandicon_right"t-attf-class="fa{{icon_class}}"/>
                    </t>
                    <tt-else="">
                        <iclass="fafa-lock"/>Pay
                    </t>
                </button>
                <tt-if="show_manage_btn">
                    <aclass="btnbtn-linkmb8mt8"href="/my/payment_method">Manageyourpaymentmethods</a>
                </t>
                <buttont-if="mode=='manage'andlist(filter(lambdax:x.payment_flow=='s2s',acquirers))"type="submit"id="o_payment_form_add_pm"class="btnbtn-primarybtn-lgmb8mt8">
                    <iclass="fafa-plus-circle"/>Addnewcard
                </button>
            </div>
        </form>
    </template>

    <templateid="payment_process_page"name="Paymentprocessingpage">
        <tt-call="portal.frontend_layout">
            <divclass="wrap">
                <divclass="containero_website_payment">
                    <divclass="o_payment_processing">
                        <divclass="row">
                            <divclass="o_payment_processing_contentcol-sm-6offset-sm-3">
                                <!--ThecontenthereisgeneratedinJS-->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</flectra>
