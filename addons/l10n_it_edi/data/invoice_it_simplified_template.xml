<?xmlversion="1.0"encoding="utf-8"?>
<flectra>
    <data>
        <templateid="account_invoice_line_it_simplified_FatturaPA">
            <DatiBeniServizi>
                <Descrizione>
                    <tt-esc="format_alphanumeric(line.name[:1000])"/>
                    <tt-if="notline.name"t-esc="'NONAME'"/>
                </Descrizione>
                <Importot-esc="format_monetary(line.price_total,currency)"/>
                <DatiIVA>
                    <Impostat-esc="format_monetary(line.price_total-line.price_subtotal,currency)"/>
                </DatiIVA>
                <Naturat-if="line.tax_ids.l10n_it_has_exoneration"t-esc="line.tax_ids.l10n_it_kind_exoneration"/>
            </DatiBeniServizi>
        </template>

        <templateid="account_invoice_it_simplified_FatturaPA_export">
            <tt-set="currency"t-value="record.currency_idorrecord.company_currency_id"/>
            <tt-set="bank"t-value="record.partner_bank_id"/>
            <p:FatturaElettronicaSemplificata t-att-versione="formato_trasmissione"xmlns:ds="http://www.w3.org/2000/09/xmldsig#"xmlns:p="http://ivaservizi.agenziaentrate.gov.it/docs/xsd/fatture/v1.0"xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"xsi:schemaLocation="http://ivaservizi.agenziaentrate.gov.it/docs/xsd/fatture/v1.0http://www.fatturapa.gov.it/export/fatturazione/sdi/fatturapa/v1.0/Schema_del_file_xml_FatturaPA_versione_1.0.xsd">
            <FatturaElettronicaHeader>
                    <DatiTrasmissione>
                        <IdTrasmittente>
                            <IdPaeset-esc="get_vat_country(record.company_id.vat)"/>
                            <IdCodicet-esc="normalize_codice_fiscale(record.company_id.l10n_it_codice_fiscale)orget_vat_number(record.company_id.vat)"/>
                        </IdTrasmittente>
                        <ProgressivoInviot-esc="format_alphanumeric(record.name.replace('/','')[-10:])"/>
                        <FormatoTrasmissionet-esc="formato_trasmissione"/>
                        <CodiceDestinatariot-if="record.commercial_partner_id.l10n_it_pa_index"t-esc="record.commercial_partner_id.l10n_it_pa_index.upper()"/>
                        <CodiceDestinatariot-if="notrecord.commercial_partner_id.l10n_it_pa_index"t-esc="'0000000'"/>
                        <PECDestinatariot-if="record.commercial_partner_id.l10n_it_pec_email"t-esc="record.commercial_partner_id.l10n_it_pec_email"/>
                    </DatiTrasmissione>
                    <CedentePrestatore>
                        <IdFiscaleIVA>
                            <IdPaeset-esc="get_vat_country(record.company_id.vat)"/>
                            <IdCodicet-esc="get_vat_number(record.company_id.vat)"/>
                        </IdFiscaleIVA>
                        <CodiceFiscalet-if="record.company_id.l10n_it_codice_fiscale"t-esc="normalize_codice_fiscale(record.company_id.l10n_it_codice_fiscale)"/>
                        <Denominazionet-esc="format_alphanumeric(record.company_id.partner_id.display_name[:80])"/>
                        <tt-call="l10n_it_edi.account_invoice_it_FatturaPA_sede">
                            <tt-set="partner"t-value="record.company_id.partner_id"/>
                        </t>
                        <RappresentanteFiscalet-if="record.company_id.l10n_it_has_tax_representative">
                            <IdFiscaleIVA>
                                <IdPaeset-esc="get_vat_country(record.company_id.l10n_it_tax_representative_partner_id.vat)"/>
                                <IdCodicet-esc="get_vat_number(record.company_id.l10n_it_tax_representative_partner_id.vat)"/>
                            </IdFiscaleIVA>
                            <Anagrafica>
                                <Denominazionet-if="record.commercial_partner_id.is_company"t-esc="format_alphanumeric(record.commercial_partner_id.display_name[:80])"/>
                                <Nomet-if="notrecord.commercial_partner_id.is_company"t-esc="format_alphanumeric(''.join(record.commercial_partner_id.name.split()[:1])[:60])"/>
                                <Cognomet-if="notrecord.commercial_partner_id.is_company"t-esc="format_alphanumeric(''.join(record.commercial_partner_id.name.split()[1:])[:60])"/>
                            </Anagrafica>
                        </RappresentanteFiscale>
                        <IscrizioneREAt-if="record.company_id.l10n_it_has_eco_index">
                            <Ufficiot-esc="record.company_id.l10n_it_eco_index_office.code"/>
                            <NumeroREAt-esc="format_alphanumeric(record.company_id.l10n_it_eco_index_number)"/>
                            <CapitaleSocialet-if="record.company_id.l10n_it_eco_index_share_capital!=0"t-esc="format_numbers_two(record.company_id.l10n_it_eco_index_share_capital)"/>
                            <SocioUnicot-if="record.company_id.l10n_it_eco_index_sole_shareholder!='NO'"t-esc="record.company_id.l10n_it_eco_index_sole_shareholder"/>
                            <StatoLiquidazionet-esc="record.company_id.l10n_it_eco_index_liquidation_state"/>
                        </IscrizioneREA>
                        <RegimeFiscalet-esc="record.company_id.l10n_it_tax_system"/>
                    </CedentePrestatore>
                    <CessionarioCommittente>
                        <IdentificativiFiscali>
                            <IdFiscaleIVAt-if="record.commercial_partner_id.vatandin_eu(record.commercial_partner_id)">
                                <IdPaeset-esc="get_vat_country(record.commercial_partner_id.vat)"/>
                                <IdCodicet-esc="get_vat_number(record.commercial_partner_id.vat)"/>
                            </IdFiscaleIVA>
                            <CodiceFiscalet-if="record.commercial_partner_id.l10n_it_codice_fiscale"t-esc="normalize_codice_fiscale(record.commercial_partner_id.l10n_it_codice_fiscale)"/>
                        </IdentificativiFiscali>
                    </CessionarioCommittente>
                </FatturaElettronicaHeader>
                <FatturaElettronicaBody>
                    <DatiGenerali>
                        <DatiGeneraliDocumento>
                            <!--2.1.1-->
                            <TipoDocumentot-esc="document_type"/>
                            <Divisat-esc="currency.name"/>
                            <Datat-esc="format_date(record.invoice_date)"/>
                            <Numerot-esc="format_alphanumeric(record.name[-20:])"/>
                        </DatiGeneraliDocumento>
                        <DatiFatturaRettificatat-if="record.move_type=='out_refund'andrecord.reversed_entry_id">
                            <NumeroFRt-esc="format_alphanumeric(record.reversed_entry_id.name[-20:])"/>
                            <DataFRt-esc="format_date(record.reversed_entry_id.invoice_date)"/>
                            <ElementiRettificatit-esc="format_alphanumeric(record.ref[:1000])"/>
                        </DatiFatturaRettificata>
                    </DatiGenerali>
                    <!--Invoicelines.-->
                    <tt-foreach="record.invoice_line_ids.filtered(lambdal:notl.display_type)"t-as="line">
                        <tt-call="l10n_it_edi.account_invoice_line_it_simplified_FatturaPA"/>
                    </t>
                    <Allegatit-if="pdf">
                        <NomeAttachmentt-esc="format_alphanumeric(pdf_name[:60])"/>
                        <FormatoAttachment>PDF</FormatoAttachment>
                        <Attachmentt-esc="pdf"/>
                    </Allegati>
                </FatturaElettronicaBody>
            </p:FatturaElettronicaSemplificata>
        </template>
    </data>
</flectra>
