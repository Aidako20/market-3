flectra.define('website_forum.share',function(require){
'usestrict';

varcore=require('web.core');
varpublicWidget=require('web.public.widget');

varqweb=core.qweb;

//FIXMEThereisnoreasontoinheritfromsocialSharehere
varForumShare=publicWidget.registry.socialShare.extend({
    selector:'',
    xmlDependencies:publicWidget.registry.socialShare.prototype.xmlDependencies
        .concat(['/website_forum/static/src/xml/website_forum_share_templates.xml']),
    events:{},

    /**
     *@override
     *@param{Object}parent
     *@param{Object}options
     *@param{string}targetType
     */
    init:function(parent,options,targetType){
        this._super.apply(this,arguments);
        this.targetType=targetType;
    },
    /**
     *@override
     */
    start:function(){
        vardef=this._super.apply(this,arguments);
        this._onMouseEnter();
        returndef;
    },

    //--------------------------------------------------------------------------
    //Private
    //--------------------------------------------------------------------------

    /**
     *@private
     */
    _bindSocialEvent:function(){
        this._super.apply(this,arguments);
        $('.oe_share_bump').click($.proxy(this._postBump,this));
    },
    /**
     *@private
     */
    _render:function(){
        var$question=this.$('article.question');
        if(!this.targetType){
            this._super.apply(this,arguments);
        }elseif(this.targetType==='social-alert'){
            $question.before(qweb.render('website.social_alert',{medias:this.socialList}));
        }else{
            $('body').append(qweb.render('website.social_modal',{
                medias:this.socialList,
                target_type:this.targetType,
                state:$question.data('state'),
            }));
            $('#oe_social_share_modal').modal('show');
        }
    },
    /**
     *@private
     */
    _postBump:function(){
        this._rpc({//FIXME
            route:'/forum/post/bump',
            params:{
                post_id:this.element.data('id'),
            },
        });
    },
});

publicWidget.registry.websiteForumShare=publicWidget.Widget.extend({
    selector:'.website_forum',

    /**
     *@override
     */
    start:function(){
        //Retrievestoredsocialdata
        if(sessionStorage.getItem('social_share')){
            varsocialData=JSON.parse(sessionStorage.getItem('social_share'));
            (newForumShare(this,false,socialData.targetType)).attachTo($(document.body));
            sessionStorage.removeItem('social_share');
        }
        //Displayanalertifposthasnoreplyandisolderthan10days
        var$questionContainer=$('.oe_js_bump');
        if($questionContainer.length){
            newForumShare(this,false,'social-alert').attachTo($questionContainer);
        }

        returnthis._super.apply(this,arguments);
    },
});
});
