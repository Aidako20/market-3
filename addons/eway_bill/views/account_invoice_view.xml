<?xml version="1.0" encoding="utf-8"?>
<flectra>

    <!-- Inherit Customer Invoice Form View -->
    <record id="invoice_form_inherit_l10n_in_gst" model="ir.ui.view">
        <field name="name">account.invoice.form.inherit.gst.cust</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.invoice_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='number']" position="after">
                <field name="gst_invoice" readonly="1"
                       class="oe_right"
                       attrs="{'invisible': [('state', 'not in', ('open', 'paid'))]}"
                       style="color: #7c7bad"/>
            </xpath>
            <xpath expr="//div[@name='button_box']" position="inside">
                <field name="picking_ids" invisible="1"/>
                    <button type="object"
                            name="action_view_delivery_or_picking"
                            class="oe_stat_button button-size"
                            icon="fa-truck"
                            attrs="{'invisible': ['|', ('type', '!=', 'out_invoice'), ('delivery_count', '=', 0)]}">
                        <field name="delivery_count" widget="statinfo" string="Delivery"/>
                    </button>
                    <button type="object"
                            name="action_view_delivery_or_picking"
                            class="oe_stat_button button-size"
                            icon="fa-truck"
                            attrs="{'invisible':['|', ('type', '!=', 'out_refund', 'in_refund'), ('picking_count', '=', 0)]}">
                        <field name="picking_count" widget="statinfo"
                        string="Shipment" help="Incoming Shipments"/>
                    </button>
            </xpath>

            <xpath expr="//field[@name='payment_term_id']" position="after">
                <field name="warehouse_id" options="{'no_create': True}"
                       groups="stock.group_stock_multi_locations"/>
                <field name="refund_invoice_id"
                       domain="[('type', '=', 'out_invoice'), ('partner_id', '=', partner_id), ('state', '=', 'open')]"
                       attrs="{'invisible': ['|', ('type', 'not in', ['in_refund', 'out_refund'])], 'readonly': [('state', '!=', 'draft')], 'required': [('type', 'in', ['out_refund', 'in_refund'])]}"/>
            </xpath>

            <xpath expr="//page[@name='other_info']" position="inside">
                <group>
                    <group string="Shipping Information" name="invoice_shipping">
                        <field name="picking_policy" required="True"/>
                        <field name="inv_type" invisible="1"/>
                        <field name="incoterms_id" widget="selection"/>
                        <field name="partner_shipping_id" groups="account_stock.invoice_to_delivery_order"/>
                    </group>
                </group>
            </xpath>
            <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='quantity']" position="after">
                <field name="qty_delivered"
                       attrs="{'column_invisible': ['|', ('parent.type', '=', 'out_refund'), ('parent.state', 'not in', ['open', 'done'])], 'readonly': [('qty_delivered_updateable', '=', False)]}"
                       />
                <field name="qty_delivered_updateable" invisible="1"/>
                <field name="qty_received"
                       attrs="{'column_invisible': ['|',('parent.type', '=', 'out_invoice'), ('parent.state', 'not in', ['open', 'done'])], 'readonly': [('parent.state', 'in', ['open', 'done'])]}"
                       />
                <field name="route_id"
                       options="{'no_create': True}" invisible="1"/>
            </xpath>

            <xpath expr="//button[@name='action_invoice_open']" position="after">
                <button name="create_picking" type="object" 
                  attrs="{'invisible':['|', '|', ('sent','=',True), ('state', 'not in', ('open','paid')), ('delivery_count', '&gt;', 0)]}"
                  string="Create Picking" groups="base.group_user"/>
                  <button name="%(action_create_eway_bill_invoice_wizard)d" type='action' string='Generate EWay Bill'
                  attrs="{'invisible':['|', '|', ('state', 'not in', ('open','paid')), ('delivery_count', '&lt;', 0), ('all_picking_done', '=', False)]}"/>
            </xpath>

            <xpath expr="//field[@name='fiscal_position_id']" position="replace"/>
            <xpath expr="//field[@name='date_invoice']" position="after">
                <field name="partner_location" invisible="1"/>
                <field name="all_picking_done" invisible="1"/>
                <field name="fiscal_position_id"
                       options="{'no_create': True}"
                       attrs="{'required': [('partner_location', '=', 'inter_country')]}"/>
                <field name="gst_type" readonly="1"
                       attrs="{'invisible': [('state', 'not in', ('open', 'paid'))]}"/>
                <field name="vat" readonly="1"
                       attrs="{'invisible': [('state', 'not in', ('open', 'paid'))]}"/>
            </xpath>
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="e_commerce_partner_id"
                       attrs="{'readonly': [('state', 'not in', 'draft')]}"
                       domain="[('e_commerce', '=', True)]"/>
                <field name="eway_bill_id" readonly="1"/>
            </xpath>
            <xpath expr="//field[@name='tax_line_ids']" position="replace"/>
            <xpath expr="//group[@name='left_panel']" position="inside">
                    <field name="tax_line_ids" attrs="{'invisible': [('tax_line_ids', '=', [])]}" nolabel="1" colspan="4">
                        <tree editable="bottom" string="Taxes"
                              create="0">
                            <field name="name"/>
                            <field name="tax_id" invisible="1"/>
                            <field name="account_analytic_id"
                                   invisible="1"/>
                            <field name="sequence" invisible="1"/>
                            <field name="manual" invisible="1"/>
                            <field name="account_id"
                                   groups="account.group_account_user"/>
                            <field name="amount"/>
                            <field name="currency_id" invisible="1"/>
                        </tree>
                    </field>
            </xpath>
            <xpath expr="//page[@name='other_info']/group/group/field[@name='name']"
                    position="attributes">
                <attribute name="attrs">{'readonly': [('type', '=', 'out_refund')]}</attribute>
            </xpath>
        </field>
    </record>

    <!-- Inherit Supplier Invoice Form View -->
    <record id="invoice_supplier_form_inherit_l10n_in_gst" model="ir.ui.view">
        <field name="name">account.invoice.form.inherit.gst</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.invoice_supplier_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='number']" position="after">
                <field name="gst_invoice" readonly="1"
                       class="oe_inline oe_right"
                       attrs="{'invisible': [('state', 'not in', ('open', 'paid'))]}"
                       style="color: #7c7bad"/>
            </xpath>
            <xpath expr="//field[@name='fiscal_position_id']" position="replace"/>
            <xpath expr="//field[@name='date_invoice']" position="after">
                <field name="partner_location" invisible="1"/>
                <field name="fiscal_position_id"
                       options="{'no_create': True}"
                       attrs="{'required': [('partner_location', '=', 'inter_country')]}"/>
                <field name="gst_type" readonly="1"
                       attrs="{'invisible': [('state', 'not in', ('open', 'paid'))]}"/>
                <field name="vat" readonly="1"
                       attrs="{'invisible': [('state', 'not in', ('open', 'paid'))]}"/>
            </xpath>
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="e_commerce_partner_id"
                       attrs="{'readonly': [('state', '!=', 'draft')]}"
                       domain="[('e_commerce', '=', True)]"/>
            </xpath>
            <xpath expr="//field[@name='tax_line_ids']" position="attributes">
                <attribute name="attrs">{'invisible': [('tax_line_ids', '=', [])]}</attribute>
            </xpath>
        </field>
    </record>

    <!-- Inherit Invoice Search View -->
    <record id="view_account_invoice_search_inherit_l10n_in_gst" model="ir.ui.view">
        <field name="name">account.invoice.search.inherit.gst</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter"/>
        <field name="arch" type="xml">
            <group expand="0" position="inside">
                <filter string="GST Invoice"
                        context="{'group_by':'gst_invoice'}"/>
                <filter string="E-Commerce"
                        context="{'group_by':'e_commerce_partner_id'}"/>
            </group>
        </field>
    </record>

     <record id="view_account_invoice_refund_inherit" model="ir.ui.view">
            <field name="name">account.invoice.refund.inherit.form</field>
            <field name="model">account.invoice.refund</field>
            <field name="inherit_id" ref="account.view_account_invoice_refund"/>
            <field name="arch" type="xml">
                <button name="invoice_refund" position="attributes">
                    <attribute name="context">{'filter_refund': filter_refund}</attribute>
                </button>
            </field>
    </record>

</flectra>