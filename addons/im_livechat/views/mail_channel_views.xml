<?xmlversion="1.0"?>
<flectra>
    <data>

        <recordid="mail_channel_view_search"model="ir.ui.view">
            <fieldname="name">mail.channel.search</field>
            <fieldname="model">mail.channel</field>
            <fieldname="arch"type="xml">
                <searchstring="Searchhistory">
                    <fieldname="name"/>
                    <groupexpand="0"string="GroupBy...">
                        <filtername="group_by_channel"string="Channel"domain="[]"context="{'group_by':'livechat_channel_id'}"/>
                        <separatororientation="vertical"/>
                        <filtername="group_by_month"string="CreationDate"domain="[]"context="{'group_by':'create_date:month'}"/>
                    </group>
                </search>
            </field>
        </record>

        <recordid="mail_channel_view_tree"model="ir.ui.view">
            <fieldname="name">mail.channel.tree</field>
            <fieldname="model">mail.channel</field>
            <fieldname="arch"type="xml">
                <treestring="History"create="false"default_order="create_datedesc">
                    <fieldname="create_date"string="SessionDate"/>
                    <fieldname="name"string="Attendees"/>
                    <fieldname="channel_message_ids"string="#Messages"/>
                    <fieldname="rating_last_image"string="Rating"widget="image"options='{"size":[20,20]}'/>
                </tree>
            </field>
        </record>

        <recordid="mail_channel_view_form"model="ir.ui.view">
            <fieldname="name">mail.channel.form</field>
            <fieldname="model">mail.channel</field>
            <fieldname="arch"type="xml">
                <formstring="SessionForm"create="false"edit="false">
                    <sheet>
                        <divstyle="width:50%"class="float-right">
                            <fieldname="rating_last_image"widget="image"class="float-right"readonly="1"nolabel="1"/>
                            <fieldname="rating_last_feedback"nolabel="1"/>
                        </div>
                        <divstyle="width:50%"class="float-left">
                            <group>
                                <fieldname="name"string="Attendees"/>
                                <fieldname="create_date"readonly="1"string="SessionDate"/>
                            </group>
                        </div>

                        <groupstring="History"class="o_history_container">
                            <divclass="o_history_kanban_container">
                                <divclass="o_history_kanban_sub_container">
                                    <fieldname="message_ids"mode="kanban">
                                        <kanbandefault_order="create_dateDESC">
                                            <fieldname="author_id"/>
                                            <fieldname="body"/>
                                            <fieldname="create_date"groups="base.group_no_one"/>
                                            <fieldname="id"/>
                                            <fieldname="author_avatar"/>
                                            <templates>
                                                <tt-name="kanban-box">
                                                    <divclass="oe_module_vignette">
                                                        <divclass="o_kanban_image">
                                                            <div>
                                                                 <tt-if="record.author_avatar.raw_value">
                                                                    <imgt-att-src="kanban_image('mail.message','author_avatar',record.id.raw_value)"alt="Avatar"class="o_image_64_coverrounded-circle"/>
                                                                 </t>
                                                                 <tt-else=""><imgalt="Anonymous"src="/mail/static/src/img/smiley/avatar.jpg"class="o_image_64_coverrounded-circle"/></t>
                                                            </div>
                                                        </div>
                                                        <divclass="oe_module_desc">
                                                            <divclass="float-right"><p><fieldname="date"/></p></div>
                                                            <div>
                                                                <p><strong>
                                                                    <tt-if="record.author_id.raw_value"><fieldname="author_id"/></t>
                                                                    <tt-else="">Anonymous</t>
                                                                </strong></p>
                                                                <p>
                                                                    <tt-if="record.body.raw_value"><fieldname="body"widget="html"/><br/></t>
                                                                </p>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </t>
                                            </templates>
                                         </kanban>
                                    </field>
                                </div>
                            </div>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>


        <recordid="mail_channel_action"model="ir.actions.act_window">
            <fieldname="name">History</field>
            <fieldname="res_model">mail.channel</field>
            <fieldname="view_mode">tree,form</field>
            <fieldname="search_view_id"ref="im_livechat.mail_channel_view_search"/>
            <fieldname="domain">[('livechat_channel_id','!=',None)]</field>
            <fieldname="context">{'search_default_session_not_empty':1}</field>
            <fieldname="help"type="html">
                <pclass="o_view_nocontent_empty_folder">
                    Yourchatterhistoryisempty
                </p><p>
                    Createachannelandstartchattingtofillupyourhistory.
                </p>
            </field>
        </record>
        <recordid="mail_channel_action_tree"model="ir.actions.act_window.view">
            <fieldname="sequence">1</field>
            <fieldname="view_mode">tree</field>
            <fieldname="view_id"ref="im_livechat.mail_channel_view_tree"/>
            <fieldname="act_window_id"ref="im_livechat.mail_channel_action"/>
        </record>

        <recordid="mail_channel_action_form"model="ir.actions.act_window.view">
            <fieldname="sequence">2</field>
            <fieldname="view_mode">form</field>
            <fieldname="view_id"ref="im_livechat.mail_channel_view_form"/>
            <fieldname="act_window_id"ref="im_livechat.mail_channel_action"/>
        </record>


        <recordid="mail_channel_action_from_livechat_channel"model="ir.actions.act_window">
            <fieldname="name">Sessions</field>
            <fieldname="res_model">mail.channel</field>
            <fieldname="view_mode">tree,form</field>
            <fieldname="domain">[('livechat_channel_id','in',[active_id]),('channel_message_ids','!=',False)]</field>
            <fieldname="context">{
                'search_default_livechat_channel_id':[active_id],
                'default_livechat_channel_id':active_id,
            }</field>
            <fieldname="search_view_id"ref="mail_channel_view_search"/>
        </record>
        <recordid="mail_channel_action_livechat_tree"model="ir.actions.act_window.view">
            <fieldname="sequence">1</field>
            <fieldname="view_mode">tree</field>
            <fieldname="view_id"ref="im_livechat.mail_channel_view_tree"/>
            <fieldname="act_window_id"ref="im_livechat.mail_channel_action_from_livechat_channel"/>
        </record>

        <recordid="mail_channel_action_livechat_form"model="ir.actions.act_window.view">
            <fieldname="sequence">2</field>
            <fieldname="view_mode">form</field>
            <fieldname="view_id"ref="im_livechat.mail_channel_view_form"/>
            <fieldname="act_window_id"ref="im_livechat.mail_channel_action_from_livechat_channel"/>
        </record>


    </data>
</flectra>
