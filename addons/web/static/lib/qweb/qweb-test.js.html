<!doctypehtml>
<html>
<head>
    <scriptsrc="/web/static/lib/jquery/jquery.js"></script>
    <linkrel="stylesheet"href="/web/static/lib/qunit/qunit.css"type="text/css"media="screen"/>
    <scripttype="text/javascript"src="/web/static/lib/qunit/qunit.js"></script>

    <scripttype="text/javascript"src="qweb2.js"></script>

    <script>
        QWeb=newQWeb2.Engine();
        functiontrim(s){
            returns.replace(/(^\s+|\s+$)/g,'');
        }
        functionrender(template,context){
            returntrim(QWeb.render(template,context)).toLowerCase();
        }

        /**
         *Loadsthetemplatefile,andexecutesallthetesttemplateina
         *qunitmodule$title
         */
        functiontest(title,template){
            QUnit.module(title,{
                setup:function(){
                    varself=this;
                    this.qweb=newQWeb2.Engine();
                    QUnit.stop();
                    this.qweb.add_template(template,function(_,doc){
                        self.doc=doc;
                        QUnit.start();
                    })
                }
            });
            QUnit.test('autotest',function(assert){
                vartemplates=this.qweb.templates;
                for(vartemplateintemplates){
                    if(!templates.hasOwnProperty(template)){continue;}
                    //ignoretemplateswhosenamestartswith_,they're
                    //helpers/internal
                    if(/^_/.test(template)){continue;}

                    varparams=this.doc.querySelector('params#'+template);
                    varargs=params?JSON.parse(params.textContent):{};

                    varresults=this.doc.querySelector('result#'+template);
                    assert.equal(
                        trim(this.qweb.render(template,args)),
                        trim(results.textContent),
                        template);
                }
            });
        }
        $(document).ready(function(){
            test("Output",'qweb-test-output.xml');
            test("Context-setting",'qweb-test-set.xml');
            test("Conditionals",'qweb-test-conditionals.xml');
            test("Attributesmanipulation",'qweb-test-attributes.xml');
            test("Templatecalling(tothefarawaypages)",
                 'qweb-test-call.xml');
            test("Foreach",'qweb-test-foreach.xml');
            test("Global",'qweb-test-global.xml');

            test('Templateinheritance','qweb-test-extend.xml');
        });
    </script>

</head>
<body>
  <divid="qunit"></div>
  <divid="qunit-fixture"></div>
</body>
</html>
