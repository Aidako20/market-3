<flectra>
    <!--Goalviews-->
    <recordid="goal_list_action"model="ir.actions.act_window">
        <fieldname="name">Goals</field>
        <fieldname="res_model">gamification.goal</field>
        <fieldname="view_mode">tree,form,kanban</field>
        <fieldname="context">{'search_default_group_by_user':True,'search_default_group_by_definition':True}</field>
        <fieldname="help"type="html">
            <pclass="o_view_nocontent_smiling_face">
                Createanewgoal
            </p><p>
                Agoalisdefinedbyauserandagoaldefinition.
                Goalscanbecreatedautomaticallybyusingchallenges.
            </p>
        </field>
    </record>

    <recordid="goal_list_view"model="ir.ui.view">
        <fieldname="name">GoalList</field>
        <fieldname="model">gamification.goal</field>
        <fieldname="arch"type="xml">
            <treestring="GoalList"decoration-danger="state=='failed'"decoration-success="state=='reached'"decoration-muted="state=='canceled'"create="false">
                <fieldname="definition_id"invisible="1"/>
                <fieldname="user_id"invisible="1"/>
                <fieldname="start_date"/>
                <fieldname="end_date"/>
                <fieldname="current"/>
                <fieldname="target_goal"/>
                <fieldname="completeness"widget="progressbar"/>
                <fieldname="state"invisible="1"/>
                <fieldname="line_id"invisible="1"/>
            </tree>
        </field>
    </record>

    <recordid="goal_form_view"model="ir.ui.view">
        <fieldname="name">GoalForm</field>
        <fieldname="model">gamification.goal</field>
        <fieldname="arch"type="xml">
            <formstring="Goal"create="false">
                <header>
                    <buttonstring="Startgoal"type="object"name="action_start"states="draft"class="oe_highlight"/>

                    <buttonstring="GoalReached"type="object"name="action_reach"states="inprogress"/>
                    <buttonstring="GoalFailed"type="object"name="action_fail"states="inprogress"/>
                    <buttonstring="ResetCompletion"type="object"name="action_cancel"states="failed,reached"groups="base.group_no_one"/>
                    <fieldname="state"widget="statusbar"statusbar_visible="draft,inprogress,reached"/>
                </header>
                <sheet>
                    <group>
                        <groupstring="Reference">
                            <fieldname="definition_id"attrs="{'readonly':[('state','!=','draft')]}"/>
                            <fieldname="user_id"attrs="{'readonly':[('state','!=','draft')]}"/>
                            <fieldname="challenge_id"/>
                        </group>
                        <groupstring="Schedule">
                            <fieldname="start_date"attrs="{'readonly':[('state','!=','draft')]}"/>
                            <fieldname="end_date"/>
                            <fieldname="computation_mode"invisible="1"/>

                            <labelfor="remind_update_delay"attrs="{'invisible':[('computation_mode','!=','manually')]}"/>
                            <divattrs="{'invisible':[('computation_mode','!=','manually')]}">
                                <fieldname="remind_update_delay"class="oe_inline"/>
                                days
                            </div>
                            <fieldname="last_update"groups="base.group_no_one"/>
                        </group>
                        <groupstring="Data"colspan="4">
                            <labelfor="target_goal"/>
                            <div>
                                <fieldname="target_goal"attrs="{'readonly':[('state','!=','draft')]}"class="oe_inline"/>
                                <fieldname="definition_suffix"class="oe_inline"/>
                            </div>
                            <labelfor="current"/>
                            <div>
                                <fieldname="current"class="oe_inline"/>
                                <buttonstring="refresh"type="object"name="update_goal"class="oe_link"attrs="{'invisible':['|',('computation_mode','=','manually'),('state','=','draft')]}"/>
                                <divclass="oe_grey"attrs="{'invisible':[('definition_id','=',False)]}">
                                    Reachedwhencurrentvalueis<strong><fieldname="definition_condition"class="oe_inline"/></strong>thanthetarget.
                                </div>
                            </div>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <recordid="goal_search_view"model="ir.ui.view">
        <fieldname="name">GoalSearch</field>
        <fieldname="model">gamification.goal</field>
        <fieldname="arch"type="xml">
            <searchstring="SearchGoals">
                <filtername="my"string="MyGoals"domain="[('user_id','=',uid)]"/>
                <separator/>
                <filtername="draft"string="Draft"domain="[('state','=','draft')]"/>
                <filtername="inprogress"string="Running"
                    domain="[
                        '|',
                            ('state','=','inprogress'),
                            '&amp;',
                                ('state','in',('done','failed')),
                                ('end_date','>=',context_today().strftime('%%Y-%%m-%%d'))
                    ]"/>
                <filtername="closed"string="Done"
                    domain="[
                        ('state','in',('reached','failed')),
                        '|',
                            ('end_date','=',False),
                            ('end_date','&lt;',context_today().strftime('%%Y-%%m-%%d'))
                    ]"/>
                <separator/>

                <fieldname="user_id"/>
                <fieldname="definition_id"/>
                <fieldname="challenge_id"/>
                <groupexpand="0"string="GroupBy">
                    <filtername="group_by_user"string="User"domain="[]"context="{'group_by':'user_id'}"/>
                    <filtername="group_by_definition"string="GoalDefinition"domain="[]"context="{'group_by':'definition_id'}"/>
                    <filterstring="State"name="state"domain="[]"context="{'group_by':'state'}"/>
                    <filterstring="EndDate"name="enddate"domain="[]"context="{'group_by':'end_date'}"/>
                </group>
            </search>
        </field>
    </record>

    <recordid="goal_kanban_view"model="ir.ui.view">
        <fieldname="name">GoalKanbanView</field>
        <fieldname="model">gamification.goal</field>
        <fieldname="arch"type="xml">
            <kanbanclass="oe_background_grey"create="false">
                <fieldname="definition_id"/>
                <fieldname="user_id"/>
                <fieldname="current"/>
                <fieldname="completeness"/>
                <fieldname="state"/>
                <fieldname="target_goal"/>
                <fieldname="definition_description"/>
                <fieldname="definition_condition"/>
                <fieldname="definition_suffix"/>
                <fieldname="definition_display"/>
                <fieldname="start_date"/>
                <fieldname="end_date"/>
                <fieldname="last_update"/>
                <templates>
                    <tt-name="kanban-tooltip">
                        <ulclass="oe_kanban_tooltip">
                            <li><tt-esc="record.definition_description.value"/></li>
                        </ul>
                    </t>
                    <tt-name="kanban-box">
                        <divt-attf-class="oe_kanban_cardoe_kanban_global_clicko_kanban_gamification#{record.end_date.raw_value&lt;record.last_update.raw_value&amp;record.state.raw_value=='failed'?'oe_kanban_color_2':''}#{record.end_date.raw_value&lt;record.last_update.raw_value&amp;record.state.raw_value=='reached'?'oe_kanban_color_5':''}">
                            <divclass="o_kanban_content">
                                <p><strong><h4class="oe_goal_nametext-center"tooltip="kanban-tooltip"><fieldname="definition_id"/></h4></strong></p>
                                <divclass="float-left">
                                    <imgclass="o_image_24_cover"t-att-src="kanban_image('res.users','image_128',record.user_id.raw_value)"t-att-title="record.user_id.value"t-att-alt="record.user_id.value"/>
                                </div>
                                <fieldname="user_id"/>
                                <divclass="o_goal_state_block">
                                    <tt-if="record.definition_display.raw_value=='boolean'">
                                        <divclass="o_goal_statetext-center">
                                            <tt-if="record.state.raw_value=='reached'"><irole="img"class="o_greenfafa-checkfa-3x"title="GoalReached"aria-label="GoalReached"/></t>
                                            <tt-if="record.state.raw_value=='inprogress'"><irole="img"class="fafa-clock-ofa-3x"title="GoalinProgress"aria-label="GoalinProgress"/></t>
                                            <tt-if="record.state.raw_value=='failed'"><irole="img"class="o_redfafa-timesfa-3x"title="GoalFailed"aria-label="GoalFailed"/></t>
                                        </div>
                                    </t>
                                    <tt-if="record.definition_display.raw_value=='progress'">
                                        <tt-if="record.definition_condition.raw_value=='higher'">
                                            <fieldname="current"widget="gauge"options="{'max_field':'target_goal','label_field':'definition_suffix','style':'width:160px;height:120px;'}"/>
                                        </t>
                                        <tt-if="record.definition_condition.raw_value!='higher'">
                                            <divt-attf-class="o_goal_state#{record.current.raw_value==record.target_goal.raw_value+1?'o_orange':record.current.raw_value&gt;record.target_goal.raw_value?'o_red':'o_green'}">
                                                <tt-esc="record.current.raw_value"/>
                                            </div>
                                            <em>Target:lessthan<tt-esc="record.target_goal.raw_value"/></em>
                                        </t>
                                    </t>

                                </div>
                                <pclass="text-center">
                                    <tt-if="record.start_date.value">
                                        From<tt-esc="record.start_date.value"/>
                                    </t>
                                    <tt-if="record.end_date.value">
                                        To<tt-esc="record.end_date.value"/>
                                    </t>
                                </p>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>


    <!--Goaldefinitionsview-->

    <recordid="goal_definition_list_action"model="ir.actions.act_window">
        <fieldname="name">GoalDefinitions</field>
        <fieldname="res_model">gamification.goal.definition</field>
        <fieldname="view_mode">tree,form</field>
        <fieldname="help"type="html">
            <pclass="o_view_nocontent_smiling_face">
                Createanewgoaldefinition
            </p><p>
                Agoaldefinitionisatechnicalspecificationofaconditiontoreach.
                Thedates,valuestoreachorusersaredefinedingoalinstance.
            </p>
        </field>
    </record>

    <recordid="goal_definition_list_view"model="ir.ui.view">
        <fieldname="name">GoalDefinitionsList</field>
        <fieldname="model">gamification.goal.definition</field>
        <fieldname="arch"type="xml">
            <treestring="GoalDefinitions">
                <fieldname="name"/>
                <fieldname="computation_mode"/>
            </tree>
        </field>
    </record>


    <recordid="goal_definition_form_view"model="ir.ui.view">
        <fieldname="name">GoalDefinitionsForm</field>
        <fieldname="model">gamification.goal.definition</field>
        <fieldname="arch"type="xml">
            <formstring="Goaldefinitions">
                <sheet>
                        <labelfor="name"class="oe_edit_only"/>
                        <h1>
                            <fieldname="name"/>
                        </h1>
                        <labelfor="description"class="oe_edit_only"/>
                        <div>
                            <fieldname="description"class="oe_inline"/>
                        </div>

                        <groupstring="Howisthegoalcomputed?"name="compute_details">

                            <fieldwidget="radio"name="computation_mode"/>

                            <!--Hidethefieldsbelowifmanually-->
                            <fieldname="model_id"class="oe_inline"
                                attrs="{'invisible':[('computation_mode','notin',('sum','count'))],'required':[('computation_mode','in',('sum','count'))]}"/>
                            <fieldname="model_inherited_ids"invisible="1"/>
                            <fieldname="field_id"class="oe_inline"
                                attrs="{'invisible':[('computation_mode','!=','sum')],'required':[('computation_mode','=','sum')]}"/>
                            <fieldname="field_date_id"class="oe_inline"attrs="{'invisible':[('computation_mode','notin',('sum','count'))]}"/>
                            <fieldname="domain"attrs="{'invisible':[('computation_mode','notin',('sum','count'))],'required':[('computation_mode','in',('sum','count'))]}"class="oe_inline"/>
                            <fieldname="compute_code"attrs="{'invisible':[('computation_mode','!=','python')],'required':[('computation_mode','=','python')]}"/>
                            <fieldname="condition"widget="radio"/>
                        </group>
                        <groupstring="Optimisation"name="optimisation"attrs="{'invisible':[('computation_mode','notin',('sum','count'))]}">
                            <fieldname="batch_mode"/>
                            <divcolspan="2">Inbatchmode,thedomainisevaluatedglobally.Ifenabled,donotusekeyword'user'inabovefilterdomain.</div>
                            <fieldname="batch_distinctive_field"attrs="{'invisible':[('batch_mode','=',False)],'required': [('batch_mode','=',True)]}"
                                domain="[('model_id','=',model_id)]"class="oe_inline"/>
                            <fieldname="batch_user_expression"attrs="{'invisible':[('batch_mode','=',False)],'required': [('batch_mode','=',True)]}"class="oe_inline"
                                placeholder="e.g.user.partner_id.id"/>
                        </group>
                        <groupstring="FormattingOptions"name="format_options">
                            <fieldname="display_mode"widget="radio"/>
                            <fieldname="suffix"placeholder="e.g.days"class="oe_inline"/>
                            <fieldname="monetary"/>
                        </group>
                        <groupstring="ClickableGoals"name="clickable_goals"attrs="{'invisible':[('computation_mode','=','manually')]}">
                            <fieldname="action_id" class="oe_inline"/>
                            <fieldname="res_id_field" attrs="{'invisible':[('action_id','=',False)]}"class="oe_inline"/>
                        </group>

                </sheet>
            </form>
        </field>
    </record>

    <recordid="goal_definition_search_view"model="ir.ui.view">
        <fieldname="name">GoalDefinitionSearch</field>
        <fieldname="model">gamification.goal.definition</field>
        <fieldname="arch"type="xml">
            <searchstring="SearchGoalDefinitions">
                <fieldname="name"/>
                <fieldname="model_id"/>
                <fieldname="field_id"/>
                <groupexpand="0"string="GroupBy">
                    <filterstring="Model"name="model"domain="[]"context="{'group_by':'model_id'}"/>
                    <filterstring="ComputationMode"name="computationmode"domain="[]"context="{'group_by':'computation_mode'}"/>
                </group>
            </search>
        </field>
    </record>

    <!--menusinsettings-technicalfeaturerequired-->
    <menuitemid="gamification_menu"name="GamificationTools"parent="base.menu_administration"groups="base.group_no_one"/>
        <menuitemid="gamification_challenge_menu"parent="gamification_menu"action="challenge_list_action"sequence="0"/>
        <menuitemid="gamification_goal_menu"parent="gamification_menu"action="goal_list_action"sequence="10"/>
        <menuitemid="gamification_definition_menu"parent="gamification_menu"action="goal_definition_list_action"sequence="20"/>
        <menuitemid="gamification_badge_menu"parent="gamification_menu"action="badge_list_action"sequence="30"/>
</flectra>
