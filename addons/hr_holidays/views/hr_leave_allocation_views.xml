<?xmlversion='1.0'encoding='UTF-8'?>
<flectra>

    <recordid="view_hr_leave_allocation_filter"model="ir.ui.view">
        <fieldname="name">hr.holidays.filter_allocations</field>
        <fieldname="model">hr.leave.allocation</field>
        <fieldname="arch"type="xml">
            <searchstring="Searchallocations">
                <fieldname="employee_id"/>
                <fieldname="name"/>
                <fieldname="allocation_type"/>
                <filterdomain="[('state','in',('confirm','validate1'))]"string="ToApprove"name="approve"/>
                <filterdomain="[('state','=','validate1')]"string="NeedSecondApproval"name="second_approval"/>
                <filterstring="ApprovedAllocations"domain="[('state','=','validate')]"name="validated"/>
                <filterstring="AccrualAllocations"domain="[('allocation_type','=','accrual')]"name="accrual_allocation"/>
                <separator/>
                <filtername="active_types"string="ActiveTypes"domain="[('holiday_status_id.active','=',True)]"help="Filtersonlyonallocationsthatbelongtoantimeofftypethatis'active'(activefieldisTrue)"/>
                <separator/>
                <filterstring="UnreadMessages"name="message_needaction"domain="[('message_needaction','=',True)]"/>
                <separator/>
                <filterstring="PeopleIManage"name="managed_people"domain="[('employee_id.leave_manager_id','=',uid)]"help="Timeoffofpeopleyouaremanagerof"/>
                <filterstring="MyTeamTimeOff"name="my_team_leaves"domain="[('employee_id.parent_id.user_id','=',uid)]"groups="hr_holidays.group_hr_holidays_manager"help="TimeOffofYourTeamMember"/>
                <separator/>
                <filtername="year"string="CurrentYear"
                    domain="[('holiday_status_id.active','=',True)]"help="ActiveAllocations"/>
                <separator/>
                <filterstring="MyAllocations"name="my_leaves"domain="[('employee_id.user_id','=',uid)]"/>
                <separator/>
                <fieldname="department_id"operator="child_of"/>
                <fieldname="holiday_status_id"/>
                <filterinvisible="1"string="LateActivities"name="activities_overdue"
                    domain="[('my_activity_date_deadline','&lt;',context_today().strftime('%Y-%m-%d'))]"
                    help="Showallrecordswhichhasnextactiondateisbeforetoday"/>
                <filterinvisible="1"string="TodayActivities"name="activities_today"
                    domain="[('my_activity_date_deadline','=',context_today().strftime('%Y-%m-%d'))]"/>
                <filterinvisible="1"string="FutureActivities"name="activities_upcoming_all"
                        domain="[('my_activity_date_deadline','&gt;',context_today().strftime('%Y-%m-%d'))
                        ]"/>
                <groupexpand="0"string="GroupBy">
                    <filtername="group_employee"string="Employee"context="{'group_by':'employee_id'}"/>
                    <filtername="group_type"string="Type"context="{'group_by':'holiday_status_id'}"/>
                    <filtername="group_state"string="Status"context="{'group_by':'state'}"/>
                </group>
                <searchpanel>
                    <fieldname="state"string="Status"/>
                </searchpanel>
            </search>
        </field>
    </record>

    <recordid="hr_leave_allocation_view_form"model="ir.ui.view">
        <fieldname="name">hr.leave.allocation.view.form</field>
        <fieldname="model">hr.leave.allocation</field>
        <fieldname="priority">32</field>
        <fieldname="arch"type="xml">
            <formstring="AllocationRequest">
                <fieldname="can_reset"invisible="1"/>
                <fieldname="can_approve"invisible="1"/>
                <fieldname="holiday_type"invisible="1"/>
                <header>
                    <buttonstring="Confirm"name="action_confirm"states="draft"type="object"class="oe_highlight"/>
                    <fieldname="state"widget="statusbar"statusbar_visible="draft,confirm,validate"/>
                </header>
                <sheet>
                    <divclass="oe_button_box"name="button_box">
                        <button
                            class="oe_stat_button"
                            icon="fa-calendar"
                            type="action"
                            attrs="{'invisible':[('holiday_type','!=','employee')]}"
                            name="%(hr_leave_action_action_approve_department)d"
                            context="{'search_default_employee_id':[employee_id],'search_default_holiday_status_id':[holiday_status_id],'default_holiday_status_id':holiday_status_id}"
                            help="TimeoffTaken/TotalAllocated">
                            <divclass="o_stat_info">
                                <spanclass="o_stat_value">
                                    <fieldname="leaves_taken"digits="[42,1]"/>/<fieldname="max_leaves"digits="[42,1]"/>
                                </span>
                                <spanclass="o_stat_text">
                                    TimeOff
                                </span>
                            </div>
                        </button>
                    </div>
                    <divclass="oe_title">
                        <h2><fieldname="name"placeholder="e.g.PublicHolidayAllocation"attrs="{'readonly':[('state','notin',('draft','confirm'))]}"required="1"/></h2>
                    </div>
                    <group>
                        <group>
                            <fieldname="type_request_unit"invisible="1"/>
                            <fieldname="holiday_status_id"context="{'employee_id':employee_id}"/>

                            <fieldname="allocation_type"invisible="1"widget="radio"/>

                            <fieldname="number_of_days_display"invisible="1"/>
                            <fieldname="number_of_days"invisible="1"/>
                            <divclass="o_td_label">
                                <labelfor="number_of_days"string="Duration"attrs="{'invisible':[('allocation_type','=','accrual')]}"/>
                                <labelfor="number_of_days"string="Extradays"attrs="{'invisible':[('allocation_type','!=','accrual')]}"/>
                            </div>
                            <div>
                                <fieldname="number_of_days_display"class="oe_inline"nolabel="1"
                                    attrs="{'readonly':['|',('type_request_unit','=','hour'),('state','notin',('draft','confirm'))],'invisible':[('type_request_unit','=','hour')]}"/>
                                <fieldname="number_of_hours_display"class="oe_inline"nolabel="1"
                                    attrs="{'readonly':['|',('type_request_unit','!=','hour'),('state','notin',('draft','confirm'))],'invisible':[('type_request_unit','!=','hour')]}"/>
                                <spanclass="ml8"attrs="{'invisible':[('type_request_unit','=','hour')]}">Days</span>
                                <spanclass="ml8"attrs="{'invisible':[('type_request_unit','!=','hour')]}">Hours</span>
                            </div>
                        </group>
                        <groupname="alloc_right_col">
                            <fieldname="employee_id"invisible="1"groups="hr_holidays.group_hr_holidays_user"/>
                            <fieldname="department_id"invisible="1"/>
                        </group>
                    </group>
                    <fieldname="notes"nolabel="1"placeholder="Addareason..."/>
                </sheet>
                <divclass="oe_chatter">
                    <fieldname="message_follower_ids"/>
                    <fieldname="activity_ids"/>
                    <fieldname="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <recordid="hr_leave_allocation_view_form_manager"model="ir.ui.view">
        <fieldname="name">hr.leave.allocation.view.form.manager</field>
        <fieldname="model">hr.leave.allocation</field>
        <fieldname="inherit_id"ref="hr_holidays.hr_leave_allocation_view_form"/>
        <fieldname="mode">primary</field>
        <fieldname="priority">16</field>
        <fieldname="arch"type="xml">
            <xpathexpr="//button[@name='action_confirm']"position="after">
                <buttonstring="Approve"name="action_approve"states="confirm"type="object"class="oe_highlight"
                    attrs="{'invisible':['|',('can_approve','=',False),('state','!=','confirm')]}"/>
                <buttonstring="Validate"name="action_validate"states="validate1"type="object"class="oe_highlight"/>
                <buttonstring="Refuse"name="action_refuse"type="object"
                    attrs="{'invisible':['|',('can_approve','=',False),('state','notin',('confirm','validate1','validate'))]}"/>
                <buttonstring="MarkasDraft"name="action_draft"type="object"
                        attrs="{'invisible':['|',('can_reset','=',False),('state','notin',['confirm','refuse'])]}"/>
            </xpath>
            <xpathexpr="//field[@name='employee_id']"position="before">
                <fieldname="holiday_type"string="Mode"groups="hr_holidays.group_hr_holidays_user"context="{'employee_id':employee_id}"/>
            </xpath>
            <xpathexpr="//field[@name='employee_id']"position="replace">
                <fieldname="employee_id"groups="hr_holidays.group_hr_holidays_user"
                    attrs="{'required':[('holiday_type','=','employee')],'invisible':[('holiday_type','!=','employee')]}"/>
            </xpath>
            <xpathexpr="//field[@name='employee_id']"position="after">
                <fieldname="category_id"
                    attrs="{'required':[('holiday_type','=','category')],'invisible':[('holiday_type','!=','category')]}"/>
            </xpath>
            <xpathexpr="//field[@name='department_id']"position="replace">
                <fieldname="department_id"groups="hr_holidays.group_hr_holidays_user"
                    attrs="{'required':[('holiday_type','=','department')],'invisible':[('holiday_type','!=','department')]}"/>
            </xpath>
            <xpathexpr="//field[@name='department_id']"position="after">
                <fieldname="mode_company_id"string="Company"groups="hr_holidays.group_hr_holidays_user"
                    attrs="{'required':[('holiday_type','=','company')],'invisible':[('holiday_type','!=','company')]}"/>
            </xpath>
            <xpathexpr="//field[@name='allocation_type']"position="attributes">
                <attributename="invisible">0</attribute>
            </xpath>
            <xpathexpr="//field[@name='allocation_type']"position="after">
                <labelfor="date_from"attrs="{'invisible':[('allocation_type','=','regular')]}"/>
                <divclass="o_row"attrs="{'invisible':[('allocation_type','=','regular')]}">
                    <fieldname="date_from"class="mr-2"attrs="{'required':[('allocation_type','=','accrual')]}"/>
                    Rununtil<fieldname="date_to"help="Ifnovalueset,runsindefinitely"class="ml-2"/>
                </div>
                <labelfor="date_from"invisible="1"/>
                <divattrs="{'invisible':[('allocation_type','=','regular')]}">
                    <divclass="o_row">
                        <span>Add</span>
                        <fieldname="number_per_interval"class="ml8"
                            attrs="{'required':[('allocation_type','=','accrual')]}"/>
                        <fieldname="unit_per_interval"
                            attrs="{'required':[('allocation_type','=','accrual')]}"/>
                        <spanclass="ml8">oftimeoffevery</span>
                        <fieldname="interval_number"class="ml8"
                            attrs="{'required':[('allocation_type','=','accrual')]}"/>
                        <fieldname="interval_unit"
                            attrs="{'required':[('allocation_type','=','accrual')]}"/>
                    </div>
                </div>
            </xpath>
        </field>
    </record>

    <recordid="hr_leave_allocation_view_tree"model="ir.ui.view">
        <fieldname="name">hr.leave.allocation.view.tree</field>
        <fieldname="model">hr.leave.allocation</field>
        <fieldname="priority">16</field>
        <fieldname="arch"type="xml">
            <treestring="AllocationRequests"sample="1">
                <fieldname="employee_id"/>
                <fieldname="department_id"optional="hide"/>
                <fieldname="holiday_status_id"class="font-weight-bold"/>
                <fieldname="name"/>
                <fieldname="duration_display"string="Duration"/>
                <fieldname="message_needaction"invisible="1"/>
                <fieldname="state"widget="badge"decoration-info="state=='draft'"decoration-warning="statein('confirm','validate1')"decoration-success="state=='validate'"/>
                <buttonstring="Approve"name="action_approve"type="object"
                    icon="fa-thumbs-up"
                    states="confirm"
                    groups="hr_holidays.group_hr_holidays_responsible"/>
                <buttonstring="Validate"name="action_validate"type="object"
                    icon="fa-check"
                    states="validate1"
                    groups="hr_holidays.group_hr_holidays_manager"/>
                <buttonstring="Refuse"name="action_refuse"type="object"
                    icon="fa-times"
                    states="confirm,validate1"
                    groups="hr_holidays.group_hr_holidays_manager"/>
                <fieldname="activity_exception_decoration"widget="activity_exception"/>
            </tree>
        </field>
    </record>

    <recordid="hr_leave_allocation_view_tree_my"model="ir.ui.view">
        <fieldname="name">hr.leave.allocation.view.tree.my</field>
        <fieldname="model">hr.leave.allocation</field>
        <fieldname="inherit_id"ref="hr_leave_allocation_view_tree"/>
        <fieldname="mode">primary</field>
        <fieldname="priority">32</field>
        <fieldname="arch"type="xml">
            <xpathexpr="//field[@name='employee_id']"position="attributes">
                <attributename="invisible">1</attribute>
            </xpath>
            <xpathexpr="//field[@name='department_id']"position="attributes">
                <attributename="invisible">1</attribute>
            </xpath>
            <xpathexpr="//button[@name='action_approve']"position="attributes">
                <attributename="invisible">1</attribute>
            </xpath>
            <xpathexpr="//button[@name='action_validate']"position="attributes">
                <attributename="invisible">1</attribute>
            </xpath>
            <xpathexpr="//button[@name='action_refuse']"position="attributes">
                <attributename="invisible">1</attribute>
            </xpath>
        </field>
    </record>

    <recordid="hr_leave_allocation_view_search_my"model="ir.ui.view">
        <fieldname="name">hr.leave.allocation.view.search.my</field>
        <fieldname="model">hr.leave.allocation</field>
        <fieldname="inherit_id"ref="view_hr_leave_allocation_filter"/>
        <fieldname="mode">primary</field>
        <fieldname="priority">32</field>
        <fieldname="arch"type="xml">
            <xpathexpr="//searchpanel"position="replace"/>
            <xpathexpr="//filter[@name='message_needaction']"position="attributes">
                <attributename="invisible">1</attribute>
            </xpath>
            <xpathexpr="//filter[@name='managed_people']"position="attributes">
                <attributename="invisible">1</attribute>
            </xpath>
            <xpathexpr="//filter[@name='my_team_leaves']"position="attributes">
                <attributename="invisible">1</attribute>
            </xpath>
            <xpathexpr="//filter[@name='my_leaves']"position="attributes">
                <attributename="invisible">1</attribute>
            </xpath>
        </field>
    </record>

    <recordid="hr_leave_allocation_view_search_manager"model="ir.ui.view">
        <fieldname="name">hr.leave.allocation.view.search.my</field>
        <fieldname="model">hr.leave.allocation</field>
        <fieldname="inherit_id"ref="view_hr_leave_allocation_filter"/>
        <fieldname="mode">primary</field>
        <fieldname="priority">32</field>
        <fieldname="arch"type="xml">
            <xpathexpr="//filter[@name='message_needaction']"position="attributes">
                <attributename="invisible">1</attribute>
            </xpath>
            <xpathexpr="//filter[@name='my_leaves']"position="attributes">
                <attributename="invisible">1</attribute>
            </xpath>
        </field>
    </record>

    <recordid="hr_leave_allocation_view_kanban"model="ir.ui.view">
        <fieldname="name">hr.leave.allocation.view.kanban</field>
        <fieldname="model">hr.leave.allocation</field>
        <fieldname="arch"type="xml">
            <kanbanclass="o_kanban_mobile"create="0"sample="1">
                <fieldname="employee_id"/>
                <fieldname="date_from"/>
                <fieldname="date_to"/>
                <fieldname="name"/>
                <fieldname="number_of_days"/>
                <fieldname="can_approve"/>
                <fieldname="state"/>
                <fieldname="holiday_status_id"/>
                <templates>
                    <tt-name="kanban-box">
                        <divclass="oe_kanban_global_clickcontainer">
                            <divclass="rowno-gutters">
                                <divclass="col-2">
                                    <imgt-att-src="kanban_image('hr.employee','image_128',record.employee_id.raw_value)"
                                        t-att-title="record.employee_id.value"
                                        t-att-alt="record.employee_id.value"
                                        class="oe_kanban_avataro_image_40_coverfloat-leftmr4"/>
                                </div>
                                <divclass="col-10">
                                    <spanclass="badgebadge-pillfloat-rightmt4mr16"><tt-esc="record.number_of_days.value"/>days</span>
                                    <strongclass="o_kanban_record_title"><tt-esc="record.employee_id.value"/></strong>
                                    <divclass="text-mutedo_kanban_record_subtitle">
                                        <tt-esc="record.holiday_status_id.value"/>
                                    </div>
                                    <divclass="o_dropdown_kanbandropdown"groups="base.group_user">
                                        <arole="button"class="dropdown-toggleo-no-caretbtn"data-toggle="dropdown"href="#"aria-label="Dropdownmenu"title="Dropdownmenu">
                                            <spanclass="fafa-ellipsis-v"/>
                                        </a>
                                        <divclass="dropdown-menu"role="menu">
                                            <at-if="widget.editable"role="menuitem"type="edit"class="dropdown-item">EditAllocation</a>
                                            <at-if="widget.deletable"role="menuitem"type="delete"class="dropdown-item">Delete</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <divclass="rowno-gutters"t-if="['validate','refuse'].includes(record.state.raw_value)">
                                <divclass="col-2"/>
                                <divclass="col-10">
                                    <spant-if="record.state.raw_value==='validate'"class="fafa-checktext-muted"aria-label="validated"/>
                                    <spant-else=""class="fafa-bantext-muted"aria-label="refused"/>
                                    <spanclass="text-muted"><tt-esc="record.state.value"/></span>
                                </div>
                            </div>
                            <divclass="o_kanban_record_bottom"t-if="record.can_approve.raw_value">
                                <divclass="oe_kanban_bottom_left"t-if="record.can_approve.raw_value">
                                    <buttont-if="record.state.raw_value==='confirm'"name="action_approve"type="object"class="btnbtn-primarybtn-smmt8">Approve</button>
                                    <buttont-if="record.state.raw_value==='validate1'"name="action_validate"type="object"class="btnbtn-primarybtn-smmt8">Validate</button>
                                    <buttont-if="['confirm','validate1'].includes(record.state.raw_value)"name="action_refuse"type="object"class="btnbtn-secondarybtn-smmt8">Refuse</button>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
     </record>

    <recordid="hr_leave_allocation_view_activity"model="ir.ui.view">
        <fieldname="name">hr.leave.allocation.view.activity</field>
        <fieldname="model">hr.leave.allocation</field>
        <fieldname="arch"type="xml">
            <activitystring="AllocationRequests">
                <fieldname="employee_id"/>
                <templates>
                    <divt-name="activity-box">
                        <imgt-att-src="activity_image('hr.employee','image_128',record.employee_id.raw_value)"t-att-title="record.employee_id.value"t-att-alt="record.employee_id.value"/>
                        <div>
                            <fieldname="employee_id"/>
                            <spanclass="ml-3text-muted">
                                <fieldname="number_of_days"/>days
                            </span>
                            <fieldname="holiday_status_id"muted="1"display="full"/>
                        </div>
                    </div>
                </templates>
            </activity>
        </field>
    </record>

    <recordid="hr_leave_allocation_action_my"model="ir.actions.act_window">
        <fieldname="name">MyAllocations</field>
        <fieldname="res_model">hr.leave.allocation</field>
        <fieldname="view_mode">tree,kanban,form,activity</field>
        <fieldname="search_view_id"ref="hr_holidays.hr_leave_allocation_view_search_my"/>
        <fieldname="help"type="html">
            <pclass="o_view_nocontent_smiling_face">
                Createanewtimeoffallocationrequest
            </p><p>
                TimeOffOfficersallocatetimeoffdaystoemployees(e.g.paidtimeoff).<br/>
                EmployeesrequestallocationstoTimeOffOfficers(e.g.recuperationdays).
            </p>
        </field>
        <fieldname="context">{}</field>
        <fieldname="domain">[('employee_id.user_id','=',uid)]</field>
    </record>
    <recordid="hr_leave_allocation_action_my_view_tree"model="ir.actions.act_window.view">
        <fieldname="sequence">1</field>
        <fieldname="view_mode">tree</field>
        <fieldname="act_window_id"ref="hr_leave_allocation_action_my"/>
        <fieldname="view_id"ref="hr_leave_allocation_view_tree_my"/>
    </record>
    <recordid="hr_leave_allocation_action_my_view_form"model="ir.actions.act_window.view">
        <fieldname="sequence">2</field>
        <fieldname="view_mode">form</field>
        <fieldname="act_window_id"ref="hr_leave_allocation_action_my"/>
        <fieldname="view_id"ref="hr_leave_allocation_view_form"/>
    </record>

    <recordid="hr_leave_allocation_action_all"model="ir.actions.act_window">
        <fieldname="name">AllAllocations</field>
        <fieldname="res_model">hr.leave.allocation</field>
        <fieldname="view_mode">tree,kanban,form,activity</field>
        <fieldname="context">{}</field>
        <fieldname="domain">[]</field>
        <fieldname="search_view_id"ref="hr_holidays.hr_leave_allocation_view_search_manager"/>
        <fieldname="help"type="html">
            <pclass="o_view_nocontent_smiling_face">
                Createanewtimeoffallocationrequest
            </p><p>
                TimeOffOfficersallocatetimeoffdaystoemployees(e.g.paidtimeoff).<br/>
                EmployeesrequestallocationstoTimeOffOfficers(e.g.recuperationdays).
            </p>
        </field>
    </record>

    <recordid="hr_leave_allocation_action_approve_department"model="ir.actions.act_window">
        <fieldname="name">Allocations</field>
        <fieldname="res_model">hr.leave.allocation</field>
        <fieldname="view_mode">tree,form,kanban,activity</field>
        <fieldname="context">{'search_default_managed_people':1}</field>
        <fieldname="domain">[]</field>
        <fieldname="search_view_id"ref="hr_holidays.hr_leave_allocation_view_search_manager"/>
        <fieldname="help"type="html">
            <pclass="o_view_nocontent_smiling_face">
                Createanewtimeoffallocation
            </p><p>
                TimeOffOfficersallocatetimeoffdaystoemployees(e.g.paidtimeoff).<br/>
                EmployeesrequestallocationstoTimeOffOfficers(e.g.recuperationdays).
            </p>
        </field>
    </record>

    <recordid="ir_actions_server_approve_allocations"model="ir.actions.server">
        <fieldname="name">ApproveAllocations</field>
        <fieldname="model_id"ref="hr_holidays.model_hr_leave_allocation"/>
        <fieldname="binding_model_id"ref="hr_holidays.model_hr_leave_allocation"/>
        <fieldname="binding_view_types">list</field>
        <fieldname="state">code</field>
        <fieldname="code">action=records.action_approve()</field>
    </record>

    <recordid="hr_leave_allocation_view_form_dashboard"model="ir.ui.view">
        <fieldname="name">hr.leave.view.form.dashboard</field>
        <fieldname="model">hr.leave.allocation</field>
        <fieldname="inherit_id"ref="hr_holidays.hr_leave_allocation_view_form"/>
        <fieldname="mode">primary</field>
        <fieldname="priority">100</field>
        <fieldname="arch"type="xml">
            <xpathexpr="//header"position="attributes">
                <attributename="invisible">1</attribute>
            </xpath>
            <divname="button_box"position="attributes">
                <attributename="invisible">1</attribute>
            </div>
        </field>
    </record>

</flectra>
