<?xmlversion="1.0"encoding="UTF-8"?>
<flectra>
    <templateid="report_delivery_document">
        <tt-call="web.html_container">
            <tt-call="web.external_layout">
                <tt-set="o"t-value="o.with_context(lang=o._get_report_lang())"/>
                <tt-set="partner"t-value="o.partner_idor(o.move_linesando.move_lines[0].partner_id)orFalse"/>
                <tt-if="partner"name="partner_header">
                    <tt-set="address">
                        <divt-esc="partner"
                        t-options='{"widget":"contact","fields":["address","name","phone"],"no_marker":True}'/>
                   </t>
                </t>

                <divclass="page">
                    <h2>
                        <spant-field="o.name"/>
                    </h2>
                    <divclass="rowmt32mb32">
                        <divt-if="o.origin"class="col-auto"name="div_origin">
                            <strong>Order:</strong>
                            <pt-field="o.origin"/>
                        </div>
                        <divt-if="o.state"class="col-auto"name="div_sched_date">
                            <strong>ShippingDate:</strong>
                            <tt-if="o.state=='done'">
                                <pt-field="o.date_done"/>
                            </t>
                            <tt-if="o.state!='done'">
                                <pt-field="o.scheduled_date"/>
                           </t>
                        </div>
                    </div>
                    <tableclass="tabletable-sm"t-if="o.state!='done'"name="stock_move_table">
                        <thead>
                            <tr>
                                <thname="th_sm_product"><strong>Product</strong></th>
                                <thname="th_sm_quantity"><strong>Quantity</strong></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tt-set="lines"t-value="o.move_lines.filtered(lambdax:x.product_uom_qty)"/>
                            <trt-foreach="lines"t-as="move">
                                <td>
                                    <spant-field="move.product_id"/>
                                    <pt-if="move.description_picking!=move.product_id.name">
                                        <spant-field="move.description_picking"/>
                                    </p>
                                </td>
                                <td>
                                    <spant-field="move.product_uom_qty"/>
                                    <spant-field="move.product_uom"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <tableclass="tabletable-smmt48"t-if="o.move_line_idsando.state=='done'"name="stock_move_line_table">
                        <tt-set="has_serial_number"t-value="False"/>
                        <tt-set="has_serial_number"t-value="o.move_line_ids.mapped('lot_id')"groups="stock.group_lot_on_delivery_slip"/>
                        <thead>
                            <tr>
                                <thname="th_sml_product"><strong>Product</strong></th>
                                <tname="lot_serial"t-if="has_serial_number">
                                    <th>
                                        Lot/SerialNumber
                                    </th>
                                </t>
                                <thname="th_sml_quantity"class="text-center"><strong>Quantity</strong></th>
                            </tr>
                        </thead>
                        <tbody>
                        <!--Thispartgetscomplicatedwithdifferentusecases(additionalusecasesinextensionsofthisreport):
                                1.Ifserialnumbersareusedandsettoprintondeliveryslip=>printlinesasis,otherwisegroupthembyoverlapping
                                    product+description+uomcombinations
                                2.Ifanypackagesareassigned=>splitproductsupbypackage(ornon-package)andthenapplyusecase1-->
                            <!--Ifhasdestinationpackages=>createsectionsofcorrespondingproducts-->
                            <tt-if="o.has_packages"name="has_packages">
                                <tt-set="packages"t-value="o.move_line_ids.mapped('result_package_id')"/>
                                <tt-foreach="packages"t-as="package">
                                    <tt-call="stock.stock_report_delivery_package_section_line"/>
                                    <tt-set="package_move_lines"t-value="o.move_line_ids.filtered(lambdal:l.result_package_id==package)"/>
                                    <!--Ifprintinglots/serialnumbers=>keepproductsinoriginallines-->
                                    <tt-if="has_serial_number">
                                        <trt-foreach="package_move_lines"t-as="move_line">
                                            <tt-call="stock.stock_report_delivery_has_serial_move_line"/>
                                        </tr>
                                    </t>
                                    <!--Ifnotprintinglots/serialnumbers=>mergelineswithsameproduct+description+uom-->
                                    <tt-else="">
                                        <tt-set="aggregated_lines"t-value="package_move_lines._get_aggregated_product_quantities()"/>
                                        <tt-call="stock.stock_report_delivery_aggregated_move_lines"/>
                                    </t>
                                </t>
                                <!--Makesurewedoanothersectionforpackage-lessproductsiftheyexist-->
                                <tt-set="move_lines"t-value="o.move_line_ids.filtered(lambdal:notl.result_package_id)"/>
                                <tt-if="move_lines"name="no_package_move_lines">
                                    <tt-call="stock.stock_report_delivery_no_package_section_line"name="no_package_section"/>
                                    <tt-if="has_serial_number">
                                        <trt-foreach="move_lines"t-as="move_line">
                                            <tt-call="stock.stock_report_delivery_has_serial_move_line"/>
                                        </tr>
                                    </t>
                                    <tt-else="">
                                        <tt-set="aggregated_lines"t-value="move_lines._get_aggregated_product_quantities()"/>
                                        <tt-if="aggregated_lines">
                                            <tt-call="stock.stock_report_delivery_aggregated_move_lines"/>
                                        </t>
                                    </t>
                                </t>
                            </t>
                            <!--Nodestinationpackages-->
                            <tt-else="">
                                <!--Ifprintinglots/serialnumbers=>keepproductsinoriginallines-->
                                <tt-if="has_serial_number">
                                    <trt-foreach="o.move_line_ids"t-as="move_line">
                                        <tt-call="stock.stock_report_delivery_has_serial_move_line"/>
                                    </tr>
                                </t>
                                <!--Ifnotprintinglots/serialnumbers=>mergelineswithsameproduct-->
                                <tt-else=""name="aggregated_move_lines">
                                    <tt-set="aggregated_lines"t-value="o.move_line_ids._get_aggregated_product_quantities()"/>
                                        <tt-call="stock.stock_report_delivery_aggregated_move_lines"/>
                                </t>
                            </t>
                        </tbody>
                    </table>
                    <tt-set="backorders"t-value="o.backorder_ids.filtered(lambdax:x.statenotin('done','cancel'))"/>
                    <tt-if="o.backorder_idsandbackorders">
                        <p>
                            <span>Allitemscouldn'tbeshipped,thefollowingitemswillbeshippedassoonastheybecomeavailable.</span>
                        </p>
                        <tableclass="tabletable-sm"name="stock_backorder_table">
                            <thead>
                                <tr>
                                    <thname="th_sb_product"><strong>Product</strong></th>
                                    <thname="th_sb_quantity"class="text-center"><strong>Quantity</strong></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tt-foreach="backorders"t-as="backorder">
                                    <tt-set="bo_lines"t-value="backorder.move_lines.filtered(lambdax:x.product_uom_qty)"/>
                                    <trt-foreach="bo_lines"t-as="bo_line">
                                        <td>
                                            <spant-field="bo_line.product_id"/>
                                            <pt-if="bo_line.description_picking!=bo_line.product_id.name">
                                                <spant-field="bo_line.description_picking"/>
                                            </p>
                                        </td>
                                        <tdclass="text-center">
                                            <spant-field="bo_line.product_uom_qty"/>
                                            <spant-field="bo_line.product_uom"/>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </t>

                    <divt-if="o.signature"class="mt32ml64mr4"name="signature">
                        <divclass="offset-8">
                            <strong>Signature</strong>
                        </div>
                        <divclass="offset-8">
                            <imgt-att-src="image_data_uri(o.signature)"style="max-height:4cm;max-width:8cm;"/>
                        </div>
                        <divclass="offset-8text-center">
                            <pt-field="o.partner_id.name"/>
                        </div>
                    </div>
                </div>
            </t>
         </t>
    </template>

    <!--templatesforeasierextension+cutbackonrepeatcodeduetomultipleconditionals-->
    <!--moveline(s)printingfortables-->
    <templateid="stock_report_delivery_has_serial_move_line">
        <td>
            <spant-field="move_line.product_id"/>
            <!--thisisanannoyingworkaroundforthemultipletypesofdescriptions(oftenauto-filled)thatwedonotwanttoprint-->
            <!--thismakesitsowecanpre-filterthedescriptionsininheritedtemplatessincewecannotextendthestandard"if"condition-->
            <!--let'sagreethatpre-filtereddescriptionswillbesetto""-->
            <tt-if="notdescriptionanddescription!=''">
                <tt-set="description"t-value="move_line.move_id.description_picking"/>
            </t>
            <pt-if="description!=''anddescription!=move_line.product_id.name">
                <spant-esc="description"/>
            </p>
        </td>
        <tt-if="has_serial_number"name="move_line_lot">
            <td><spant-field="move_line.lot_id.name"/></td>
        </t>
        <tdclass="text-center"name="move_line_lot_qty_done">
            <spant-field="move_line.qty_done"/>
            <spant-field="move_line.product_uom_id"/>
        </td>
    </template>
    <templateid="stock_report_delivery_aggregated_move_lines">
        <trt-foreach="aggregated_lines"t-as="line">
            <td>
                <spant-esc="aggregated_lines[line]['name']"/>
                <pt-if="aggregated_lines[line]['description']">
                    <spant-esc="aggregated_lines[line]['description']"/>
                </p>
            </td>
            <tdclass="text-center"name="move_line_aggregated_qty_done">
                <spant-esc="aggregated_lines[line]['qty_done']"
                    t-options="{'widget':'float','decimal_precision':'ProductUnitofMeasure'}"/>
                <spant-esc="aggregated_lines[line]['product_uom']"/>
            </td>
        </tr>
    </template>

    <!--packagerelated"sectionlines"-->
    <templateid="stock_report_delivery_package_section_line">
        <trt-att-class="'bg-200font-weight-boldo_line_section'">
            <tdcolspan="99"name="package_info">
                <spant-field="package.name"/>
            </td>
        </tr>
    </template>
    <templateid="stock_report_delivery_no_package_section_line">
        <trt-att-class="'bg-200font-weight-boldo_line_section'">
            <tdcolspan="99"name="no_package_info">
                <span>Productswithnopackageassigned</span>
            </td>
        </tr>
    </template>

    <templateid="report_deliveryslip">
        <tt-foreach="docs"t-as="o">
            <tt-call="stock.report_delivery_document"t-lang="o._get_report_lang()"/>
        </t>
    </template>
</flectra>
