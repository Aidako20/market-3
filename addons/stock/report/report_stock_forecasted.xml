<?xmlversion="1.0"encoding="utf-8"?>
<flectra>
<!--Reports-->
    <recordid="stock_replenishment_report_product_product_action"model="ir.actions.report">
        <fieldname="name">ForecastedReport</field>
        <fieldname="model">product.product</field>
        <fieldname="report_type">qweb-html</field>
        <fieldname="report_name">stock.report_product_product_replenishment</field>
    </record>

    <recordid="stock_replenishment_report_product_template_action"model="ir.actions.report">
        <fieldname="name">ForecastedReport</field>
        <fieldname="model">product.template</field>
        <fieldname="report_type">qweb-html</field>
        <fieldname="report_name">stock.report_product_template_replenishment</field>
    </record>

    <recordid="stock_replenishment_product_product_action"model="ir.actions.client">
        <fieldname="name">ForecastedReport</field>
        <fieldname="tag">replenish_report</field>
    </record>

<!--Templates-->
    <templateid="assets_common_replenishment_report"name="ForecastedInventoryCSS"inherit_id="web.report_assets_common">
        <xpathexpr="."position="inside">
            <linkrel="stylesheet"type="text/scss"href="/web/static/src/scss/graph_view.scss"/>
            <linkrel="stylesheet"type="text/scss"href="/stock/static/src/scss/report_stock_forecasted.scss"/>
        </xpath>
    </template>

    <templateid="report_replenishment_header">
        <divclass="d-flexjustify-content-between">
            <divclass="o_product_name">
                <h3>
                    <tt-if="docs['product_templates']">
                        <tt-foreach="docs['product_templates']"t-as="product_template">
                            <ahref="#"res-model="product.template"view-type="form"t-att-res-id="product_template.id">
                                <tt-esc="product_template.display_name"/>
                            </a>
                        </t>
                    </t>
                    <tt-elif="docs['product_variants']">
                        <tt-foreach="docs['product_variants']"t-as="product_variant">
                            <ahref="#"res-model="product.product"view-type="form"t-att-res-id="product_variant.id">
                                <tt-esc="product_variant.display_name"/>
                            </a>
                        </t>
                    </t>
                </h3>
                <h6t-if="docs['product_templates']anddocs['product_variants']andlen(docs['product_templates'])!=len(docs['product_variants'])">
                    <tt-foreach="docs['product_variants']"t-as="product_variant">
                        <ahref="#"res-model="product.product"view-type="form"t-att-res-id="product_variant.id">
                            <tt-esc="'[%s]'%product_variant.product_template_attribute_value_ids._get_combination_name()"/>
                        </a>
                    </t>
                </h6>
            </div>
            <divclass="row">
                <divclass="mx-3text-center">
                    <divclass="h3">
                        <tt-esc="docs['quantity_on_hand']"t-options='{"widget":"float","decimal_precision":"ProductUnitofMeasure"}'/>
                        <tt-esc="docs['uom']"groups="uom.group_uom"/>
                    </div>
                    <div>OnHand</div>
                </div>
                <divt-attf-class="mx-3text-center#{docs['virtual_available']&lt;0and'text-danger'}">
                    <divclass="h3">
                        <tt-esc="docs['virtual_available']"t-options='{"widget":"float","decimal_precision":"ProductUnitofMeasure"}'/>
                        <tt-esc="docs['uom']"groups="uom.group_uom"/>
                    </div>
                    <div>Forecasted</div>
                </div>
                <divname="pending_forecasted"t-attf-class="mx-3text-center#{future_virtual_available&lt;0and'text-danger'}">
                    <divclass="h3">
                        <tt-esc="future_virtual_available"t-options='{"widget":"float","decimal_precision":"ProductUnitofMeasure"}'/>
                        <tt-esc="docs['uom']"groups="uom.group_uom"/>
                    </div>
                    <div>Forecasted<br/>+Pending</div>
                </div>
            </div>
        </div>
    </template>

    <templateid="report_product_product_replenishment">
        <tt-call="web.html_container">
            <divclass="pagept-3o_report_replenishment_page">
                <tt-set="future_virtual_available"t-value="docs['virtual_available']+docs['qty']['in']-docs['qty']['out']"/>
                <tt-call="stock.report_replenishment_header"/>
                <divclass="o_report_graph"/>
                <tableclass="o_report_replenishmenttabletable-bordered">
                    <thead>
                        <trclass="bg-light">
                            <td>Replenishment</td>
                            <td>ExpectedReceipt</td>
                            <tdt-if="docs['multiple_product']">Product</td>
                            <tdclass="text-right">Quantity</td>
                            <tdgroups="uom.group_uom">UoM</td>
                            <td>Usedby</td>
                            <td>ExpectedDelivery</td>
                        </tr>
                    </thead>
                    <tbody>
                        <trt-if="docs['lines']andnotany(line['document_in']orline['replenishment_filled']forlineindocs['lines'])">
                            <td>InventoryOnHand</td>
                            <td/>
                            <tdt-if="docs['multiple_product']"/>
                            <tdclass="text-right">0</td>
                            <td/>
                            <td/>
                            <td/>
                            <td/>
                        </tr>
                        <trt-foreach="docs['lines']"t-as="line">
                            <tdt-attf-class="#{line['is_late']and'o_grid_warning'}">
                                <at-if="line['document_in']"
                                    t-attf-href="#"t-esc="line['document_in'].name"
                                    class="font-weight-bold"view-type="form"
                                    t-att-res-model="line['document_in']._name"
                                    t-att-res-id="line['document_in'].id"/>
                                <tt-elif="line['reservation']">
                                    Reservedfromstock
                                </t>
                                <tt-elif="line['replenishment_filled']">
                                    <tt-if="line['document_out']">InventoryOnHand</t>
                                    <tt-else="">FreeStock</t>
                                </t>
                                <spant-else=""class="text-muted">NotAvailable</span>
                            </td>
                            <tdt-esc="line['receipt_date']or''"
                                t-attf-class="#{line['is_late']and'o_grid_warning'}"/>
                            <tdt-if="docs['multiple_product']"t-esc="line['product']['display_name']"/>
                            <tdclass="text-right"><tt-if="notline['replenishment_filled']">-</t><tt-esc="line['quantity']"t-options='{"widget":"float","decimal_precision":"ProductUnitofMeasure"}'/></td>
                            <tdt-esc="line['uom_id'].name"groups="uom.group_uom"/>
                            <tdt-attf-class="#{notline['replenishment_filled']and'o_grid_warning'}">
                                <at-if="line['document_out']"
                                    t-attf-href="#"t-esc="line['document_out'].name"
                                    class="font-weight-bold"view-type="form"
                                    t-att-res-model="line['document_out']._name"
                                    t-att-res-id="line['document_out'].id"/>
                            </td>
                            <tdt-esc="line['delivery_date']or''"
                                t-attf-class="#{notline['replenishment_filled']and'o_grid_warning'}"/>
                        </tr>
                    </tbody>
                    <thead>
                        <trclass="o_forecasted_row">
                            <tdcolspan="2">ForecastedInventory</td>
                            <tdt-esc="docs['virtual_available']"class="text-right"t-options='{"widget":"float","decimal_precision":"ProductUnitofMeasure"}'/>
                            <tdt-esc="docs['uom']"groups="uom.group_uom"/>
                        </tr>
                    </thead>
                    <tbodyt-if="docs['qty']['in']ordocs['qty']['out']">
                        <trt-if="docs['draft_picking_qty']['in']"name="draft_picking_in">
                            <tdcolspan="2">IncomingDraftTransfer</td>
                            <tdt-esc="docs['draft_picking_qty']['in']"class="text-right"t-options='{"widget":"float","decimal_precision":"ProductUnitofMeasure"}'/>
                            <tdt-esc="docs['uom']"groups="uom.group_uom"/>
                        </tr>
                        <trt-if="docs['draft_picking_qty']['out']"name="draft_picking_out">
                            <tdcolspan="2">OutgoingDraftTransfer</td>
                            <tdt-esc="-docs['draft_picking_qty']['out']"class="text-right"t-options='{"widget":"float","decimal_precision":"ProductUnitofMeasure"}'/>
                            <tdt-esc="docs['uom']"groups="uom.group_uom"/>
                        </tr>
                    </tbody>
                    <thead>
                        <trclass="o_forecasted_row">
                            <tdcolspan="2">ForecastedwithPending</td>
                            <tdt-esc="future_virtual_available"class="text-right"t-options='{"widget":"float","decimal_precision":"ProductUnitofMeasure"}'/>
                            <tdt-esc="docs['uom']"groups="uom.group_uom"/>
                        </tr>
                    </thead>
                </table>
            </div>
        </t>
    </template>

    <templateid="report_product_template_replenishment">
        <tt-call="stock.report_product_product_replenishment"/>
    </template>
</flectra>
