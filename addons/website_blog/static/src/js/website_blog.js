flectra.define('website_blog.website_blog',function(require){
'usestrict';
varcore=require('web.core');

constdom=require('web.dom');
constpublicWidget=require('web.public.widget');

publicWidget.registry.websiteBlog=publicWidget.Widget.extend({
    selector:'.website_blog',
    events:{
        'click#o_wblog_next_container':'_onNextBlogClick',
        'click#o_wblog_post_content_jump':'_onContentAnchorClick',
        'click.o_twitter,.o_facebook,.o_linkedin,.o_google,.o_twitter_complete,.o_facebook_complete,.o_linkedin_complete,.o_google_complete':'_onShareArticle',
    },

    /**
     *@override
     */
    start:function(){
        $('.js_tweet,.js_comment').share({});
        returnthis._super.apply(this,arguments);
    },

    //--------------------------------------------------------------------------
    //Handlers
    //--------------------------------------------------------------------------

    /**
     *@private
     *@param{Event}ev
     */
    _onNextBlogClick:function(ev){
        ev.preventDefault();
        varself=this;
        var$el=$(ev.currentTarget);
        varnexInfo=$el.find('#o_wblog_next_post_info').data();
        $el.find('.o_record_cover_container').addClass(nexInfo.size+''+nexInfo.text).end()
           .find('.o_wblog_toggle').toggleClass('d-none');
        //Appendingaplaceholdersothatthecovercanscrolltothetopofthe
        //screen,regardlessofitsheight.
        constplaceholder=document.createElement('div');
        placeholder.style.minHeight='100vh';
        this.$('#o_wblog_next_container').append(placeholder);

        //Use_.defertocalculatethe'offset()''onlyafterthatsizeclasses
        //havebeenapplyedandthat$elhasbeenresized.
        _.defer(function(){
            self._forumScrollAction($el,300,function(){
                window.location.href=nexInfo.url;
            });
        });
    },
    /**
     *@private
     *@param{Event}ev
     */
    _onContentAnchorClick:function(ev){
        ev.preventDefault();
        ev.stopImmediatePropagation();
        var$el=$(ev.currentTarget.hash);

        this._forumScrollAction($el,500,function(){
            window.location.hash='blog_content';
        });
    },
    /**
     *@private
     *@param{Event}ev
     */
    _onShareArticle:function(ev){
        ev.preventDefault();
        varurl='';
        var$element=$(ev.currentTarget);
        varblogPostTitle=$('#o_wblog_post_name').html()||'';
        vararticleURL=window.location.href;
        if($element.hasClass('o_twitter')){
            vartwitterText=core._t("Amazingblogarticle:%s!Checkitlive:%s");
            vartweetText=_.string.sprintf(twitterText,blogPostTitle,articleURL);
            url='https://twitter.com/intent/tweet?tw_p=tweetbutton&text='+encodeURIComponent(tweetText);
        }elseif($element.hasClass('o_facebook')){
            url='https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(articleURL);
        }elseif($element.hasClass('o_linkedin')){
            url='https://www.linkedin.com/sharing/share-offsite/?url='+encodeURIComponent(articleURL);
        }
        window.open(url,'','menubar=no,width=500,height=400');
    },

    //--------------------------------------------------------------------------
    //Utils
    //--------------------------------------------------------------------------

    /**
     *@private
     *@param{JQuery}$el-theelementwearescrollingto
     *@param{Integer}duration-scrollanimationduration
     *@param{Function}callback-tobeexecutedafterthescrollisperformed
     */
    _forumScrollAction:function($el,duration,callback){
        dom.scrollTo($el[0],{duration:duration}).then(()=>callback());
    },
});
});
