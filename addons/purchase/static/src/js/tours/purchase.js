flectra.define('purchase.purchase_steps',function(require){
"usestrict";

varcore=require('web.core');

varPurchaseAdditionalTourSteps=core.Class.extend({

    _get_purchase_stock_steps:function(){
        return[
            {
                auto:true,//Uselessfinalsteptotriggercongratulationmessage
                trigger:".o_purchase_order",
            },
        ];
    },

});

returnPurchaseAdditionalTourSteps;

});

flectra.define('purchase.tour',function(require){
"usestrict";

varcore=require('web.core');
vartour=require('web_tour.tour');

var_t=core._t;
varPurchaseAdditionalTourSteps=require('purchase.purchase_steps');

tour.register('purchase_tour',{
    url:"/web",
    sequence:40,
},[tour.stepUtils.showAppsMenuItem(),{
    trigger:'.o_app[data-menu-xmlid="purchase.menu_purchase_root"]',
    content:_t("Let'strythePurchaseapptomanagetheflowfrompurchasetoreceptionandinvoicecontrol."),
    position:'right',
    edition:'community'
},{
    trigger:'.o_app[data-menu-xmlid="purchase.menu_purchase_root"]',
    content:_t("Let'strythePurchaseapptomanagetheflowfrompurchasetoreceptionandinvoicecontrol."),
    position:'bottom',
    edition:'enterprise'
},{
    trigger:".o_list_button_add",
    extra_trigger:".o_purchase_order",
    content:_t("Let'screateyourfirstrequestforquotation."),
    position:"bottom",
},{
    trigger:".o_form_editable.o_field_many2one[name='partner_id']",
    extra_trigger:".o_purchase_order",
    content:_t("Searchavendorname,orcreateoneonthefly."),
    position:"bottom",
    run:function(actions){
        actions.text("Agrolait",this.$anchor.find("input"));
    },
},{
    trigger:".ui-menu-item>a",
    auto:true,
    in_modal:false,
},{
    trigger:".o_field_x2many_list_row_add>a",
    extra_trigger:".o_field_many2one[name='partner_id'].o_external_button",
    content:_t("Addsomeproductsorservicestoyourquotation."),
    position:"bottom",
},{
    trigger:".o_field_widget[name=product_id],.o_field_widget[name=product_template_id]",
    extra_trigger:".o_purchase_order",
    content:_t("Selectaproduct,orcreateanewoneonthefly."),
    position:"right",
    run:function(actions){
        var$input=this.$anchor.find('input');
        actions.text("DESK0001",$input.length===0?this.$anchor:$input);
        //fakekeydowntotriggersearch
        varkeyDownEvent=jQuery.Event("keydown");
        keyDownEvent.which=42;
        this.$anchor.trigger(keyDownEvent);
        var$descriptionElement=$('.o_form_editabletextarea[name="name"]');
        //whendescriptionchanges,weknowtheproducthasbeencreated
        $descriptionElement.change(function(){
            $descriptionElement.addClass('product_creation_success');
        });
    },
},{
    trigger:'.ui-menu.ui-widget.ui-menu-itema:contains("DESK0001")',
    auto:true,
},{
    trigger:'.o_form_editabletextarea[name="name"].product_creation_success',
    auto:true,
    run:function(){}//waitforproductcreation
},{
    trigger:".o_form_editableinput[name='product_qty']",
    extra_trigger:".o_purchase_order",
    content:_t("Indicatetheproductquantityyouwanttoorder."),
    position:"right",
    run:'text12.0'
},
...tour.stepUtils.statusbarButtonsSteps('SendbyEmail',_t("Sendtherequestforquotationtoyourvendor."),".o_statusbar_buttonsbutton[name='action_rfq_send']"),
{
    trigger:".modal-content",
    auto:true,
    run:function(actions){
        //Checkincaseusermustaddemailtovendor
        var$input=$(".modal-contentinput[name='email']");
        if($input.length){
            actions.text("agrolait@example.com",$input);
            actions.click($(".modal-footerbutton"));
        }
    }
},{
    trigger:".modal-footerbutton[name='action_send_mail']",
    extra_trigger:".modal-footerbutton[name='action_send_mail']",
    content:_t("Sendtherequestforquotationtoyourvendor."),
    position:"left",
    run:'click',
},{
    trigger:".ui-sortable-handle",
    extra_trigger:".o_purchase_order",
    content:_t("Clickheretoeditormovethequotationline."),
    position:"bottom",
    run:'click',
},{
    trigger:".o_form_editableinput[name='price_unit']",
    extra_trigger:".o_form_editableinput[name='price_unit']",
    content:_t("Onceyougetthepricefromthevendor,youcancompletethepurchaseorderwiththerightprice."),
    position:"right",
    run:'text200.00'
},{
    auto:true,
    trigger:".o_purchase_order",
    run:'click',
},...tour.stepUtils.statusbarButtonsSteps('ConfirmOrder',_t("Confirmyourpurchase.")),
...newPurchaseAdditionalTourSteps()._get_purchase_stock_steps(),
]);

});
