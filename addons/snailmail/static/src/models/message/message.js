flectra.define('snailmail/static/src/models/message.message.js',function(require){
'usestrict';

const{registerInstancePatchModel}=require('mail/static/src/model/model_core.js');

registerInstancePatchModel('mail.message','snailmail/static/src/models/message.message.js',{

    //----------------------------------------------------------------------
    //Public
    //----------------------------------------------------------------------

    /**
     *Cancelsthe'snailmail.letter'correspondingtothismessage.
     *
     *@returns{Deferred}
     */
    asynccancelLetter(){
        //theresultwillcomefromlongpolling:message_notification_update
        awaitthis.async(()=>this.env.services.rpc({
            model:'mail.message',
            method:'cancel_letter',
            args:[[this.id]],
        }));
    },
    /**
     *Openstheactionabout'snailmail.letter'formaterror.
     */
    openFormatLetterAction(){
        this.env.bus.trigger('do-action',{
            action:'snailmail.snailmail_letter_format_error_action',
            options:{
                additional_context:{
                    message_id:this.id,
                },
            },
        });
    },
    /**
     *Openstheactionabout'snailmail.letter'missingfields.
     */
    asyncopenMissingFieldsLetterAction(){
        constletterIds=awaitthis.async(()=>this.env.services.rpc({
            model:'snailmail.letter',
            method:'search',
            args:[[['message_id','=',this.id]]],
        }));
        this.env.bus.trigger('do-action',{
            action:'snailmail.snailmail_letter_missing_required_fields_action',
            options:{
                additional_context:{
                    default_letter_id:letterIds[0],
                },
            },
        });
    },
    /**
     *Retriestosendthe'snailmail.letter'correspondingtothismessage.
     */
    asyncresendLetter(){
        //theresultwillcomefromlongpolling:message_notification_update
        awaitthis.async(()=>this.env.services.rpc({
            model:'mail.message',
            method:'send_letter',
            args:[[this.id]],
        }));
    },
});

});
