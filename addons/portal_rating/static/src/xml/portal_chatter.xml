<?xmlversion="1.0"encoding="UTF-8"?>
<templatesid="template"xml:space="preserve">
    <!--
        Inheritedtemplatesfromportaltocustomchatterwithrating
    -->
    <tt-extend="portal.Composer">
        <tt-jquery="textarea"t-operation="inner"><tt-esc="widget.options['default_message']?_.str.trim(widget.options['default_message']):''"/></t><!--needtobeonelinetoavoid\tintextarea-->
        <tt-jquery="form"t-operation="attributes">
            <attributename="t-attf-action">#{widget.options['force_submit_url']?widget.options['force_submit_url']:'/mail/chatter_post'}</attribute>
        </t>
        <tt-jquery=".o_portal_chatter_composer_forminput[name='csrf_token']"t-operation="after">
            <tt-call="portal_rating.rating_star_input">
                <tt-set="default_rating"t-value="widget.options['default_rating_value']"/>
            </t>
            <inputtype="hidden"name="message_id"t-att-value="widget.options['default_message_id']"t-if="widget.options['default_message_id']"/>
        </t>
    </t>

    <tt-extend="portal.chatter_messages">
        <tt-jquery="t[t-raw='message.body']"t-operation="before">
            <tt-if="message['rating_value']">
                <tt-call="portal_rating.rating_stars_static">
                    <tt-set="val"t-value="message.rating_value"/>
                </t>
            </t>
        </t>
        <tt-jquery=".o_portal_chatter_attachments"t-operation="after">
            <!--Onlypossibleifaratingislinktothemessage,fornowwecan'tcommentifnorating
                islinktothemessage(becausepublishercommentdata
                isontherating.ratingmodel-onecommentmax)-->
            <tt-if="message.ratingandmessage.rating.id"t-call="portal_rating.chatter_rating_publisher">
                <tt-set="is_publisher"t-value="widget.options['is_user_publisher']"/>
                <tt-set="rating"t-value="message.rating"/>
            </t>
        </t>
    </t>

    <tt-extend="portal.Chatter">
        <tt-jquery="t[t-call='portal.chatter_message_count']"t-operation="replace">
            <tt-if="widget.options['display_rating']">
                <tt-call="portal_rating.rating_card"/>
            </t>
            <tt-if="!widget.options['display_rating']">
                <tt-call="portal.chatter_message_count"/>
            </t>
        </t>
    </t>

    <!--
        NewtemplatesspecificofratinginChatter
    -->
    <tt-name="portal_rating.chatter_rating_publisher">
        <divclass="o_wrating_publisher_container">
            <buttont-if="is_publisher"
                t-attf-class="btnpx-2mb-2btn-smbordero_wrating_js_publisher_comment_btn{{rating.publisher_comment!==''?'d-none':''}}"
                t-att-data-mes_index="rating.mes_index">
                <iclass="fafa-commenttext-mutedmr-1"/>Comment
            </button>
            <divclass="o_wrating_publisher_commentmt-2mb-2">
                <tt-if="rating.publisher_comment"t-call="portal_rating.chatter_rating_publisher_comment"/>
            </div>
        </div>
    </t>

    <tt-name="portal_rating.chatter_rating_publisher_comment">
        <divclass="mediao_portal_chatter_message">
            <imgclass="o_portal_chatter_avatar"t-att-src="rating.publisher_avatar"alt="avatar"/>
            <divclass="media-body">
                <divclass="o_portal_chatter_message_title">
                    <divclass="d-inline-block">
                        <h5class="mb-1"><tt-esc="rating.publisher_name"/></h5>
                    </div>
                    <divt-if="is_publisher"class="dropdownd-inline-block">
                        <buttonclass="btnpy-0"type="button"id="dropdownMenuButton"data-toggle="dropdown"aria-haspopup="true"aria-expanded="false">
                            <iclass="fafa-ellipsis-v"/>
                        </button>
                        <divclass="dropdown-menu"aria-labelledby="dropdownMenuButton">
                            <buttonclass="dropdown-itemo_wrating_js_publisher_comment_edit"t-att-data-mes_index="rating.mes_index">
                                <iclass="fafa-fwfa-pencilmr-1"/>Edit
                            </button>
                            <buttonclass="dropdown-itemo_wrating_js_publisher_comment_delete"t-att-data-mes_index="rating.mes_index">
                                <iclass="fafa-fwfa-trash-omr-1"/>Delete
                            </button>
                        </div>
                    </div>
                    <p>Publishedon<tt-esc="rating.publisher_datetime"/></p>
                </div>
                <tt-esc="rating.publisher_comment"/>
            </div>
        </div>
    </t>
    <tt-name="portal_rating.chatter_rating_publisher_form">
        <divt-if="is_publisher"class="mediao_portal_chatter_messageshadowbg-whiteroundedpx-3py-3my-1">
            <imgclass="o_portal_chatter_avatar"t-att-src="rating.publisher_avatar"alt="avatar"/>
            <divclass="media-body">
                <divclass="o_portal_chatter_message_title">
                    <h5class='mb-1'><tt-esc="rating.publisher_name"/></h5>
                    <p>Publishedon<tt-esc="rating.publisher_datetime"/></p>
                </div>
                <textarearows="3"class="form-controlo_portal_rating_comment_input"><tt-esc="rating.publisher_comment"/></textarea>
                <div>
                    <buttonclass="btnbtn-primarymt-2o_wrating_js_publisher_comment_submit"t-att-data-mes_index="rating.mes_index">
                        <tt-if="rating.publisher_comment===''">
                            Postcomment
                        </t><tt-else="">
                            Updatecomment
                        </t>
                    </button>
                    <buttonclass="borderbtnbtn-lightmt-2bg-whiteo_wrating_js_publisher_comment_cancel"t-att-data-mes_index="rating.mes_index">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </t>
</templates>
