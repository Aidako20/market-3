flectra.define('website.set_view_track',function(require){
"usestrict";

varCustomizeMenu=require('website.customizeMenu');
varWidget=require('web.Widget');

varTrackPage=Widget.extend({
    template:'website.track_page',
    xmlDependencies:['/website/static/src/xml/track_page.xml'],
    events:{
        'change#switch-track-page':'_onTrackChange',
    },

    /**
     *@override
     */
    start:function(){
        this.$input=this.$('#switch-track-page');
        this._isTracked().then((data)=>{
            if(data[0]['track']){
                this.track=true;
                this.$input.attr('checked','checked');
            }else{
                this.track=false;
            }
        });
    },

    //--------------------------------------------------------------------------
    //Private
    //--------------------------------------------------------------------------

    /**
     *@private
     */
    _isTracked:function(val){
        varviewid=$('html').data('viewid');
        if(!viewid){
            returnPromise.reject();
        }else{
            returnthis._rpc({
                model:'ir.ui.view',
                method:'read',
                args:[[viewid],['track']],
            });
        }
    },
    /**
     *@private
     */
    _onTrackChange:function(ev){
        varcheckboxValue=this.$input.is(':checked');
        if(checkboxValue!==this.track){
            this.track=checkboxValue;
            this._trackPage(checkboxValue);
        }
    },
    /**
     *@private
     */
    _trackPage:function(val){
        varviewid=$('html').data('viewid');
        if(!viewid){
            returnPromise.reject();
        }else{
            returnthis._rpc({
                model:'ir.ui.view',
                method:'write',
                args:[[viewid],{track:val}],
            });
        }
    },
});

CustomizeMenu.include({
    _loadCustomizeOptions:function(){
        varself=this;
        vardef=this._super.apply(this,arguments);
        returndef.then(function(){
            if(!self.__trackpageLoaded){
                self.__trackpageLoaded=true;
                self.trackPage=newTrackPage(self);
                self.trackPage.appendTo(self.$el.children('.dropdown-menu'));
            }
        });
    },
});

});
