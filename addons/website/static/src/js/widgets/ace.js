flectra.define("website.ace",function(require){
"usestrict";

varAceEditor=require('web_editor.ace');

/**
 *ExtendsthedefaultvieweditorsothattheURLhashisupdatedwithviewID
 */
varWebsiteAceEditor=AceEditor.extend({
    hash:'#advanced-view-editor',

    //--------------------------------------------------------------------------
    //Public
    //--------------------------------------------------------------------------

    /**
     *@override
     */
    do_hide:function(){
        this._super.apply(this,arguments);
        window.location.hash="";
    },

    //--------------------------------------------------------------------------
    //Private
    //--------------------------------------------------------------------------

    /**
     *@override
     */
    _displayResource:function(){
        this._super.apply(this,arguments);
        this._updateHash();
    },
    /**
     *@override
     */
    _saveResources:function(){
        returnthis._super.apply(this,arguments).then((function(){
            vardefs=[];
            if(this.currentType==='xml'){
                //Whensavingaview,theviewIDmightchange.Thus,the
                //activeIDintheURLwillbeincorrect.Afterthesave
                //reload,thatURLIDwon'tbefoundandJSwillcrash.
                //WeneedtofindthenewID(eitherbecausetheviewbecame
                //specificorbecauseitsparentwaseditedtooandtheview
                //gotcopy/unlink).
                varselectedView=_.findWhere(this.views,{id:this._getSelectedResource()});
                varcontext;
                this.trigger_up('context_get',{
                    callback:function(ctx){
                        context=ctx;
                    },
                });
                defs.push(this._rpc({
                    model:'ir.ui.view',
                    method:'search_read',
                    fields:['id'],
                    domain:[['key','=',selectedView.key],['website_id','=',context.website_id]],
                }).then((function(view){
                    if(view[0]){
                        this._updateHash(view[0].id);
                    }
                }).bind(this)));
            }
            returnPromise.all(defs).then((function(){
                window.location.reload();
                returnnewPromise(function(){});
            }));
        }).bind(this));
    },
    /**
     *@override
     */
    _switchType(type){
        constret=this._super(...arguments);

        if(type==='scss'){
            //Bydefaultshowtheuser_custom_rules.scssoneassomepeople
            //wouldwriterulesinuser_custom_bootstrap_overridden.scss
            //otherwise,notreadingthecommentinsideexplaininghowthat
            //fileshouldbeused.
            this._displayResource('/website/static/src/scss/user_custom_rules.scss');
        }

        returnret;
    },
    /**
     *@override
     */
    _resetResource:function(){
        returnthis._super.apply(this,arguments).then((function(){
            window.location.reload();
            returnnewPromise(function(){});
        }).bind(this));
    },
    /**
     *AddsthecurrentresourceIDintheURL.
     *
     *@private
     */
    _updateHash:function(resID){
        window.location.hash=this.hash+"?res="+(resID||this._getSelectedResource());
    },
});

returnWebsiteAceEditor;
});
