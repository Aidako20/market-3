flectra.define("website.tour.snippet_countdown",function(require){
"usestrict";

consttour=require('web_tour.tour');
constwTourUtils=require('website.tour_utils');

tour.register('snippet_countdown',{
    test:true,
    url:'/?enable_editor=1',
},[
    wTourUtils.dragNDrop({id:'s_countdown',name:'Countdown'}),
    wTourUtils.clickOnSnippet({id:'s_countdown',name:'Countdown'}),
    wTourUtils.changeOption('countdown','we-select:has([data-end-action])we-toggler','endaction'),
    wTourUtils.changeOption('countdown','we-button[data-end-action="message"]','endaction'),
    wTourUtils.changeOption('countdown','we-button.toggle-edit-message','messagepreview'),
    //Thenexttwostepscheckthattheendmessagedoesnotdisappearwhena
    //widgets_start_requestistriggered.
    {
        content:"Hoverthe'hidecountdownattheend'button",
        trigger:'[data-select-class="hide-countdown"]',
        run:function(actions){
            this.$anchor.trigger('mouseover');
            this.$anchor.trigger('mouseenter');
        },
    },
    {
        content:"Checkthatthecountdownmessageisstilldisplayed",
        trigger:'.s_countdown.s_picture',
        run:()=>{
            //Justavisibilitycheck

            //Alsomakesurethemouseoutandmouseleavearetriggeredsothat
            //nextstepsmakesense.
            //TODOthenextstepsarenotactuallytestinganythingwithout
            //itandthemouseoutandmouseleavemakesensebutreallyit
            //shouldnotbe*necessary*tosimulatethosefortheeditorflow
            //tomakesomesense.
            const$previousAnchor=$('[data-select-class="hide-countdown"]');
            $previousAnchor.trigger('mouseout');
            $previousAnchor.trigger('mouseleave');
        },
    },
    //Next,wechangetheendactiontoredirectwhiletheeditmessagetoggle
    //isstillactivated.Now,wecancheckifthecountdowncannotbehidden
    //bymistake.
    wTourUtils.changeOption('countdown','we-select:has([data-end-action])we-toggler','endaction'),
    wTourUtils.changeOption('countdown','we-button[data-end-action="redirect"]','endaction'),
    {
        content:"Clickonthe'hidecountdownattheend'button",
        trigger:'[data-select-class="hide-countdown"]we-checkbox',
        run:function(actions){
            actions.auto();

            //Neededsincethebugthistestiscoveringoccuredafterasmall
            //delay.
            //TODOshouldreallybemorerobust
            setTimeout(()=>{
                document.body.classList.add('o_countdown_tour_small_delay');
            },100);
        },
    },
    {
        content:"Checkthatthecountdownisstilldisplayed",
        trigger:'.s_countdown_canvas_wrapper',
        extra_trigger:'.o_countdown_tour_small_delay',
        run:()=>null,//Justavisibilitycheck
    },
]);
});
