flectra.define('website.tour.focus_blur_snippets',function(require){
'usestrict';

constajax=require('web.ajax');
consttour=require('web_tour.tour');

constblockIDToData={
    parent:{
        selector:'.s_focusblur',
        name:'section',
        number:0,
    },
    child1:{
        selector:'.s_focusblur_child1',
        name:'firstchild',
        number:1,
    },
    child2:{
        selector:'.s_focusblur_child2',
        name:'secondchild',
        number:2,
    },
};

functionclickAndCheck(blockID,expected){
    constblockData=blockIDToData[blockID]||{};

    return[{
        content:blockID?`Enablethe${blockData.name}`:'Disableallblocks',
        trigger:blockData.selector||'#wrapwrap',
    },{
        content:'Oncetherelatedoverlaysareenabled/disabled,checkthatthefocus/blurcallshavebeencorrect.',
        trigger:blockID
            ?`.oe_overlay.ui-draggable:eq(${blockData.number}).oe_active`
            :`#oe_manipulators:not(:has(.oe_active))`,
        run:function(actions){
            constresult=window.focusBlurSnippetsResult;
            window.focusBlurSnippetsResult=[];

            if(expected.length!==result.length
                    ||!expected.every((item,i)=>item===result[i])){
                console.error(`
                    Expected:${expected.toString()}
                    Result:${result.toString()}
                `);
            }
        },
    }];
}

window.focusBlurSnippetsResult=[];

tour.register('focus_blur_snippets',{
    test:true,
    url:'/?enable_editor=1',
},[
    {
        content:'FirstloadourcustomJSoptions',
        trigger:'body',
        run:function(){
            ajax.loadJS('/website/static/tests/tours/tour_utils/focus_blur_snippets_options.js').then(function(){
                $('body').addClass('focus_blur_snippets_options_loaded');
            });
        },
    },
    {
        content:'Dragthecustomblockintothepage',
        trigger:'#snippet_structure.oe_snippet:has(.oe_snippet_body.s_focusblur).oe_snippet_thumbnail',
        extra_trigger:'body.focus_blur_snippets_options_loaded',
        run:'drag_and_drop#wrap',
    },
    ...clickAndCheck('parent',['focusparent']),
    ...clickAndCheck(null,['blurparent']),
    ...clickAndCheck('child1',['focusparent','focuschild1']),
    ...clickAndCheck('child1',[]),
    ...clickAndCheck(null,['blurparent','blurchild1']),
    ...clickAndCheck('parent',['focusparent']),
    ...clickAndCheck('child1',['blurparent','focusparent','focuschild1']),
    ...clickAndCheck('child2',['blurparent','blurchild1','focusparent','focuschild2']),
    ...clickAndCheck('parent',['blurparent','blurchild2','focusparent']),
]);
});
