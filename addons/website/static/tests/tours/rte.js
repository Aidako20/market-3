flectra.define('website.tour.rte',function(require){
'usestrict';

varajax=require('web.ajax');
varsession=require('web.session');
vartour=require('web_tour.tour');
varWysiwyg=require('web_editor.wysiwyg.root');

vardomReady=newPromise(function(resolve){
    $(resolve);
});
varready=Promise.all([domReady,session.is_bound,ajax.loadXML()]);

tour.register('rte_translator',{
    test:true,
    url:'/',
    wait_for:ready,
},[{
    content:"clicklanguagedropdown",
    trigger:'.js_language_selector.dropdown-toggle',
},{
    content:"clickonAddalanguage",
    trigger:'a.o_add_language',
},{
    content:"selectParseltongue",
    trigger:'select[name="lang"]',
    run:'text"pa_GB"',
},{
    content:"loadParseltongue",
    trigger:'.modal-footerbutton:first',
    extra_trigger:'.modalselect[name="lang"]:propValueContains(pa_GB)',
},{
    content:"clicklanguagedropdown(2)",
    trigger:'.js_language_selector.dropdown-toggle',
    timeout:60000,
},{
    content:"gotoenglishversion",
    trigger:'.js_language_selectora[data-url_code="en"]',
    extra_trigger:'html[lang*="pa-GB"]',
},{
    content:"Opennewpagemenu",
    trigger:"body:has(#o_new_content_menu_choices.o_hidden)#new-content-menu>a",
    extra_trigger:'a[data-action="edit"]',
    consumeVisibleOnly:true,
},{
    content:"clickonnewpage",
    trigger:'a[data-action="new_page"]',
},{
    content:"insertpagename",
    trigger:'#editor_new_pageinput[type="text"]',
    run:'textrte_translator',
},{
    content:"createpage",
    trigger:'button.btn-continue',
    extra_trigger:'input[type="text"]:propValue(rte_translator)',
},{
    content:"dropasnippet",
    trigger:"#snippet_structure.oe_snippet:eq(1).oe_snippet_thumbnail",
    run:'drag_and_drop#wrap',
},{
    content:"changecontent",
    trigger:'#wrap',
    run:function(){
        $("#wrapp:first").replaceWith('<p>Writeoneor<fontstyle="background-color:yellow;">twoparagraphs<b>describing</b></font>yourproductor\
                <fontstyle="color:rgb(255,0,0);">services</font>.Tobesuccessfulyourcontentneedstobe\
                usefultoyour<ahref="/999">readers</a>.</p><inputplaceholder="testtranslateplaceholder"/>\
                <p>&lt;b&gt;&lt;/b&gt;isanHTML&nbsp;tag&amp;isempty</p>');
        $("#wrapimg").attr("title","testtranslateimagetitle");
    }
},{
    content:"save",
    trigger:'button[data-action=save]',
    extra_trigger:'#wrapp:firstb',
},{
    content:"clicklanguagedropdown(3)",
    trigger:'.js_language_selector.dropdown-toggle',
    extra_trigger:'body:not(.o_wait_reload):not(:has(.note-editor))a[data-action="edit"]',
},{
    content:"clickonParseltongueversion",
    trigger:'.js_language_selectora[data-url_code="pa_GB"]',
    extra_trigger:'html[lang*="en"]:not(:has(button[data-action=save]))',
},{
    content:"translate",
    trigger:'html:not(:has(#wrappspan)).o_menu_systraya[data-action="translate"]',
},{
    content:"closemodal",
    trigger:'.modal-footer.btn-secondary',
},{
    content:"checkiftranslationisactivate",
    trigger:'[data-oe-translation-id]',
},{
    content:"translatetext",
    trigger:'#wrappfont:first',
    run:function(action_helper){
        action_helper.text('translatedParseltonguetext');
        Wysiwyg.setRange(this.$anchor.contents()[0],22);
        this.$anchor.trigger($.Event("keyup",{key:'_',keyCode:95}));
        this.$anchor.trigger('input');
    },
},{
    content:"translatetextwithspecialchar",
    trigger:'#wrapinput+pspan:first',
    run:function(action_helper){
        action_helper.click();
        this.$anchor.prepend('&lt;{translated}&gt;');
        Wysiwyg.setRange(this.$anchor.contents()[0],0);
        this.$anchor.trigger($.Event("keyup",{key:'_',keyCode:95}));
        this.$anchor.trigger('input');
    },
},{
    content:"clickoninput",
    trigger:'#wrapinput:first',
    extra_trigger:'#wrap.o_dirtyfont:first:contains(translatedParseltonguetext)',
    run:'click',
},{
    content:"translateplaceholder",
    trigger:'input:first',
    run:'texttestParseltongueplaceholder',
},{
    content:"closemodal",
    trigger:'.modal-footer.btn-primary',
    extra_trigger:'.modalinput:propValue(testParseltongueplaceholder)',
},{
    content:"check:inputmarkedastranslated",
    trigger:'#wrapinput[placeholder="testParseltongueplaceholder"].oe_translated',
    run:()=>{},
},{
    content:"savetranslation",
    trigger:'button[data-action=save]',
},{
    content:"check:contentistranslated",
    trigger:'#wrappfont:first:contains(translatedParseltonguetext)',
    extra_trigger:'body:not(.o_wait_reload):not(:has(.note-editor))a[data-action="edit_master"]',
    run:function(){},//it'sacheck
},{
    content:"check:contentwithspecialcharistranslated",
    trigger:"#wrapinput+p:contains(<{translated}><b></b>isanHTML\xa0tag&)",
    run:function(){},//it'sacheck

},{
    content:"check:placeholdertranslation",
    trigger:'input[placeholder="testParseltongueplaceholder"]',
    run:function(){},//it'sacheck

},{
    content:"openlanguageselector",
    trigger:'.js_language_selectorbutton:first',
    extra_trigger:'html[lang*="pa-GB"]:not(:has(#wrappspan))',
},{
    content:"returntoenglishversion",
    trigger:'.js_language_selectora[data-url_code="en"]',
},{
    content:"editenglishversion",
    trigger:'a[data-action=edit]',
    extra_trigger:'body:not(:has(#wrappfont:first:containsExact(paragraphs<b>describing</b>)))',
},{
    content:"selecttext",
    extra_trigger:'#oe_snippets.o_loaded',
    trigger:'#wrapp',
    run:function(action_helper){
        action_helper.click();
        varel=this.$anchor[0];
        varmousedown=document.createEvent('MouseEvents');
        mousedown.initMouseEvent('mousedown',true,true,window,0,0,0,0,0,false,false,false,false,0,el);
        el.dispatchEvent(mousedown);
        varmouseup=document.createEvent('MouseEvents');
        Wysiwyg.setRange(el.childNodes[2],6,el.childNodes[2],13);
        mouseup.initMouseEvent('mouseup',true,true,window,0,0,0,0,0,false,false,false,false,0,el);
        el.dispatchEvent(mouseup);
    },
},{
    content:"underline",
    trigger:'.note-air-popoverbutton[data-event="underline"]',
},{
    content:"savenewchange",
    trigger:'button[data-action=save]',
    extra_trigger:'#wrap.o_dirtypu',

    },{
    content:"clicklanguagedropdown(4)",
    trigger:'.js_language_selector.dropdown-toggle',
    extra_trigger:'body:not(.o_wait_reload):not(:has(.note-editor))a[data-action="edit"]',
},{
    content:"returninParseltongue",
    trigger:'html[lang="en-US"].js_language_selector.js_change_lang[data-url_code="pa_GB"]',
},{
    content:"checkbis:contentistranslated",
    trigger:'#wrappfont:first:contains(translatedParseltonguetext)',
    extra_trigger:'html[lang*="pa-GB"]body:not(:has(button[data-action=save]))',
},{
    content:"checkbis:placeholdertranslation",
    trigger:'input[placeholder="testParseltongueplaceholder"]',
},{
    content:"Opencustomizemenu",
    trigger:"#customize-menu>.dropdown-toggle",
},{
    content:"OpenHTMLeditor",
    trigger:"[data-action='ace']",
},{
    content:"Checkthattheeditorisnotshowingtranslatedcontent(1)",
    trigger:'.ace_text-layer.ace_line:contains("anHTML")',
    run:function(actions){
        varlineEscapedText=$(this.$anchor.text()).text();
        if(lineEscapedText!=="&lt;b&gt;&lt;/b&gt;isanHTML&nbsp;tag&amp;isempty"){
            console.error('TheHTMLeditorshoulddisplaythecorrectuntranslatedcontent');
            $('body').addClass('rte_translator_error');
        }
    },
},{
    content:"Checkthattheeditorisnotshowingtranslatedcontent(2)",
    trigger:'body:not(.rte_translator_error)',
    run:function(){},
}]);
});
