flectra.define('website.test.html_editor',function(require){
'usestrict';

vartour=require('web_tour.tour');

constadminCssModif='#wrap{display:none;}';
constdemoCssModif='//demo_edition';

tour.register('html_editor_multiple_templates',{
    test:true,
    url:'/generic',
},
    [
        //1.EditthepagethroughEditMode,itwillCOWtheview
        {
            content:"entereditmode",
            trigger:'a[data-action=edit]',
        },
        {
            content:"dropasnippet",
            trigger:'#oe_snippets.oe_snippet:has(.s_cover).oe_snippet_thumbnail',
            //idstartingby'oe_structure..'willactuallycreateaninheritedview
            run:"drag_and_drop#oe_structure_test_ui",
        },
        {
            content:"savethepage",
            extra_trigger:'#oe_structure_test_ui.o_dirty',
            trigger:"button[data-action=save]",
        },
        //2.Editgenericview
        {
            content:"opencustomizemenu",
            extra_trigger:"body:not(.editor_enable)",
            trigger:'#customize-menu>a',
        },
        {
            content:"openhtmleditor",
            trigger:'#html_editor',
        },
        {
            content:"addsomethinginthegenericview",
            trigger:'div.ace_line.ace_xml:contains("Generic")',
            run:function(){
                ace.edit('ace-view-editor').getSession().insert({row:3,column:1},'<p>somenewcontent</p>\n');
            },
        },
        //3.Editoe_structurespecificview
        {
            content:"selectoe_structurespecificview",
            trigger:'div.ace_line.ace_xml:contains("somenewcontent")',
            run:function(){
                varviewId=$('#ace-view-listoption:contains("oe_structure_test_ui")').val();
                $('#ace-view-list').val(viewId).trigger('change');
            },
        },
        {
            content:"addsomethingintheoe_structurespecificview",
            extra_trigger:'#ace-view-id:contains("test.generic_view_oe_structure_test_ui")',//Ifnoxml_iditshouldshowkey
            trigger:'div.ace_line.ace_xml:contains("s_cover")',
            run:function(){
                ace.edit('ace-view-editor').getSession().insert({row:2,column:1},'<p>anothernewcontent</p>\n');
            },
        },
        {
            content:"savethehtmleditor",
            extra_trigger:'div.ace_line.ace_xml:contains("anothernewcontent")',
            trigger:".o_ace_view_editorbutton[data-action=save]",
        },
        {
           content:"checkthatthepagehasbothmodification",
           extra_trigger:'#wrapwrap:contains("anothernewcontent")',
           trigger:'#wrapwrap:contains("somenewcontent")',
           run:function(){},//it'sacheck
       },
    ]
);

tour.register('test_html_editor_scss',{
    test:true,
    url:'/contactus',
},
    [
        //1.OpenHtmlEditorandselectascssfile
        {
            content:"opencustomizemenu",
            extra_trigger:'#wrap:visible',//ensurestateforlater
            trigger:'#customize-menu>a',
        },
        {
            content:"openhtmleditor",
            trigger:'#html_editor',
        },
        {
            content:"opentypeswitcher",
            trigger:'.o_ace_type_switcherbutton',
        },
        {
            content:"selectscssfiles",
            trigger:'.o_ace_type_switcher_choice[data-type="scss"]',
        },
        {
            content:"select'user_custom_rules'",
            trigger:'body:has(#ace-scss-listoption:contains("user_custom_rules"))',
            run:function(){
                varscssId=$('#ace-scss-listoption:contains("user_custom_rules")').val();
                $('#ace-scss-list').val(scssId).trigger('change');
            },
        },
        //2.Editthatfileandensureitwassavedthenresetit
        {
            content:"addsomescsscontentinthefile",
            trigger:'div.ace_line.ace_comment:contains("footer{")',
            run:function(){
                ace.edit('ace-view-editor').getSession().insert({row:2,column:0},`${adminCssModif}\n`);
            },
        },
        {
            content:"savethehtmleditor",
            extra_trigger:`div.ace_line:contains("${adminCssModif}")`,
            trigger:".o_ace_view_editorbutton[data-action=save]",
        },
         {
            content:"checkthatthescssmodificationgotapplied",
            trigger:'body:has(#wrap:hidden)',
            run:function(){},//it'sacheck
        },
        {
            content:"resetview(afterreload,htmleditorshouldhavebeenreopenedwhereitwas)",
            trigger:'#ace-view-idbutton[data-action="reset"]',
        },
        {
            content:"confirmresetwarning",
            trigger:'.modal-footer.btn-primary',
        },
        {
            content:"checkthatthescssfilewasresetcorrectly,wrapcontentshouldnowbevisibleagain",
            trigger:'#wrap:visible',
            run:function(){},//it'sacheck
        },
        //3.Customizeagainthatfile(willbeusedinsecondpartofthetest
        //   toensurerestrictedusercanstillusetheHTMLEditor)
        {
            content:"addsomescsscontentinthefile",
            trigger:'div.ace_line.ace_comment:contains("footer{")',
            run:function(){
                ace.edit('ace-view-editor').getSession().insert({row:2,column:0},`${adminCssModif}\n`);
            },
        },
        {
            content:"savethehtmleditor",
            extra_trigger:`div.ace_line:contains("${adminCssModif}")`,
            trigger:'.o_ace_view_editorbutton[data-action=save]',
        },
        {
            content:"checkthatthescssmodificationgotapplied",
            trigger:'body:has(#wrap:hidden)',
            run:function(){
                window.location.href='/web/session/logout?redirect=/web/login';
            },
        },

        //Thispartofthetestensuresthatarestrictedusercanstilluse
        //theHTMLEditorifsomeoneelsemadeacustomizationpreviously.

        {
            content:"Submitlogin",
            trigger:'.oe_login_form',
            run:function(){
                $('.oe_login_forminput[name="login"]').val("demo");
                $('.oe_login_forminput[name="password"]').val("demo");
                $('.oe_login_forminput[name="redirect"]').val("/");
                $('.oe_login_form').submit();
            },
        },
        //4.OpenHtmlEditorandselectascssfile
        {
            content:"opencustomizemenu",
            trigger:'#customize-menu>a',
        },
        {
            content:"openhtmleditor",
            trigger:'#html_editor',
        },
        {
            content:"opentypeswitcher",
            trigger:'.o_ace_type_switcherbutton',
        },
        {
            content:"selectscssfiles",
            trigger:'.o_ace_type_switcher_choice[data-type="scss"]',
        },
        {
            content:"select'user_custom_rules'",
            trigger:'body:has(#ace-scss-listoption:contains("user_custom_rules"))',
            run:function(){
                varscssId=$('#ace-scss-listoption:contains("user_custom_rules")').val();
                $('#ace-scss-list').val(scssId).trigger('change');
            },
        },
        //5.Editthatfileandensureitwassavedthenresetit
        {
            content:"addsomescsscontentinthefile",
            trigger:`div.ace_line:contains("${adminCssModif}")`,//ensuretheadminmodificationishere
            run:function(){
                ace.edit('ace-view-editor').getSession().insert({row:2,column:0},`${demoCssModif}\n`);
            },
        },
        {
            content:"savethehtmleditor",
            extra_trigger:`div.ace_line:contains("${demoCssModif}")`,
            trigger:".o_ace_view_editorbutton[data-action=save]",
        },
        {
            content:"resetview(afterreload,htmleditorshouldhavebeenreopenedwhereitwas)",
            trigger:'#ace-view-idbutton[data-action="reset"]',
        },
        {
            content:"confirmresetwarning",
            trigger:'.modal-footer.btn-primary',
        },
        {
            content:"checkthatthescssfilewasresetcorrectly",
            extra_trigger:`body:not(:has(div.ace_line:contains("${adminCssModif}")))`,
            trigger:`body:not(:has(div.ace_line:contains("${demoCssModif}")))`,
            run:function(){},//it'sacheck
        },
    ]
);

});
