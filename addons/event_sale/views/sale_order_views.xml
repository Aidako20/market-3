<?xmlversion="1.0"encoding="utf-8"?>
<flectra>
    <recordid="sale_order_view_form"model="ir.ui.view">
        <fieldname="name">sale.order.form.inherit.event.sale</field>
        <fieldname="model">sale.order</field>
        <fieldname="inherit_id"ref="sale.view_order_form"/>
        <fieldname="arch"type="xml">
            <xpathexpr="//button[@name='preview_sale_order']"position="before">
                <buttonname="action_view_attendee_list"type="object"
                        class="oe_stat_button"icon="fa-users"attrs="{'invisible':[('attendee_count','=',0)]}">
                    <fieldname="attendee_count"widget="statinfo"string="Attendees"/>
                </button>
            </xpath>
            <xpathexpr="//field[@name='order_line']//form//field[@name='product_id']"position="after">
                <field
                    name="event_id"
                    domain="[
                        ('event_ticket_ids.product_id','=',product_id),
                        ('date_end','&gt;=',time.strftime('%Y-%m-%d00:00:00')),
                        '|',('company_id','=',False),('company_id','=',parent.company_id)
                    ]"
                    attrs="{'invisible':[('event_ok','=',False)],'required':[('event_ok','!=',False)]}"
                    options="{'no_open':True,'no_create':True}"
                />
                <field
                    name="event_ticket_id"
                    domain="[
                        ('event_id','=',event_id),
                        ('product_id','=',product_id),
                        '|',('seats_limited','=',False),('seats_available','>',0),'|',('company_id','=',False),('company_id','=',parent.company_id)
                    ]"
                    attrs="{
                        'invisible':['|',('event_ok','=',False),('event_id','=',False)],
                        'required':[('event_ok','!=',False),('event_id','!=',False)],
                    }"
                    options="{'no_open':True,'no_create':True}"
                />
                <fieldname="event_ok"invisible="1"/>
            </xpath>
            <xpathexpr="//field[@name='order_line']//tree//field[@name='product_template_id']"position="after">
                <fieldname="event_ok"invisible="1"/>
                <fieldname="event_id"optional="hide"domain="['|',('company_id','=',False),('company_id','=',parent.company_id)]"/>
                <fieldname="event_ticket_id"optional="hide"domain="['|',('company_id','=',False),('company_id','=',parent.company_id)]"/>
            </xpath>
        </field>
    </record>
</flectra>
