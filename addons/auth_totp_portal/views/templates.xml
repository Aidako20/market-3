<flectra>
    <templateid="auth_totp_frontend"name="TOTPfrontend(portal)"inherit_id="portal.assets_frontend">
        <xpathexpr="."position="inside">
            <scripttype="application/javascript"
                    src="/auth_totp_portal/static/src/js/totp_frontend.js"/>
        </xpath>
    </template>
    <templateid="assets_tests"inherit_id="web.assets_tests">
        <xpathexpr="."position="inside">
            <scripttype="text/javascript"src="/auth_totp_portal/static/tests/totp_portal.js"></script>
        </xpath>
    </template>

    <templateid="totp_portal_hook"name="TOTPPortalhook"inherit_id="portal.portal_my_security">
        <xpathexpr="//div[hasclass('o_portal_security_body')]">
            <!--
                portalusersdon'thaveaccesstonon-qwebviewsanymore,so
                embedthetargetviewasa*dataisland*ofsorts,aJSONembed
                ofthefields_view_getcouldhavebeennicebutat14kit'dbea
                bitridiculous
            -->
            <divclass="d-none"id="totp_wizard_view">
                <tt-esc="env.ref('auth_totp.view_totp_wizard').sudo().read_combined(['arch'])['arch']"/>
            </div>
            <section>
                <h3>Two-factorauthentication</h3>
                <tt-if="notuser_id.totp_enabled">
                    <divclass="alertalert-secondary"role="status">
                        <iclass="fafa-warning"/>
                        Two-factorauthenticationnotenabled
                    </div>
                    <buttontype="button"class="btnbtn-secondary"id="auth_totp_portal_enable">
                        Enabletwo-factorauthentication
                    </button>
                </t>
                <tt-else="">
                    <spanclass="text-success">
                        <iclass="fafa-check-circle"/>
                        Two-factorauthenticationenabled
                    </span>
                    <buttontype="button"class="btnbtn-link"id="auth_totp_portal_disable">
                        (Disabletwo-factorauthentication)
                    </button>
                    <tt-if="len(user_id.totp_trusted_device_ids)">
                        <tableclass="tableo_main_table">
                            <thead>
                                <tr>
                                    <th><strong>TrustedDevice</strong></th>
                                    <th><strong>AddedOn</strong></th>
                                </tr>
                            </thead>
                            <tbody>
                                <trt-foreach="user_id.totp_trusted_device_ids"t-as="td">
                                    <td>
                                        <spant-field="td.name"/>
                                    </td>
                                    <td>
                                        <spant-field="td.create_date"/>
                                    </td>
                                    <td>
                                        <iclass="fafa-trashtext-danger"type="button"t-att-id="td.id"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <buttonclass="btnbtn-primary"type="button"id="auth_totp_portal_revoke_all_devices">
                            RevokeAll
                        </button>
                    </t>
                </t>
            </section>
        </xpath>
    </template>
</flectra>
