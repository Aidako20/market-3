<?xmlversion="1.0"encoding="utf-8"?>
<flectra>

    <templateid="report_invoice"inherit_id="account.report_invoice">
        <xpathexpr='//t[@t-call="account.report_invoice_document"]'position="after">
            <tt-if="o._get_name_invoice_report()=='l10n_gcc_invoice.arabic_english_invoice'"
               t-call="l10n_gcc_invoice.arabic_english_invoice"t-lang="lang"/>
        </xpath>
    </template>

    <templateid="report_invoice_with_payments"inherit_id="account.report_invoice_with_payments">
        <xpathexpr='//t[@t-call="account.report_invoice_document"]'position="after">
            <tt-if="o._get_name_invoice_report()=='l10n_gcc_invoice.arabic_english_invoice'"
               t-call="l10n_gcc_invoice.arabic_english_invoice"t-lang="lang"/>
        </xpath>
    </template>

    <templateid="arabic_english_invoice">
        <tt-call="l10n_gcc_invoice.external_layout_standard">

            <tt-set="o_sec"t-value="o.with_context(lang='ar_001')"/>
            <tt-set="o"t-value="o.with_context(lang='en_US')"/>

            <divclass="page">
                <h3>
                    <divclass="row">
                        <divclass="col-4"style="text-align:left">
                            <spant-if="o.move_type=='out_invoice'ando.state=='posted'">
                                TaxInvoice
                            </span>
                            <spant-if="o.move_type=='out_invoice'ando.state=='draft'">
                                DraftInvoice
                            </span>
                            <spant-if="o.move_type=='out_invoice'ando.state=='cancel'">
                                CancelledInvoice
                            </span>
                            <spant-if="o.move_type=='out_refund'">
                                CreditNote
                            </span>
                            <spant-if="o.move_type=='in_refund'">
                                VendorCreditNote
                            </span>
                            <spant-if="o.move_type=='in_invoice'">
                                VendorBill
                            </span>
                        </div>
                        <divclass="col-4">
                            <spant-if="o.name!='/'"t-field="o.name"/>
                        </div>
                        <divclass="col-4"style="text-align:right">
                            <spant-if="o.move_type=='out_invoice'ando.state=='posted'">
                                فاتورةضريبية
                            </span>
                            <spant-if="o.move_type=='out_invoice'ando.state=='draft'">
                                مسودةفاتورة
                            </span>
                            <spant-if="o.move_type=='out_invoice'ando.state=='cancel'">
                                فاتورةملغاة
                            </span>
                            <spant-if="o.move_type=='out_refund'">
                                إشعارخصم
                            </span>
                            <spant-if="o.move_type=='in_refund'">
                                إشعارخصمالمورد
                            </span>
                            <spant-if="o.move_type=='in_invoice'">
                                فاتورةالمورد
                            </span>
                        </div>
                    </div>
                </h3>

                <divid="informations"class="pb-3">
                    <divclass="row"t-if="o.invoice_date"name="invoice_date">
                        <divclass="col-2">
                            <strongstyle="white-space:nowrap">InvoiceDate:
                            </strong>
                        </div>
                        <divclass="col-2">
                            <spant-field="o.invoice_date"/>
                        </div>
                        <divclass="col-2text-right">
                            <strongstyle="white-space:nowrap">:
                                تاريخالفاتورة
                            </strong>
                        </div>
                    </div>
                    <divclass="row"
                         t-if="o.invoice_date_dueando.move_type=='out_invoice'ando.state=='posted'"
                         name="due_date">
                        <divclass="col-2">
                            <strongstyle="white-space:nowrap">DueDate:
                            </strong>
                        </div>
                        <divclass="col-2">
                            <spant-field="o.invoice_date_due"/>
                        </div>
                        <divclass="col-2text-right">
                            <strongstyle="white-space:nowrap">:
                                تاريخالاستحقاق
                            </strong>
                        </div>
                    </div>
                    <divclass="row"t-if="o.invoice_origin"name="origin">
                        <divclass="col-2">
                            <strongstyle="white-space:nowrap">Source:
                            </strong>
                        </div>
                        <divclass="col-2">
                            <spant-field="o.invoice_origin"/>
                        </div>
                        <divclass="col-2text-right">
                            <strongstyle="white-space:nowrap">:
                                المصدر
                            </strong>
                        </div>
                    </div>
                    <divclass="row"t-if="o.partner_id.ref"name="customer_code">
                        <divclass="col-2">
                            <strongstyle="white-space:nowrap">:
                                CustomerCode
                            </strong>
                        </div>
                        <divclass="col-2">
                            <spant-field="o.partner_id.ref"/>
                        </div>
                        <divclass="col-2text-right">
                            <strongstyle="white-space:nowrap">:
                                كودالعميل
                            </strong>
                        </div>
                    </div>
                    <divclass="col-automw-100mb-2"t-if="o.ref"name="reference">
                        <divclass="col-2">
                            <strongstyle="white-space:nowrap">Reference:
                            </strong>
                        </div>
                        <divclass="col-2">
                            <spant-field="o.ref"/>
                        </div>
                        <divclass="col-2text-right">
                            <strongstyle="white-space:nowrap">:
                                رقمالإشارة
                            </strong>
                        </div>
                    </div>
                </div>

                <tt-set="display_discount"t-value="any(l.discountforlino.invoice_line_ids)"/>
                <tableclass="tabletable-smo_main_table"name="invoice_line_table">
                    <thead>
                        <tr>
                            <tt-set="colspan"t-value="6"/>
                            <thname="th_description"class="text-left">
                                <span>
                                    Description
                                </span>
                                <br/>
                                <span>
                                    الوصف
                                </span>
                            </th>
                            <thname="th_source"class="d-nonetext-left"t-if="0">
                                <span>
                                    SourceDocument
                                </span>
                                <br/>
                                <span>
                                    المستندالمصدر
                                </span>
                            </th>
                            <thname="th_quantity"class="text-right">
                                <span>
                                    Quantity
                                </span>
                                <br/>
                                <span>
                                    الكمية
                                </span>
                            </th>
                            <thname="th_priceunit"
                                class="text-right">
                                <span>
                                    Unitprice
                                </span>
                                <br/>
                                <span>
                                    سعرالوحدة
                                </span>
                            </th>
                            <thname="th_price_unit"t-if="display_discount"
                                class="text-right">
                                <span>
                                    Disc.%
                                </span>
                                <br/>
                                <span>
                                    خصم%
                                </span>
                                <tt-set="colspan"t-value="colspan+1"/>
                            </th>
                            <thname="th_taxes"
                                class="text-right">
                                <span>
                                    Taxes
                                </span>
                                <br/>
                                <span>
                                    الضرائب
                                </span>
                            </th>
                            <thname="th_subtotal"class="text-right">
                                <span>
                                    Amount
                                </span>
                                <br/>
                                <span>
                                    مبلغ
                                </span>
                            </th>
                            <thname="th_tax_amount"
                                class="text-right">
                                <span>
                                    VATAmount
                                </span>
                                <br/>
                                <span>
                                    قيمةالضريبة
                                </span>
                            </th>
                            <thname="th_total"class="text-right">
                                <span>
                                    TotalPrice
                                </span>
                                <br/>
                                <span>
                                    السعرالاجمالي
                                </span>
                            </th>
                        </tr>
                    </thead>
                    <tbodyclass="invoice_tbody">
                        <tt-set="current_subtotal"t-value="0"/>
                        <tt-set="lines"
                           t-value="o.invoice_line_ids.sorted(key=lambdal:(-l.sequence,l.date,l.move_name,-l.id),reverse=True)"/>


                        <tt-foreach="lines"t-as="line">
                            <tt-set="current_subtotal"t-value="current_subtotal+line.price_subtotal"
                               groups="account.group_show_line_subtotals_tax_excluded"/>
                            <tt-set="current_subtotal"t-value="current_subtotal+line.price_total"
                               groups="account.group_show_line_subtotals_tax_included"/>

                            <trt-att-class="'bg-200font-weight-boldo_line_section'ifline.display_type=='line_section'else'font-italico_line_note'ifline.display_type=='line_note'else''">
                                <tt-if="notline.display_type"name="account_invoice_line_accountable">
                                    <tdname="account_invoice_line_name">
                                        <tt-if="line.product_id">
                                            <tt-set="arabic_name"t-value="line.with_context(lang='ar_001').product_id.display_name"/>
                                            <tt-set="english_name"t-value="line.with_context(lang='en_US').product_id.display_name"/>

                                            <spant-field="line.product_id.display_name"
                                                t-options="{'widget':'text'}"/>

                                            <tt-if="arabic_name!=english_name">
                                                <br/>
                                                <spant-field="line.with_context(lang='ar_001').product_id.name"
                                                    style="text:right"
                                                    t-options="{'widget':'text'}"/>
                                            </t>

                                            <tt-if="line.name!=english_nameandline.name!=arabic_name">
                                                <br/>
                                                <spant-field="line.name"t-options="{'widget':'text'}"/>
                                            </t>
                                        </t>
                                        <tt-else="">
                                            <spant-field="line.name"t-options="{'widget':'text'}"/>
                                        </t>
                                    </td>
                                    <tdclass="text-right">
                                        <spant-field="line.quantity"/>
                                        <spant-field="line.product_uom_id"groups="uom.group_uom"/>
                                    </td>
                                    <tdclass="text-right">
                                        <spanclass="text-nowrap"t-field="line.price_unit"/>
                                    </td>
                                    <tdt-if="display_discount"
                                        class="text-right">
                                        <spanclass="text-nowrap"t-field="line.discount"/>
                                    </td>
                                    <tdclass="text-right">
                                        <spant-esc="','.join(map(lambdax:(x.descriptionorx.name),line.tax_ids))"
                                              id="line_tax_ids"/>
                                    </td>
                                    <tdclass="text-righto_price_total">
                                        <spanclass="text-nowrap"t-field="line.price_subtotal"/>
                                    </td>
                                    <tdclass="text-right">
                                        <spanclass="text-nowrap"t-field="line.l10n_gcc_invoice_tax_amount"/>
                                    </td>
                                    <tdclass="text-righto_price_total">
                                        <spanclass="text-nowrap"t-field="line.price_total"/>
                                    </td>
                                </t>
                                <tt-if="line.display_type=='line_section'">
                                    <tdcolspan="99">
                                        <spant-field="line.name"t-options="{'widget':'text'}"/>
                                    </td>
                                    <tt-set="current_section"t-value="line"/>
                                    <tt-set="current_subtotal"t-value="0"/>
                                </t>
                                <tt-if="line.display_type=='line_note'">
                                    <tdcolspan="99">
                                        <spant-field="line.name"t-options="{'widget':'text'}"/>
                                    </td>
                                </t>
                            </tr>

                            <tt-if="current_sectionand(line_lastorlines[line_index+1].display_type=='line_section')">
                                <trclass="is-subtotaltext-right">
                                    <tdcolspan="99">
                                        <strongclass="mr16"style="display:inline-block">Subtotal/الإجماليالفرعي</strong>
                                        <span
                                                t-esc="current_subtotal"
                                                t-options='{"widget":"monetary","display_currency":o.currency_id}'
                                        />
                                    </td>
                                </tr>
                            </t>
                        </t>
                    </tbody>
                </table>

                <divclass="clearfixpt-4pb-3">
                    <divid="total"class="row">
                        <divclass="col-6">
                            <tableclass="tabletable-sm"style="page-break-inside:avoid;">
                                <trclass="border-blacko_subtotal">
                                    <td>
                                        <strong>
                                            Subtotal
                                            /
                                            الإجماليالفرعي
                                        </strong>
                                    </td>
                                    <tdclass="text-right">
                                        <spant-field="o.amount_untaxed"/>
                                    </td>
                                </tr>
                                <tt-foreach="o.amount_by_group"t-as="amount_by_group">
                                    <trstyle="">
                                        <tt-if="len(o.line_ids.filtered(lambdaline:line.tax_line_id))in[0,1]ando.amount_untaxed==amount_by_group[2]">
                                            <td><spanclass="text-nowrap"t-esc="amount_by_group[0]"/></td>
                                            <tdclass="text-righto_price_total">
                                                <spanclass="text-nowrap"t-esc="amount_by_group[3]"/>
                                            </td>
                                        </t>
                                        <tt-else="">
                                            <td>
                                                <spant-esc="amount_by_group[0]"/>
                                                <spanclass="text-nowrap">on
                                                    <tt-esc="amount_by_group[4]"/>
                                                </span>
                                            </td>
                                            <tdclass="text-righto_price_total">
                                                <spanclass="text-nowrap"t-esc="amount_by_group[3]"/>
                                            </td>
                                        </t>
                                    </tr>
                                </t>
                                <trclass="border-blacko_total">
                                    <td>
                                        <strong>
                                            Total
                                            /
                                            المجموع
                                        </strong>
                                    </td>
                                    <tdclass="text-right">
                                        <spanclass="text-nowrap"t-field="o.amount_total"/>
                                    </td>
                                </tr>

                                <tt-if="print_with_payments">
                                    <tt-if="o.payment_state!='invoicing_legacy'">
                                        <tt-set="payments_vals"t-value="o.sudo()._get_reconciled_info_JSON_values()"/>
                                        <tt-foreach="payments_vals"t-as="payment_vals">
                                            <trclass="border-blacko_total">
                                                <td>
                                                    <iclass="row">
                                                        <divclass="col-7oe_form_fieldoe_payment_label">
                                                            Paidon/دفعتفي:
                                                        </div>
                                                        <divclass="col-5pl-0oe_form_fieldoe_payment_label">
                                                            <tt-esc="payment_vals['date']"/>
                                                        </div>
                                                    </i>
                                                </td>
                                                <tdclass="text-right">
                                                    <spant-esc="payment_vals['amount']"
                                                          t-options='{"widget":"monetary","display_currency":o.currency_id}'/>
                                                </td>
                                            </tr>
                                        </t>
                                        <tt-if="len(payments_vals)>0">
                                            <trclass="border-black">
                                                <td>
                                                    <strong>
                                                        AmountDue
                                                        /
                                                        المبلغالمستحق
                                                    </strong>
                                                </td>
                                                <tdclass="text-right">
                                                    <spant-field="o.amount_residual"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </t>
                                </t>
                            </table>
                        </div>
                    </div>
                </div>

                <pt-if="o.move_typein('out_invoice','in_refund')ando.payment_reference"name="payment_communication">
                    <divclass="row">
                        <divclass="col-6text-left">
                            PaymentReference:
                            <b>
                                <spant-field="o.payment_reference"/>
                            </b>
                        </div>
                        <divclass="col-6text-right">
                            <p>
                                <b>
                                    <spant-field="o.payment_reference"/>:
                                </b>رقمإشارةالدفعة
                            </p>
                        </div>
                    </div>
                </p>


                <pt-if="o.invoice_payment_term_id"name="payment_term">
                    <divclass="row">
                        <divclass="col-6text-left">
                            <spant-field="o.invoice_payment_term_id.note"/>
                        </div>
                        <divclass="col-6text-right">
                            <spandir="rtl"t-field="o_sec.invoice_payment_term_id.note"/>
                        </div>

                    </div>
                </p>
                <pt-if="o.narration"name="comment">
                    <divclass="row">
                        <divclass="col-6text-left">
                            <spant-field="o.narration"/>
                        </div>
                        <divclass="col-6text-right">
                            <spant-field="o_sec.narration"/>
                        </div>
                    </div>
                </p>
                <pt-if="o.fiscal_position_id.note"name="note">
                    <divclass="row">
                        <divclass="col-6text-left">
                            <spant-field="o.fiscal_position_id.note"/>
                        </div>
                        <divclass="col-6text-right">
                            <spant-field="o_sec.fiscal_position_id.note"/>
                        </div>
                    </div>
                </p>
                <pt-if="o.invoice_incoterm_id"name="incoterm">
                    <divclass="row">
                        <divclass="col-6text-left">
                            <strong>Incoterm:
                            </strong>
                            <span
                                    t-field="o.invoice_incoterm_id.code"/>
                            -
                            <span
                                    t-field="o.invoice_incoterm_id.name"/>
                        </div>
                        <divclass="col-6text-right">
                            <strong>شرطتجاري:
                            </strong>
                            <span
                                    t-field="o_sec.invoice_incoterm_id.code"/>
                            -
                            <span
                                    t-field="o_sec.invoice_incoterm_id.name"/>
                        </div>
                    </div>
                </p>

            </div>
        </t>
    </template>

    <templateid="external_layout_standard">
        <tt-if="notcompany">
            <!--Multicompany-->
            <tt-if="company_id">
                <tt-set="company"t-value="company_id"/>
            </t>
            <tt-elif="oand'company_id'inoando.company_id.sudo()">
                <tt-set="company"t-value="o.company_id.sudo()"/>
            </t>
            <tt-else="else">
                <tt-set="company"t-value="res_company"/>
            </t>
        </t>

        <tt-set="company"t-value="company.with_context(lang='en_US')"/>

        <divt-attf-class="headero_company_#{company.id}_layout"t-att-style="report_header_style">
            <divclass="row">
                <divclass="col-3mb4">
                    <imgt-if="company.logo"t-att-src="image_data_uri(company.logo)"style="max-height:45px;"
                         alt="Logo"/>
                </div>
                <divclass="col-9text-right"style="margin-top:22px;"t-field="company.report_header"name="moto"/>
            </div>
            <divt-if="company.logoorcompany.report_header"class="rowzero_min_height">
                <divclass="col-12">
                    <divstyle="border-bottom:1pxsolidblack;"/>
                </div>
            </div>
            <divclass="row">
                <divclass="col-4"name="company_address">
                    <divt-field="company.partner_id"
                         t-options='{"widget":"contact","fields":["address","name"],"no_marker":true}'
                    />
                    <pt-if="company.partner_id.vat">
                        <tt-esc="o.company_id.country_id.vat_labelor'TaxID'"/>:
                        <spant-field="company.partner_id.vat"/>
                    </p>
                </div>
                <divclass="col-4"name="qr_code"/>
                <divclass="col-4"name="company_address"dir="rtl"style="text-align:right">
                </div>
            </div>
        </div>

        <divt-attf-class="articleo_report_layout_standardo_company_#{company.id}_layout"
             t-att-data-oe-model="oando._name"t-att-data-oe-id="oando.id"
             t-att-data-oe-lang="oando.env.context.get('lang')">
            <divclass="pt-5">
                <tt-set="address">
                    <addresst-field="o.partner_id"t-options='{"widget":"contact","fields":["address","name"],"no_marker":True}'class="mb-0"/>
                    <pt-if="o.partner_id.vat">
                        <tt-esc="o.company_id.country_id.vat_labelor'TaxID'"/>:
                        <spant-field="o.partner_id.vat"/>
                    </p>
                </t>
                <tt-call="web.address_layout"/>
            </div>
            <tt-raw="0"/>
        </div>

        <divt-attf-class="footero_standard_footero_company_#{company.id}_layout">
            <divclass="text-center"style="border-top:1pxsolidblack;">
                <ulclass="list-inlinemb4">

                    <lit-if="company.phone"class="list-inline-itemd-inline">
                        <spanclass="o_force_ltr"t-field="company.phone"/>
                    </li>
                    <lit-if="company.email"class="list-inline-itemd-inline">
                        <spant-field="company.email"/>
                    </li>
                    <lit-if="company.website"class="list-inline-itemd-inline">
                        <spant-field="company.website"/>
                    </li>
                    <lit-if="company.vat"class="list-inline-itemd-inline"><t
                            t-esc="company.country_id.vat_labelor'TaxID'"/>:
                        <spant-field="company.vat"/>
                    </li>
                </ul>

                <divt-if="report_type=='pdf'"class="text-muted">
                    <divclass="row">
                        <divclass="col-6text-right">
                            Page/صفحة:
                        </div>
                        <divclass="col-6text-leftpl-0">
                            <spanclass="page"/>
                            /
                            <spanclass="topage"/>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </template>


</flectra>
