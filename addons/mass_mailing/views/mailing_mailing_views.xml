<?xmlversion="1.0"encoding="utf-8"?>
<flectra>
        <!-- MAILING!-->
        <recordmodel="ir.ui.view"id="view_mail_mass_mailing_search">
            <fieldname="name">mailing.mailing.search</field>
            <fieldname="model">mailing.mailing</field>
            <fieldname="arch"type="xml">
               <searchstring="Mailings">
                    <fieldname="name"string="Mailing"filter_domain="['|',('name','ilike',self),('subject','ilike',self)]"/>
                    <fieldname="campaign_id"string="Campaign"groups="mass_mailing.group_mass_mailing_campaign"/>
                    <filterstring="MyMailings"name="assigned_to_me"
                            domain="[('user_id','=',uid)]"
                            help="Mailingsthatareassignedtome"/>
                    <separator/>
                    <filtername="filter_sent_date"date="sent_date"/>
                    <separator/>
                    <filtername="inactive"string="Archived"domain="[('active','=',False)]"/>
                    <groupexpand="0"string="GroupBy">
                        <filterstring="Status"name="group_state"context="{'group_by':'state'}"/>
                        <filterstring="SentBy"name="sent_by"domain="[]"context="{'group_by':'email_from'}"/>
                        <separator/>
                        <filterstring="SentPeriod"name="sent_date"domain="[]"context="{'group_by':'sent_date'}"/>
                    </group>
                </search>
            </field>
        </record>

        <recordmodel="ir.ui.view"id="view_mail_mass_mailing_tree">
            <fieldname="name">mailing.mailing.tree</field>
            <fieldname="model">mailing.mailing</field>
            <fieldname="priority">10</field>
            <fieldname="arch"type="xml">
                <treestring="Mailings"sample="1">
                    <fieldname="subject"attrs="{'readonly':[('state','in',('sending','done'))]}"/>
                    <fieldname="mailing_type"invisible="1"/>
                    <fieldname="mailing_model_id"string="Recipients"/>
                    <fieldname="user_id"widget="many2one_avatar_user"/>
                    <fieldname="schedule_date"string="Scheduled"widget="remaining_days"/>
                    <fieldname="sent_date"widget="date"/>
                    <fieldname="state"decoration-info="state=='draft'orstate=='in_queue'"decoration-success="state=='sending'orstate=='done'"widget="badge"/>
                    <fieldname="campaign_id"string="Campaign"
                        groups="mass_mailing.group_mass_mailing_campaign"/>
                    <fieldname="sent"/>
                    <fieldname="bounced_ratio"string="Bounced(%)"/>
                    <fieldname="received_ratio"string="Delivered(%)"/>
                    <fieldname="opened_ratio"string="Opened(%)"/>
                    <fieldname="clicks_ratio"string="Clicked(%)"/>
                    <fieldname="replied_ratio"string="Replied(%)"/>
                </tree>
            </field>
        </record>

        <recordmodel="ir.ui.view"id="view_mail_mass_mailing_form">
            <fieldname="name">mailing.mailing.form</field>
            <fieldname="model">mailing.mailing</field>
            <fieldname="arch"type="xml">
                <formstring="Mailing">
                    <headerstyle="min-height:31px;">
                        <buttonname="action_put_in_queue"type="object"attrs="{'invisible':[('state','in',('in_queue','sending','done'))]}"class="oe_highlight"string="Send"
                            confirm="Thiswillsendtheemailtoallrecipients.Doyoustillwanttoproceed?"/>
                        <buttonname="action_schedule"type="object"attrs="{'invisible':[('state','in',('in_queue','sending','done'))]}"class="btn-secondary"string="Schedule"/>
                        <buttonname="action_test"type="object"class="btn-secondary"string="Test"/>
                        <buttonname="action_cancel"type="object"attrs="{'invisible':[('state','!=','in_queue')]}"class="btn-secondary"string="Cancel"/>
                        <buttonname="action_retry_failed"type="object"attrs="{'invisible':['|',('state','!=','done'),('failed','=',0)]}"class="oe_highlight"string="Retry"/>

                        <fieldname="state"readonly="1"widget="statusbar"/>
                    </header>
                    <divclass="alertalert-infotext-center"role="alert"attrs="{'invisible':['&amp;','&amp;','&amp;','&amp;',('state','!=','in_queue'),('sent','=',0),('ignored','=',0),('scheduled','=',0),('failed','=',0)]}">
                        <divattrs="{'invisible':[('ignored','=',0)]}">
                            <buttonclass="btn-linkpy-0"
                                    name="action_view_traces_ignored"
                                    type="object">
                                <strong>
                                    <fieldname="ignored"class="oe_inlinemr-2"/>
                                    <spanname="ignored_text">emailshavebeenignoredandwillnotbesent.</span>
                                </strong>
                            </button>
                        </div>
                        <divattrs="{'invisible':[('scheduled','=',0)]}">
                            <buttonclass="btn-linkpy-0"
                                    name="action_view_traces_scheduled"
                                    type="object">
                                <strong>
                                    <fieldname="scheduled"class="oe_inlinemr-2"/>
                                    <spanname="scheduled_text">emailsareinqueueandwillbesentsoon.</span>
                                </strong>
                            </button>
                        </div>
                        <divattrs="{'invisible':['&amp;',('sent','=',0),('state','in',('draft','test','in_queue'))]}">
                            <buttonclass="btn-linkpy-0"
                                    name="action_view_traces_sent"
                                    type="object">
                                <strong>
                                    <fieldname="sent"class="oe_inlinemr-2"/>
                                    <spanname="sent">emailshavebeensent.</span>
                                </strong>
                            </button>
                        </div>
                        <divattrs="{'invisible':['|',('state','!=','done'),('failed','=',0)]}">
                            <buttonclass="btn-linkpy-0"
                                    name="action_view_traces_failed"
                                    type="object">
                                <strong>
                                    <fieldname="failed"class="oe_inlinemr-2"/>
                                    <spanname="failed_text">emailscouldnotbesent.</span>
                                </strong>
                            </button>
                        </div>
                        <divattrs="{'invisible':[('state','!=','in_queue')]}">
                            <strong>
                                <spanname="next_departure_text">Thismailingisscheduledfor</span>
                                <fieldname="next_departure"class="oe_inline"/>.
                            </strong>
                        </div>
                    </div>

                    <sheet>
                        <divclass="oe_button_box"name="button_box">
                            <buttonname="action_view_delivered"
                                id="button_view_delivered"
                                type="object"
                                context="{'search_default_filter_delivered':True}"
                                attrs="{'invisible':[('state','in',('draft','test'))]}"
                                class="oe_stat_button">
                                <fieldname="received_ratio"string="Received"widget="percentpie"/>
                            </button>
                            <buttonname="action_view_opened"
                                type="object"
                                context="{'search_default_filter_opened':True}"
                                attrs="{'invisible':[('state','in',('draft','test'))]}"
                                class="oe_stat_button">
                                <fieldname="opened_ratio"string="Opened"widget="percentpie"/>
                            </button>
                            <buttonname="action_view_clicked"
                                type="object"
                                context="{'search_default_filter_clicked':True}"
                                attrs="{'invisible':[('state','in',('draft','test'))]}"
                                class="oe_stat_button">
                                <fieldname="clicks_ratio"string="Clicked"widget="percentpie"/>
                            </button>
                            <buttonname="action_view_replied"
                                type="object"
                                context="{'search_default_filter_replied':True}"
                                attrs="{'invisible':[('state','in',('draft','test'))]}"
                                class="oe_stat_button">
                                <fieldname="replied_ratio"string="Replied"widget="percentpie"/>
                            </button>
                            <buttonname="action_view_bounced"
                                type="object"
                                context="{'search_default_filter_bounced':True}"
                                attrs="{'invisible':[('state','in',('draft','test'))]}"
                                class="oe_stat_button">
                                <fieldname="bounced_ratio"string="Bounced"widget="percentpie"/>
                            </button>
                        </div>
                        <widgetname="web_ribbon"title="Archived"bg_color="bg-danger"attrs="{'invisible':[('active','=',True)]}"/>
                        <group>
                            <fieldname="active"invisible="1"/>
                            <fieldname="mailing_type"widget="radio"options="{'horizontal':true}"invisible="1"
                                attrs="{'readonly':[('state','!=','draft')]}"force_save="1"/>
                            <fieldname="subject"string="Subject"attrs="{'readonly':[('state','in',('sending','done'))]}"widget="char_emojis"placeholder="e.g.NewSaleonallT-shirts"/>
                            <fieldname="preview"string="PreviewText"attrs="{'readonly':[('state','in',('sending','done'))]}"widget="char_emojis"placeholder="e.g.Checkitoutbeforeit'stoolate!"/>
                            <labelfor="mailing_model_id"string="Recipients"/>
                            <divname="mailing_model_id_container">
                                <divclass="row">
                                    <divclass="col-xs-12col-md-3">
                                        <fieldname="mailing_model_id"widget="selection"
                                            attrs="{'readonly':[('state','in',('sending','done'))]}"/>
                                    </div>
                                    <divattrs="{'invisible':[('mailing_model_name','!=','mailing.list')]}"class="col-xs-12col-md-9pt-1">
                                        <labelfor="contact_list_ids"string="Selectmailinglists:"class="oe_edit_only"/>
                                        <fieldname="contact_list_ids"widget="many2many_tags"
                                            placeholder="Selectmailinglists..."class="oe_inline"
                                            attrs="{
                                                'required':[('mailing_model_name','=','mailing.list')],
                                                'readonly':[('state','in',('sending','done'))]
                                        }"/>
                                    </div>
                                </div>

                                <fieldname="mailing_model_name"invisible="1"/>
                                <fieldname="mailing_model_real"invisible="1"/>
                                <divattrs="{'invisible':[('mailing_model_name','=','mailing.list')]}">
                                    <fieldname="mailing_domain"widget="domain"options="{'model':'mailing_model_real'}"
                                    attrs="{'readonly':[('state','in',('sending','done'))]}"/>
                                </div>
                            </div>
                        </group>
                        <notebook>
                            <pagestring="MailBody"name="mail_body">
                                <fieldname="body_html"class="oe_read_only"widget="html"
                                    options="{'cssReadonly':'mass_mailing.iframe_css_assets_readonly'}"/>
                                <fieldname="body_arch"class="o_mail_bodyoe_edit_only"widget="mass_mailing_html"
                                    options="{
                                        'snippets':'mass_mailing.email_designer_snippets',
                                        'cssEdit':'mass_mailing.iframe_css_assets_edit',
                                        'inline-field':'body_html'
                                }"attrs="{'readonly':[('state','in',('sending','done'))]}"/>
                            </page>
                            <pagestring="DynamicPlaceholderGenerator"
                                name="dynamic_placeholder_generator"
                                groups="base.group_no_one">
                                <group>
                                    <fieldname="model_object_field"attrs="{'invisible':True}"/>
                                    <fieldname="model_object_field"
                                        domain="[('model_id','=',mailing_model_real),('ttype','!=','one2many'),('ttype','!=','many2many')]"/>
                                    <fieldname="sub_object"readonly="1"/>
                                    <fieldname="sub_model_object_field"
                                        domain="[('model_id','=',sub_object),('ttype','!=','one2many'),('ttype','!=','many2many')]"
                                        attrs="{'readonly':[('sub_object','=',False)],'required':[('sub_object','!=',False)]}"/>
                                    <fieldname="null_value"/>
                                    <fieldname="copyvalue"/>
                                </group>
                            </page>
                            <pagestring="Settings"name="settings">
                                <group>
                                    <group>
                                        <fieldname="id"invisible="1"/>
                                        <fieldname="name"required="False"groups="base.group_no_one"string="Name"/>
                                        <fieldname="user_id"domain="[('share','=',False)]"/>
                                        <fieldname="email_from"attrs="{'readonly':[('state','in',('sending','done'))]}"/>
                                        <labelfor="reply_to"/>
                                        <divname="reply_to_details">
                                            <fieldname="reply_to_mode"widget="radio"
                                                attrs="{
                                                    'invisible':[('mailing_model_name','in',['mailing.contact','res.partner','mailing.list'])],
                                                    'readonly':[('state','in',('sending','done'))]
                                            }"/>
                                            <fieldname="reply_to"
                                                attrs="{
                                                    'required':[('reply_to_mode','=','email')],
                                                    'invisible':[('reply_to_mode','=','thread')],
                                                    'readonly':[('state','in',('sending','done'))]
                                            }"/>
                                            <divstyle="margin-top:-5px">
                                                <smallclass="oe_edit_onlytext-mutedmb-2"
                                                    style="font-size:74%"
                                                    attrs="{'invisible':['|',('reply_to_mode','=','thread'),('mailing_model_name','in',['mailing.contact','res.partner','mailing.list'])],}">
                                                    Totrackreplies,thisaddressmustbelongtothisdatabase.
                                                </small>
                                            </div>
                                        </div>
                                        <labelfor="attachment_ids"/>
                                        <divname="attachment_ids_details">
                                            <fieldname="attachment_ids" widget="many2many_binary"string="Attachafile"class="oe_inline"
                                                attrs="{'readonly':[('state','in',('sending','done'))]}"/>
                                        </div>
                                        <fieldname="mail_server_id"groups="base.group_no_one"options="{'no_create':True,'no_open':True}"/>
                                        <fieldname="keep_archives"groups="base.group_no_one"attrs="{'readonly':[('state','in',('sending','done'))]}"/>
                                    </group>
                                    <groupstring="Marketing"groups="base.group_no_one,mass_mailing.group_mass_mailing_campaign">
                                        <fieldname="campaign_id"
                                            string="MailingCampaign"
                                            groups="mass_mailing.group_mass_mailing_campaign"
                                            attrs="{'readonly':[('state','in',('sending','done'))],
                                                    'required':[('unique_ab_testing','=',True)]}"/>
                                        <fieldname="source_id"
                                            string="Source"
                                            readonly="1"
                                            required="False"
                                            groups="base.group_no_one"
                                            attrs="{'readonly':[('state','in',('sending','done'))]}"/>
                                        <fieldname="medium_id"
                                             string="Medium"
                                             required="True"
                                             groups="base.group_no_one"
                                             attrs="{'readonly':[('state','in',('sending','done'))]}"/>
                                        <fieldname="unique_ab_testing"
                                            groups="mass_mailing.group_mass_mailing_campaign"
                                            attrs="{'readonly':[('state','in',('sending','done'))]}"/>
                                        <labelfor="contact_ab_pc"groups="mass_mailing.group_mass_mailing_campaign"/>
                                        <divgroups="mass_mailing.group_mass_mailing_campaign">
                                            <fieldname="contact_ab_pc"
                                                class="oe_inline"
                                                attrs="{'readonly':[('state','in',('sending','done'))]}"/>%
                                        </div>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <divclass="oe_chatter">
                        <fieldname="message_follower_ids"groups="base.group_user"/>
                        <fieldname="message_ids"/>
                        <fieldname="activity_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <recordmodel="ir.ui.view"id="view_mail_mass_mailing_kanban">
            <fieldname="name">mailing.mailing.kanban</field>
            <fieldname="model">mailing.mailing</field>
            <fieldname="arch"type="xml">
                <kanbandefault_group_by="state"quick_create="false"sample="1">
                    <fieldname='state'readonly="1"/>
                    <fieldname='email_from'readonly="1"/>
                    <fieldname='color'/>
                    <fieldname='user_id'/>
                    <fieldname='expected'/>
                    <fieldname='failed'/>
                    <fieldname='total'/>
                    <fieldname='mailing_model_id'/>
                    <fieldname='mailing_model_name'/>
                    <fieldname='sent_date'/>
                    <fieldname='schedule_date'/>
                    <fieldname='next_departure'/>
                    <fieldname='active'/>
                    <templates>
                        <tt-name="kanban-box">
                            <divt-attf-class="{{!selection_mode?'oe_kanban_color_'+kanban_getcolor(record.color.raw_value):''}}oe_kanban_cardoe_kanban_global_clickoe_kanban_mass_mailing">
                                <divclass="o_dropdown_kanbandropdown"t-if="!selection_mode">
                                    <arole="button"class="dropdown-toggleo-no-caretbtn"data-toggle="dropdown"href="#"data-display="static"aria-label="Dropdownmenu"title="Dropdownmenu">
                                        <spanclass="fafa-ellipsis-v"/>
                                    </a>
                                    <divclass="dropdown-menu"role="menu">
                                        <ulclass="oe_kanban_colorpicker"data-field="color"/>
                                        <tt-if="widget.deletable">
                                            <arole="menuitem"type="delete"class="dropdown-item">Delete</a>
                                        </t>
                                        <arole="menuitem"class="dropdown-itemo_kanban_mailing_active"name="toggle_active"type="object">
                                            <tt-if="record.active.raw_value">Archive</t>
                                            <tt-if="!record.active.raw_value">Restore</t>
                                        </a>
                                    </div>
                                </div>
                                 <divclass="oe_kanban_content">
                                    <divclass="o_kanban_record_top">
                                        <divclass="o_kanban_record_headings">
                                            <divclass="row" attrs="{'invisible':[('sent_date','=',False)]}">
                                                <h3class="my-1col-8o_text_overflow">
                                                    <fieldname="subject"/>
                                                </h3>
                                                <divclass="progressbordercol-3px-0mt-2"style="background-color:inherit;height:12px;">
                                                    <divclass="progress-bar"role="progressbar"
                                                        aria-valuemin="0"
                                                        t-att-aria-valuenow="record.delivered.raw_value"
                                                        t-att-aria-valuemax="record.expected.raw_value"
                                                        t-attf-style="width:#{record.delivered.raw_value*100/record.expected.raw_value}%"/>
                                                </div>
                                            </div>
                                            <h3class="my-1o_text_overflow" attrs="{'invisible':[('sent_date','!=',False)]}">
                                                <fieldname="subject"/>
                                            </h3>
                                            <fieldname="mailing_type"invisible="1"/>
                                            <divclass="o_kanban_record_subtitle"attrs="{'invisible':[('sent_date','=',False)]}">
                                                <h5style="display:inline;">
                                                    <fieldname="campaign_id"groups="mass_mailing.group_mass_mailing_campaign"/>
                                                </h5>
                                            </div>
                                        </div>
                                    </div>
                                    <divclass="o_kanban_record_body"t-if="!selection_mode"attrs="{'invisible':[('sent_date','=',False),('schedule_date','=',False),('state','!=','in_queue')]}">
                                        <div>
                                            <spanattrs="{'invisible':[('sent_date','=',False)]}"><b><fieldname="delivered"/>/<fieldname="expected"/></b>Deliveredto</span>
                                            <spanattrs="{'invisible':[('sent_date','!=',False)]}"><b><fieldname='total'/></b></span>
                                            <fieldname='mailing_model_id'attrs="{'invisible':[('mailing_model_name','=','mailing.list')]}"/>
                                            <spanattrs="{'invisible':[('mailing_model_name','!=','mailing.list')]}">MailingContact</span>
                                        </div>
                                        <divattrs="{'invisible':[('sent_date','=',False)]}"class="d-flexjustify-content-between">
                                            <divname="stat_opened">
                                                <b><fieldname="opened_ratio"/>%</b>Opened
                                            </div>
                                            <divname="stat_replied">
                                                <b><fieldname="replied_ratio"/>%</b>Replied
                                            </div>
                                            <divname="stat_clicks">
                                                <b><fieldname="clicks_ratio"/>%</b>Clicks
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <divname="div_responsible_avatar"class="o_kanban_record_bottom">
                                    <divclass="oe_kanban_bottom_left">
                                        <spanattrs="{'invisible':[('sent_date','=',False)]}"
                                            t-attf-title="Senton#{record.sent_date.value}"class="d-inline-flex">
                                            <spanclass="fafa-calendar-check-omr-2smallmy-auto"aria-label="Sentdate"/>
                                            <spanclass="align-self-baseline"><fieldname="sent_date"widget="date"/></span>
                                        </span>
                                        <spanattrs="{'invisible':[('schedule_date','=',False)]}"
                                            t-attf-title="Scheduledon#{record.schedule_date.value}"class="d-inline-flex">
                                            <spanclass="fafa-hourglass-halfmr-2smallmy-auto"aria-label="Scheduleddate"/>
                                            <spanclass="align-self-baseline"><fieldname="schedule_date"widget="date"/></span>
                                        </span>
                                        <spanattrs="{'invisible':['|','|',('sent_date','!=',False),('schedule_date','!=',False),('state','=','in_queue')]}"
                                            class="oe_clear">
                                            <b><fieldname='total'/></b>
                                            <fieldname='mailing_model_id'attrs="{'invisible':[('mailing_model_name','=','mailing.list')]}"/>
                                            <spanattrs="{'invisible':[('mailing_model_name','!=','mailing.list')]}">MailingContact</span>
                                        </span>
                                        <spanattrs="{'invisible':['|','|',('schedule_date','!=',False),('state','!=','in_queue'),('next_departure','=',False)]}"
                                            t-attf-title="Scheduledon#{record.next_departure.value}"class="d-inline-flex">
                                            <spanclass="fafa-hourglass-omr-2smallmy-auto"aria-label="Scheduleddate"/>
                                            <spanclass="align-self-baseline">NextBatch</span>
                                        </span>
                                    </div>
                                    <divclass="oe_kanban_bottom_right">
                                        <fieldname="user_id"widget="many2one_avatar_user"/>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <recordid="view_mail_mass_mailing_graph"model="ir.ui.view">
            <fieldname="name">mailing.mailing.graph</field>
            <fieldname="model">mailing.mailing</field>
            <fieldname="arch"type="xml">
                <graphstring="Mailing"type="bar"sample="1">
                    <fieldname="state"type="row"/>
                </graph>
            </field>
        </record>

        <recordid="mailing_mailing_action_mail"model="ir.actions.act_window">
            <fieldname="name">Mailings</field>
            <fieldname="res_model">mailing.mailing</field>
            <fieldname="view_mode">kanban,tree,form,graph</field>
            <fieldname="domain">[('mailing_type','=','mail')]</field>
            <fieldname="context">{
                    'search_default_assigned_to_me':1,
                    'default_user_id':uid,
                    'default_mailing_type':'mail',
            }</field>
            <fieldname="help"type="html">
              <pclass="o_view_nocontent_smiling_face">
                Createanewmailing
              </p><p>
                Youdon'tneedtoimportyourmailinglists,youcaneasily
                sendemails<br/>toanycontactsavedinotherFlectraapps.
              </p>
            </field>
        </record>

        <recordid="action_view_mass_mailings_from_campaign"model="ir.actions.act_window">
            <fieldname="name">Mailings</field>
            <fieldname="res_model">mailing.mailing</field>
            <fieldname="view_mode">kanban,tree,form</field>
            <fieldname="context">{
                'search_default_assigned_to_me':1,
                'search_default_campaign_id':[active_id],
                'default_campaign_id':active_id,
                'default_user_id':uid,
            }
            </field>
            <fieldname="domain">[('mailing_type','=','mail')]</field>
            <fieldname="help"type="html">
              <pclass="o_view_nocontent_smiling_face">
                Createanewmailing
              </p><p>
                Youdon'tneedtoimportyourmailinglists,youcaneasily
                sendemails<br/>toanycontactsavedinotherFlectraapps.
              </p>
            </field>
        </record>

        <recordid="action_create_mass_mailings_from_campaign"model="ir.actions.act_window">
            <fieldname="name">Mailings</field>
            <fieldname="res_model">mailing.mailing</field>
            <fieldname="view_mode">form,kanban,tree</field>
            <fieldname="context">{
                'search_default_assigned_to_me':1,
                'search_default_campaign_id':[active_id],
                'default_campaign_id':active_id,
                'default_user_id':uid,
            }
            </field>
            <fieldname="help"type="html">
              <pclass="o_view_nocontent_smiling_face">
                Createanewmailing
              </p><p>
                Youdon'tneedtoimportyourmailinglists,youcaneasily
                sendemails<br/>toanycontactsavedinotherFlectraapps.
              </p>
            </field>
        </record>

        <menuitemname="Mailings"id="mass_mailing_menu"
            parent="mass_mailing_menu_root"
            sequence="1"
            action="mailing_mailing_action_mail"
            groups="mass_mailing.group_mass_mailing_user"/>

</flectra>
