<?xmlversion="1.0"encoding="utf-8"?>
<flectra>
    <data>
        <!--
        Renderares.partnerrecordtobeaddedtotheUBLxmldocument.
        -->
        <templateid="export_ubl_invoice_partner">
            <cac:Party
                xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"
                xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
                xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2">
                <cbc:WebsiteURI
                    t-if="partner.website"
                    t-esc="partner.website"/>
                <cac:PartyName>
                    <cbc:Namet-esc="partner.name"/>
                </cac:PartyName>
                <cac:Languaget-if="partner.lang">
                    <cbc:LocaleCodet-esc="partner.lang"/>
                </cac:Language>
                <cac:PostalAddress>
                    <cbc:StreetName
                        t-if="partner.street"
                        t-esc="partner.street"/>
                    <cbc:AdditionalStreetName
                        t-if="partner.street2"
                        t-esc="partner.street2"/>
                    <cbc:CityName
                        t-if="partner.city"
                        t-esc="partner.city"/>
                    <cbc:PostalZone
                        t-if="partner.zip"
                        t-esc="partner.zip"/>
                    <cbc:CountrySubentity
                        t-if="partner.state_id"
                        t-esc="partner.state_id.name"/>
                    <cbc:CountrySubentityCode
                        t-if="partner.state_id"
                        t-esc="partner.state_id.code"/>
                    <cac:Country
                        t-if="partner.country_id">
                        <cbc:IdentificationCodet-esc="partner.country_id.code"/>
                        <cbc:Namet-esc="partner.country_id.name"/>
                    </cac:Country>
                </cac:PostalAddress>
                <cac:PartyTaxSchemet-if="partner.vat">
                    <cbc:RegistrationNamet-esc="partner.name"/>
                    <cbc:CompanyIDt-esc="partner.vat"/>
                    <cac:TaxScheme>
                        <cbc:ID
                            schemeID="UN/ECE5153"
                            schemeAgencyID="6"
                            >VAT</cbc:ID>
                    </cac:TaxScheme>
                </cac:PartyTaxScheme>
                <cac:Contact>
                    <cbc:Namet-esc="partner.name"/>
                    <cbc:Telephone
                        t-if="partner.phone"
                        t-esc="partner.phone"/>
                    <cbc:ElectronicMail
                        t-if="partner.email"
                        t-esc="partner.email"/>
                </cac:Contact>
            </cac:Party>
        </template>

        <!--
        Renderaninvoice'slinetobeaddedtotheUBLxmldocument.
        -->
        <templateid="export_ubl_invoice_line">
            <cac:InvoiceLine
                xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"
                xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
                xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2">
                <cbc:IDt-esc="line._origin.id"/>
                <cbc:Notet-if="line.discount">Discount(<tt-esc='line.discount'/>%)</cbc:Note>
                <cbc:InvoicedQuantityt-esc="line.quantity"/>
                <cbc:LineExtensionAmount
                    t-att-currencyID="line.currency_id.nameorinvoice.currency_id.name"
                    t-esc="format_monetary(line.price_subtotal)"/>
                <cac:TaxTotal
                    t-foreach="line.tax_ids.compute_all(line.price_unit,quantity=line.quantity,product=line.product_id,partner=invoice.partner_id)['taxes']"
                    t-as="tax">
                    <cbc:TaxAmount
                        t-att-currencyID="line.currency_id.nameorinvoice.currency_id.name"
                        t-esc="format_monetary(tax['amount'])"/>
                </cac:TaxTotal>
                <cac:Item>
                    <cbc:Descriptiont-if="line.name"t-esc="line.name.replace('\n',',')"/>
                    <cbc:Namet-esc="line.product_id.name"/>
                    <cac:SellersItemIdentificationt-if="line.product_id.default_code">
                        <cbc:IDt-esc="line.product_id.default_code"/>
                    </cac:SellersItemIdentification>
                </cac:Item>
                <cac:Price>
                    <cbc:PriceAmount
                        t-att-currencyID="line.currency_id.nameorinvoice.currency_id.name"
                        t-esc="format_monetary(line.price_unit)"/>
                </cac:Price>
            </cac:InvoiceLine>
        </template>

        <!--
        RenderaninvoicetobeaddedtotheUBLxmldocument.
        -->
        <templateid="export_ubl_invoice">
            <Invoice
                xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2"
                xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
                xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2">
                <cbc:UBLVersionIDt-esc="ubl_version"/>
                <cbc:IDt-esc="invoice.name"/>
                <cbc:IssueDatet-esc="invoice.invoice_date"/>
                <cbc:InvoiceTypeCodet-esc="type_code"/>
                <cbc:Notet-esc="invoice.narration"/>
                <cbc:DocumentCurrencyCodet-esc="invoice.currency_id.name"/>
                <cac:AccountingSupplierPartyt-call="account_edi_ubl.export_ubl_invoice_partner">
                    <tt-set="partner"t-value="invoice.company_id.partner_id.commercial_partner_id"/>
                </cac:AccountingSupplierParty>
                <cac:AccountingCustomerPartyt-call="account_edi_ubl.export_ubl_invoice_partner">
                    <tt-set="partner"t-value="invoice.commercial_partner_id"/>
                </cac:AccountingCustomerParty>
                <cac:PaymentMeans>
                    <cbc:PaymentMeansCodelistID="UN/ECE4461"t-esc="payment_means_code"/>
                    <cbc:PaymentDueDatet-esc="invoice.invoice_date_due"/>
                    <cbc:InstructionIDt-esc="invoice.payment_reference"/>
                    <cac:PayeeFinancialAccountt-if="invoice.journal_id.bank_account_id">
                        <cbc:IDschemeName="IBAN"t-esc="invoice.journal_id.bank_account_id.acc_number"/>
                        <cac:FinancialInstitutionBrancht-if="invoice.journal_id.bank_account_id.bank_bic">
                            <cac:FinancialInstitution>
                                <cbc:IDschemeName="BIC"t-esc="invoice.journal_id.bank_account_id.bank_bic"/>
                            </cac:FinancialInstitution>
                        </cac:FinancialInstitutionBranch>
                    </cac:PayeeFinancialAccount>
                </cac:PaymentMeans>
                <cac:PaymentTermst-if="invoice.invoice_payment_term_id">
                    <cbc:Notet-esc="invoice.invoice_payment_term_id.name"/>
                </cac:PaymentTerms>
                <cac:TaxTotalt-if="notinvoice.currency_id.is_zero(invoice.amount_tax)">
                    <cbc:TaxAmount
                        t-att-currencyID="invoice.currency_id.name"
                        t-esc="format_monetary(invoice.amount_tax)"/>
                </cac:TaxTotal>
                <cac:LegalMonetaryTotal>
                    <cbc:LineExtensionAmount
                        t-att-currencyID="invoice.currency_id.name"
                        t-esc="format_monetary(invoice.amount_untaxed)"/>
                    <cbc:TaxExclusiveAmount
                        t-att-currencyID="invoice.currency_id.name"
                        t-esc="format_monetary(invoice.amount_untaxed)"/>
                    <cbc:TaxInclusiveAmount
                        t-att-currencyID="invoice.currency_id.name"
                        t-esc="format_monetary(invoice.amount_total)"/>
                    <cbc:PrepaidAmount
                        t-att-currencyID="invoice.currency_id.name"
                        t-esc="format_monetary(invoice.amount_total-invoice.amount_residual)"/>
                    <cbc:PayableAmount
                        t-att-currencyID="invoice.currency_id.name"
                        t-esc="format_monetary(invoice.amount_residual)"/>
                </cac:LegalMonetaryTotal>
                <tt-call="account_edi_ubl.export_ubl_invoice_line"
                   t-foreach="invoice.invoice_line_ids"
                   t-as="line"/>
            </Invoice>
        </template>
    </data>
</flectra>
